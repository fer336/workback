{
  "active": true,
  "connections": {
    "OpenAI": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch2": {
      "main": [
        [
          {
            "node": "replace",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        []
      ]
    },
    "Webhook1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Segmentos": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1,2s": {
      "main": [
        [
          {
            "node": "Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "1,2s",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "replace": {
      "main": [
        [
          {
            "node": "Segmentos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "V1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "V1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MESSAGE": {
      "main": [
        []
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram1": {
      "main": [
        []
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Telegram1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "V1": {
      "main": [
        [
          {
            "node": "Switch2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-02-20T17:57:00.083Z",
  "id": "D7ax3WroYMmlTHo3",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "LU",
  "nodes": [
    {
      "parameters": {
        "content": "## Delete memories",
        "height": 200,
        "width": 260,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2680,
        740
      ],
      "typeVersion": 1,
      "id": "5e31157c-28f6-4b35-873a-91cafe7e8a74",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Transcribe audio a texto",
        "height": 245,
        "width": 1185
      },
      "id": "9e40cbb9-47ef-48ba-ae71-b64588087e26",
      "name": "Sticky Note14",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1940,
        720
      ]
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "id": "9755471b-5730-42ba-a4dc-f6ebc27dde73",
      "name": "OpenAI",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.7,
      "position": [
        1900,
        520
      ],
      "credentials": {
        "openAiApi": {
          "id": "UfA35dBDzEebw8zR",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b7d210f0-6a18-456d-9e89-aa28f548b2a0",
              "name": "body.data.message.base64",
              "value": "={{ $('Webhook1').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "3b834717-daac-4a24-a02e-47cd851048ff",
      "name": "Edit Fields3",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1540,
        520
      ]
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "body.data.message.base64",
        "options": {
          "mimeType": "audio/mp3"
        }
      },
      "id": "5570e257-c3ce-45da-aaeb-3d266299d98e",
      "name": "Convert to File",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        1720,
        520
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0cb14635-2673-408e-86db-ce9e0373674b",
                    "leftValue": "={{ $json.msg.type }}",
                    "rightValue": "textMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Texto"
            }
          ]
        },
        "options": {}
      },
      "id": "a55bca91-ad06-45ca-9784-00ea4b01d68c",
      "name": "Switch2",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        360,
        440
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "294730d2-a6a9-417d-b97e-46314b89d7f4",
              "name": "msg",
              "value": "={{ $('camposiniciales').item?.json?.content?.mensaje || $json.text}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2080,
        520
      ],
      "id": "dad5ff4b-c1ac-4de8-8c2a-9b524148fa1c",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "greenapi",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -940,
        440
      ],
      "id": "537f6c10-c5c3-4316-9631-ed5760d57d33",
      "name": "Webhook1",
      "webhookId": "8388b55c-32cf-4817-b3e7-500d30c917d6"
    },
    {
      "parameters": {
        "fieldToSplitOut": "text",
        "options": {
          "destinationFieldName": "msg"
        }
      },
      "id": "f8677022-0663-4b05-9866-74cf7ba8da50",
      "name": "Segmentos",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        2460,
        320
      ]
    },
    {
      "parameters": {
        "amount": 1.2
      },
      "id": "48612fbc-9ad3-4fcc-9055-0fcfecc3feb5",
      "name": "1,2s",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2940,
        380
      ],
      "webhookId": "8a810ad6-4ecf-4781-aed8-7f2b295770dc"
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "3e7ea36e-78fa-4b85-9c22-95d8dfbb9b70",
      "name": "Loop Over Items1",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        2640,
        320
      ]
    },
    {
      "parameters": {
        "content": "## Env√≠a los mensajes",
        "height": 413.10685098598157,
        "width": 1021.2519181399954,
        "color": 4
      },
      "id": "dff89f8b-e8b6-445c-aba9-d25bb9858ab2",
      "name": "Sticky Note17",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        3900,
        380
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5d04d69d-cb9c-41be-a44a-95fac3c059f3",
              "name": "text",
              "value": "={{ $json.msg }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "c5fe8bf7-b7c9-47ed-a87f-d1da4ca9c37c",
      "name": "replace",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2260,
        320
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $node['Webhook'].json.body.server_url }}/chat/sendPresence/{{ $node['Webhook'].json.body.instance }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $node['Webhook'].json.body.apikey }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"number\": \"{{ $node['Webhook'].json.body.data.key.remoteJid }}\",\n    \"delay\": 1200,\n    \"presence\": \"composing\"\n}",
        "options": {}
      },
      "id": "5b6f9dce-8727-4539-bace-b610639c71c0",
      "name": "Escribiendo...2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4440,
        1140
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('camposiniciales').item.json.whatsapp.evo.server_url }}/message/sendText/{{ $('camposiniciales').item.json.whatsapp.evo.nombreInstancia }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('camposiniciales').item.json.whatsapp.evo.apikey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('camposiniciales').item.json.meta.telefonoCliente }}"
            },
            {
              "name": "text",
              "value": "={{ $('Loop Over Items1').item.json.msg }}"
            },
            {
              "name": "linkPreview",
              "value": "={{ $('camposiniciales').item.json.linkPreview }}"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "id": "0934ace6-cbf5-429d-8f0e-2859a6298182",
      "name": "Responde texto1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4260,
        900
      ],
      "retryOnFail": true,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a3a8f950-56cb-4eb3-80e1-20df81110c7c",
              "leftValue": "={{ $json.body.data.key.fromMe }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -620,
        440
      ],
      "id": "4284d93e-f95b-438f-a7b2-fa4288688552",
      "name": "If"
    },
    {
      "parameters": {
        "chatId": "164729397",
        "text": "={{ $('Switch2').item.json.msg.nombre }} dice: {{ $('V1').item.json.msg.content }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3200,
        420
      ],
      "id": "087e81d4-78a9-486d-b142-95aef0f8ca7c",
      "name": "Telegram",
      "webhookId": "86f792a6-5bf4-47da-b6ec-43e30195274e",
      "credentials": {
        "telegramApi": {
          "id": "skMQcrtQlIZvLFNp",
          "name": "Luchibot"
        }
      }
    },
    {
      "parameters": {
        "operation": "deleteTable",
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "n8n_chat_histories",
          "mode": "list",
          "cachedResultName": "n8n_chat_histories"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        2760,
        800
      ],
      "id": "9a6de462-00aa-4dcb-a988-820b59c6bfb8",
      "name": "Postgres",
      "credentials": {
        "postgres": {
          "id": "E1mi81N6Tmr5cHS5",
          "name": "GENERICO"
        }
      }
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "164729397",
        "binaryData": true,
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1420,
        60
      ],
      "id": "e434562b-c4f4-46b9-8fab-64e07494a32b",
      "name": "Telegram1",
      "webhookId": "2f1becfb-94ee-4e58-b087-b008c8d376bb",
      "credentials": {
        "telegramApi": {
          "id": "Uk3tgb6s53LxEXnG",
          "name": "Debuger"
        }
      }
    },
    {
      "parameters": {
        "method": "DELETE",
        "url": "https://sub.domain.com (Domain of your API)/chat/deleteMessageForEveryone/instance (Instance name)",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "[[apikey-masked-secret]]"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "id",
              "value": "id"
            },
            {
              "name": "remoteJid",
              "value": "remoteJid"
            },
            {
              "name": "fromMe",
              "value": "true"
            },
            {
              "name": "participant",
              "value": "paticipant"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2560,
        -180
      ],
      "id": "1a31d815-bd2b-459c-b8db-42e8b67cc00e",
      "name": "DELETE"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $node[\"Webhook1\"].json.body.server_url }}/message/sendText/tester",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "=89EBC4C29BD1-4035-982B-DDF76B7D0A5F"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"delay\": 1500,\n    \"number\":5492254423359\",\n    \"text\": \"{{ $('Loop Over Items').first().json.text.replace(/\\n/g,'\\\\n').replace(/\\\"/g,'\\'') }}\"\n\n}",
        "options": {}
      },
      "id": "a2ac6f99-eda3-415b-bfdd-d8dec85d1f51",
      "name": "MESSAGE",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2180,
        80
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "53550ab4-b380-41b6-b6d6-05678ee1916b",
              "name": "data",
              "value": "={{ $('If').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        860,
        100
      ],
      "id": "98eb4cfa-b9af-4743-9e26-06e10806756f",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "jsCode": "return [\n  {\n    binary: {\n      data: {\n        data: $json.data, // tu base64 original\n        mimeType: 'image/png', // o image/jpeg si es JPG\n        fileName: 'foto.png'\n      }\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1140,
        100
      ],
      "id": "3e6ee8be-8560-4070-b6f6-5aca6d35b10b",
      "name": "Code"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f9ecf2fc-da2c-4f44-897a-5dc0a2f2f379",
              "name": "msg.telefono_recibido",
              "value": "={{ $json.body.senderData.chatId.replace(/\\D/g, '') }}",
              "type": "string"
            },
            {
              "id": "dab7ca54-c3d2-4a36-a9ca-a0ebbd375ef5",
              "name": "msg.nombre",
              "value": "={{ $json.body.senderData.chatName }}",
              "type": "string"
            },
            {
              "id": "cc7dcfe1-8ad7-4fe8-93ec-8f643c7d08c7",
              "name": "msg.type",
              "value": "={{ $json.body.messageData.typeMessage }}",
              "type": "string"
            },
            {
              "id": "81612acf-1b66-4c8e-82e4-ce8c77b31334",
              "name": "msg.content",
              "value": "={{ $json.body.messageData.textMessageData.textMessage }}",
              "type": "string"
            },
            {
              "id": "2dfc64f4-b222-4ea7-b095-fdd96d9fcb95",
              "name": "msg.idmsg",
              "value": "={{ $json.body.idMessage }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "ca79a770-1d20-44f8-ad5e-0f6a1ed685ec",
      "name": "V1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -320,
        440
      ],
      "notesInFlow": true
    }
  ],
  "pinData": {
    "Webhook1": [
      {
        "json": {
          "headers": {
            "host": "n8n.innovasoftpro.dev",
            "user-agent": "GREEN-API",
            "content-length": "458",
            "accept": "application/json, text/plain, */*",
            "content-type": "application/json; charset=utf-8",
            "x-forwarded-for": "104.248.252.93",
            "x-forwarded-host": "n8n.innovasoftpro.dev",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "575dad520f0e",
            "x-real-ip": "104.248.252.93",
            "accept-encoding": "gzip"
          },
          "params": {},
          "query": {},
          "body": {
            "typeWebhook": "outgoingMessageReceived",
            "instanceData": {
              "idInstance": 7105250621,
              "wid": "5492254596235@c.us",
              "typeInstance": "whatsapp"
            },
            "timestamp": 1748615563,
            "idMessage": "482C52FB7CECE8D738A48209D084AE35",
            "senderData": {
              "chatId": "5492254617781@c.us",
              "chatName": "Loliüíó",
              "sender": "5492254596235@c.us",
              "senderName": "",
              "senderContactName": "Lolasaaaaaa"
            },
            "messageData": {
              "typeMessage": "textMessage",
              "textMessageData": {
                "textMessage": "PG me termin√≥ x tu culpa"
              }
            }
          },
          "webhookUrl": "https://n8n.innovasoftpro.dev/webhook/greenapi",
          "executionMode": "production"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "errorWorkflow": "2kOn0Oz7c2uvczPK",
    "callerPolicy": "workflowsFromSameOwner",
    "timezone": "America/Argentina/Buenos_Aires"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-05-30T16:34:42.383Z",
  "versionId": "0d295370-08d1-4e58-ba43-0357137468b8"
}