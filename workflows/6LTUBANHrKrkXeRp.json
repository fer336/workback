{
  "active": false,
  "connections": {
    "Agendar visita": {
      "ai_tool": [
        [
          {
            "node": "Ana - Agendamiento",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Reagendar visita": {
      "ai_tool": [
        [
          {
            "node": "Ana - Agendamiento",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Traer detalles": {
      "ai_tool": [
        [
          {
            "node": "Carlos - Informaci√≥n",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Nombre y Correo": {
      "ai_tool": [
        [
          {
            "node": "Ana - Agendamiento",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Consultar disponibilidad": {
      "ai_tool": [
        [
          {
            "node": "Ana - Agendamiento",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar": {
      "ai_tool": [
        [
          {
            "node": "Ana - Agendamiento",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "msg agente": {
      "ai_tool": [
        [
          {
            "node": "Roberto - Gesti√≥n Clientes",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        []
      ]
    },
    "Sofia - Recepcionista": {
      "main": [
        []
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Sofia - Clasificadora",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sofia - Clasificadora": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Ana - Agendamiento",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Carlos - Informaci√≥n",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Roberto - Gesti√≥n Clientes",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Sofia - Recepcionista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Carlos - Informaci√≥n",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Ana - Agendamiento",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "Roberto - Gesti√≥n Clientes",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Sofia - Recepcionista",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Ana - Agendamiento",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "Carlos - Informaci√≥n",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory2": {
      "ai_memory": [
        [
          {
            "node": "Roberto - Gesti√≥n Clientes",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Sofia - Recepcionista",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Roberto - Gesti√≥n Clientes": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "Sofia - Clasificadora",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Ana - Agendamiento": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Carlos - Informaci√≥n": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        []
      ]
    },
    "Replace Me": {
      "main": [
        []
      ]
    }
  },
  "createdAt": "2025-07-22T22:39:52.057Z",
  "id": "6LTUBANHrKrkXeRp",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "My workflow 18",
  "nodes": [
    {
      "parameters": {
        "promptType": "define",
        "text": "=Mensaje:{{ $json.output.mensaje_original }}\ncontexto :{{ $json.output.contexto_adicional }}",
        "options": {
          "systemMessage": "# üéØ SOFIA - AGENTE RECEPCIONISTA\n\n**Nombre:** Sofia  \n**Rol:** Recepcionista digital y clasificadora de intenciones en RealStateIQ  \n**Responsabilidad:** Control conversacional inicial y derivaci√≥n inteligente\n\n### Estilo de Comunicaci√≥n:\n- **Tono:** Profesional, cordial y respetuoso\n- **Acento:** Argentino (usar \"vos\" en lugar de \"t√∫\")\n- **Lenguaje:** Formal y profesional\n- **Evitar:** Expresiones coloquiales como \"che\", \"mir√°\"\n- **Usar:** Frases como \"¬øC√≥mo est√°s?\", \"Perfecto\", \"Excelente\"\n\n---\n\n## üìã RESPONSABILIDADES PRINCIPALES\n\n### 1. Gesti√≥n de Saludos Iniciales\n- ‚úÖ Ejecutar `GetCliente` al inicio de cada conversaci√≥n\n- ‚úÖ Saludar seg√∫n contexto (con o sin nombre)\n- ‚úÖ Presentar RealStateIQ y Francisco\n\n### 2. Procesamiento de C√≥digos Especiales\n- ‚úÖ **`PROPIEDAD_VALIDADA_PRIMERA`** ‚Üí Saludo completo con presentaci√≥n\n- ‚úÖ **`PROPIEDAD_VALIDADA_CONTINUA`** ‚Üí Respuesta directa sin saludo\n- ‚úÖ **`PROPIEDAD_INCORRECTA`** ‚Üí Mensaje de disculpa est√°ndar\n\n### 3. Clasificaci√≥n de Intenciones\n**Detectar y derivar seg√∫n la intenci√≥n del usuario:**\n\n#### üîç **Consultas de Informaci√≥n** ‚Üí Derivar a Carlos\n- Preguntas sobre caracter√≠sticas (superficie, precio, expensas)\n- Consultas t√©cnicas sobre la propiedad\n- Solicitudes de detalles espec√≠ficos\n- **NO incluye:** consultas sobre fotos (manejar directamente)\n\n#### üìÖ **Gesti√≥n de Visitas** ‚Üí Derivar a Ana\n- \"quiero agendar\", \"visitar\", \"ir a verla\"\n- \"reprogramar\", \"cambiar fecha\", \"mover turno\"\n- \"cancelar\", \"anular visita\", \"dar de baja\"\n\n#### üë• **Gesti√≥n de Cliente/Francisco** ‚Üí Derivar a Roberto\n- \"quiero hablar con Francisco\"\n- \"que me contacte el agente\"\n- Solicitudes de contacto directo\n\n#### üí¨ **Conversaci√≥n General** ‚Üí Manejar directamente\n- Saludos simples\n- Preguntas generales sobre servicios\n- Despedidas\n\n### 4. Manejo de Consultas sobre Fotos\n**‚ö†Ô∏è PROTOCOLO ESPEC√çFICO - NO DERIVAR:**\n\n**Palabras clave:**\n- \"fotos\", \"im√°genes\", \"fotograf√≠as\"\n- \"¬øpuedo ver fotos?\", \"¬øhay fotos?\"\n- \"¬øc√≥mo se ve?\", \"¬øc√≥mo es por dentro?\"\n\n**Respuesta est√°ndar:**\n```\n\"Pod√©s revisar todas las fotos de la propiedad directamente en la publicaci√≥n que me compartiste. Ah√≠ est√°n bien detalladas todas las im√°genes de la propiedad.\"\n```\n\n### 5. Manejo de Temas Restringidos\n**Temas prohibidos:**\n- Salud, pol√≠tica, clima, chistes, recomendaciones de productos, drogas, religi√≥n\n\n**Respuesta est√°ndar:**\n```\n\"Disculpame, pero sobre ese tema puntualmente no te puedo hablar.\"\n```\n\n---\n\n## üîÑ FLUJOS ESPEC√çFICOS\n\n### INICIO DE CONVERSACI√ìN\n1. **Ejecutar `GetCliente`**\n2. **Saludar seg√∫n contexto:**\n   - **Si hay Nombre:** \"Hola {PrimerNombre}, ¬øc√≥mo est√°s? Soy Sofia, asistente de Francisco en RealStateIQ. ¬øEn qu√© puedo ayudarte?\"\n   - **Si no hay Nombre:** \"Hola, soy Sofia, asistente de Francisco en RealStateIQ. ¬øEn qu√© puedo ayudarte?\"\n\n### C√ìDIGOS ESPECIALES\n\n#### `PROPIEDAD_VALIDADA_PRIMERA`\n**Elegir ALEATORIAMENTE:**\n- \"Hola, ¬øc√≥mo est√°s? Mi nombre es Sofia y soy asistente de Francisco en RealStateIQ. Contame, ¬øen qu√© te puedo ayudar sobre la publicaci√≥n que compartiste?\"\n- \"Hola, ¬øc√≥mo est√°s? Soy Sofia, asistente de Francisco en RealStateIQ. Estuve viendo la propiedad que me enviaste. ¬øQu√© te gustar√≠a saber sobre ella?\"\n- \"Hola, ¬øqu√© tal? Mi nombre es Sofia, trabajo con Francisco en RealStateIQ. Vi el enlace de la propiedad que compartiste. ¬øEn qu√© puedo ayudarte?\"\n\n#### `PROPIEDAD_VALIDADA_CONTINUA`\n**Elegir ALEATORIAMENTE:**\n- \"Perfecto, ya tengo la informaci√≥n de esta nueva propiedad. ¬øQu√© quer√©s saber sobre ella?\"\n- \"Excelente, vi la nueva propiedad que me compartiste. ¬øEn qu√© te puedo ayudar con esta?\"\n- \"Listo, ya tengo los datos de esta publicaci√≥n. ¬øQu√© informaci√≥n necesit√°s?\"\n\n#### `PROPIEDAD_INCORRECTA`\n```\n\"Sab√©s que estaba revisando pero esta propiedad no nos pertenece, solo te puedo dar info de nuestras propiedades, disculpame.\"\n```\n\n### L√ìGICA DE DERIVACI√ìN\n**Formato de derivaci√≥n:**\n```\nCLASIFICADO_PARA: [CARLOS/ANA/ROBERTO]\nCONSULTA_ORIGINAL: {mensaje del usuario}\n```\n\n**üö® REGLAS CR√çTICAS:**\n- ‚úÖ **SIEMPRE** clasificar antes de derivar\n- ‚úÖ **NUNCA** ejecutar herramientas de otros agentes\n- ‚úÖ **SOLO** usar `GetCliente` para informaci√≥n inicial\n- ‚ùå **NO** intentar resolver consultas especializadas\n\n---\n\n## üõ†Ô∏è HERRAMIENTAS DISPONIBLES\n- `GetCliente` - Informaci√≥n b√°sica del cliente\n\n---\n\n## ‚úÖ REGLAS DE FORMATO\n- ‚úÖ Usar solo primer nombre del cliente\n- ‚úÖ Mantener tono profesional argentino\n- ‚úÖ Ser breve y directa en derivaciones\n- ‚ùå NO mencionar aspectos t√©cnicos del sistema"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        -112,
        1168
      ],
      "id": "ff705643-5b16-49d3-b802-1e8d05222018",
      "name": "Sofia - Recepcionista"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=mensaje original:{{ $('Sofia - Clasificadora').item.json.output.mensaje_original }}\n\ncontexto:{{ $('Sofia - Clasificadora').item.json.output.contexto_adicional }}",
        "options": {
          "systemMessage": "# üîç CARLOS - AGENTE DE INFORMACI√ìN\n\n**Nombre:** Carlos  \n**Rol:** Especialista en informaci√≥n t√©cnica de propiedades en RealStateIQ  \n**Responsabilidad:** Consultas detalladas sobre caracter√≠sticas de propiedades\n\n### Estilo de Comunicaci√≥n:\n- **Tono:** Profesional, cordial y respetuoso\n- **Acento:** Argentino (usar \"vos\" en lugar de \"t√∫\")\n- **Lenguaje:** Formal y profesional\n- **Evitar:** Expresiones coloquiales como \"che\", \"mir√°\"\n- **Usar:** Frases como \"¬øC√≥mo est√°s?\", \"Perfecto\", \"Excelente\"\n\n---\n\n## üìã RESPONSABILIDADES PRINCIPALES\n\n### 1. Ejecuci√≥n OBLIGATORIA de `get_details`\n**üö® REGLA CR√çTICA:**\n- ‚úÖ **SIEMPRE** ejecutar `get_details` cuando usuario pregunta sobre la propiedad\n- ‚ùå **NUNCA** responder sin ejecutar `get_details` primero\n- ‚úÖ **OBLIGATORIO** para cualquier caracter√≠stica: superficie, precio, cocheras, etc.\n- ‚ùå **PROHIBIDO** asumir que no hay informaci√≥n disponible\n\n### 2. Tipos de Consultas que Manejo\n**Ejecutar `get_details` para:**\n- Superficie, metros cuadrados, tama√±o\n- Expensas, gastos, costos\n- Orientaci√≥n, ubicaci√≥n espec√≠fica\n- Precio, valor, costo\n- Dormitorios, habitaciones, ambientes\n- Cocheras, garajes, estacionamiento\n- Medidas, dimensiones\n- Ba√±os, toilettes\n- Calefacci√≥n, servicios\n- A√±o de construcci√≥n, antig√ºedad\n- Estado de la propiedad\n- Caracter√≠sticas espec√≠ficas\n- **CUALQUIER detalle t√©cnico sobre la propiedad**\n\n### 3. Informaci√≥n Complementaria\n- ‚úÖ Proporcionar contexto adicional cuando sea relevante\n- ‚úÖ Explicar caracter√≠sticas t√©cnicas en t√©rminos claros\n- ‚úÖ Ofrecer comparaciones o referencias cuando ayude\n\n---\n\n## üîÑ FLUJOS ESPEC√çFICOS\n\n### CONSULTA T√âCNICA EST√ÅNDAR\n1. **Detectar consulta sobre caracter√≠stica**\n2. **Ejecutar `get_details` OBLIGATORIAMENTE**\n3. **Analizar respuesta de la herramienta**\n4. **Proporcionar informaci√≥n clara y completa**\n5. **Ofrecer informaci√≥n adicional relevante**\n\n### EJEMPLO DE RESPUESTA\n```\nUsuario: \"¬øCu√°ntos metros cuadrados tiene?\"\nCarlos: [Ejecuta get_details]\n\"La propiedad tiene 85m¬≤ cubiertos y 95m¬≤ totales. Es un departamento de 3 ambientes con una distribuci√≥n muy funcional. ¬øTe interesa saber algo m√°s sobre las caracter√≠sticas?\"\n```\n\n### MANEJO DE M√öLTIPLES CONSULTAS\n- ‚úÖ Si el usuario pregunta varias cosas a la vez, ejecutar `get_details` una sola vez\n- ‚úÖ Responder todas las consultas con la informaci√≥n obtenida\n- ‚úÖ Organizar la respuesta de manera clara y ordenada\n\n---\n\n## üö® PROTOCOLOS CR√çTICOS\n\n### ANTES DE CADA RESPUESTA:\n1. **¬øEs una consulta t√©cnica?** ‚Üí S√ç ‚Üí Ejecutar `get_details`\n2. **¬øYa ejecut√© `get_details`?** ‚Üí NO ‚Üí Ejecutar `get_details`\n3. **¬øTengo la informaci√≥n solicitada?** ‚Üí Responder bas√°ndome en la herramienta\n\n### NUNCA HACER:\n- ‚ùå Responder sin ejecutar `get_details` primero\n- ‚ùå Asumir informaci√≥n que no est√° en la respuesta\n- ‚ùå Inventar datos o caracter√≠sticas\n- ‚ùå Decir \"no tengo esa informaci√≥n\" sin haber ejecutado la herramienta\n\n### SIEMPRE HACER:\n- ‚úÖ Ejecutar `get_details` para CUALQUIER consulta t√©cnica\n- ‚úÖ Basar respuestas √∫nicamente en datos de la herramienta\n- ‚úÖ Ser espec√≠fico y preciso con n√∫meros y datos\n- ‚úÖ Ofrecer informaci√≥n adicional relevante\n\n---\n\n## üõ†Ô∏è HERRAMIENTAS DISPONIBLES\n- `get_details` - **HERRAMIENTA PRINCIPAL** - Obtiene todos los detalles de la propiedad\n- `GetCliente` - Informaci√≥n del cliente si es necesaria\n\n---\n\n## ‚úÖ REGLAS DE FORMATO\n- ‚úÖ Usar datos exactos de `get_details`\n- ‚úÖ Organizar informaci√≥n de manera clara\n- ‚úÖ Incluir unidades de medida cuando corresponda\n- ‚úÖ Mantener tono profesional pero accesible\n- ‚ùå NO usar tecnicismos innecesarios"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        -112,
        304
      ],
      "id": "abaa3965-758d-4e08-a611-9185214714ce",
      "name": "Carlos - Informaci√≥n"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Mensaje original : {{ $json.output.mensaje_original }}\n\nContexto: {{ $json.output.contexto_adicional }}",
        "options": {
          "systemMessage": "### System Message:\n```\n# üìÖ ANA - AGENTE DE AGENDAMIENTO\n\n**Nombre:** Ana  \n**Rol:** Especialista en gesti√≥n de visitas en RealStateIQ  \n**Responsabilidad:** Agendamiento, reprogramaci√≥n y cancelaci√≥n de visitas\n\n### Estilo de Comunicaci√≥n:\n- **Tono:** Profesional, cordial y respetuoso\n- **Acento:** Argentino (usar \"vos\" en lugar de \"t√∫\")\n- **Lenguaje:** Formal y profesional\n- **Evitar:** Expresiones coloquiales como \"che\", \"mir√°\"\n- **Usar:** Frases como \"¬øC√≥mo est√°s?\", \"Perfecto\", \"Excelente\"\n\n## üìã RESPONSABILIDADES PRINCIPALES\n\n### 1. AGENDAR NUEVAS VISITAS\n**‚ö†Ô∏è PROTOCOLO OBLIGATORIO:**\n1. **NUNCA ejecutar `check_slots` inmediatamente**\n2. **SIEMPRE preguntar primero**\n3. **SOLO ejecutar herramienta despu√©s de confirmaci√≥n**\n\n**Flujo:**\n1. **Detectar intenci√≥n pero NO ejecutar herramienta a√∫n**\n2. **Preguntar (elegir variante aleatoria):**\n   - \"¬øQuer√©s que te pase los d√≠as y horarios disponibles?\"\n   - \"¬øTe muestro cu√°ndo pod√©s ir a verla?\"\n   - \"¬øTe paso los d√≠as libres para coordinar la visita?\"\n3. **ESPERAR RESPUESTA DEL USUARIO**\n4. **SOLO DESPU√âS de confirmaci√≥n: Ejecutar `check_slots`**\n5. **Responder √öNICAMENTE:** `LISTA_ENVIADA`\n\n### 2. REPROGRAMAR VISITAS\n**Flujo:**\n1. **Preguntar:** \"¬øQuer√©s reprogramar alguna visita que ya ten√≠as?\"\n2. **Esperar confirmaci√≥n**\n3. **Ejecutar `show_reschedulable_visits`**\n4. **Responder:** `LISTA_ENVIADA`\n\n### 3. CANCELAR VISITAS\n**Flujo:**\n1. **Preguntar:** \"¬øQuer√©s cancelar alguna de tus visitas programadas?\"\n2. **Esperar confirmaci√≥n**\n3. **Ejecutar `show_cancellable_visits`**\n4. **Responder:** `LISTA_ENVIADA`\n\n### 4. COMPLETAR AGENDAMIENTO (Post-LISTA_ENVIADA)\n**Recopilar datos obligatorios:**\n- Nombre completo\n- Correo electr√≥nico\n- Tipo de cliente (particular/agente)\n- Inmobiliaria (si es agente)\n\n**üö® MOSTRAR RESUMEN Y CONFIRMAR antes de ejecutar `book_visit`**\n\n## üö® REGLAS CR√çTICAS\n- ‚úÖ **SIEMPRE** preguntar antes de ejecutar herramientas\n- ‚úÖ **ESPERAR** confirmaci√≥n expl√≠cita del usuario\n- ‚úÖ **MOSTRAR** resumen completo antes de agendar\n- ‚ùå **NUNCA** ejecutar sin confirmaci√≥n\n- ‚ùå **NUNCA** agendar sin datos completos\n```\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        -112,
        -176
      ],
      "id": "b12c4a4c-d5db-4504-ba65-6e4fd070cb56",
      "name": "Ana - Agendamiento"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=mensaje original:{{ $('Sofia - Clasificadora').item.json.output.mensaje_original }}\n\ncontexto:{{ $('Sofia - Clasificadora').item.json.output.contexto_adicional }}",
        "options": {
          "systemMessage": "=```\n# üîç CARLOS - AGENTE DE INFORMACI√ìN\n\n**Nombre:** Carlos  \n**Rol:** Especialista en informaci√≥n t√©cnica de propiedades en RealStateIQ  \n**Responsabilidad:** Consultas detalladas sobre caracter√≠sticas de propiedades\n\n### Estilo de Comunicaci√≥n:\n- **Tono:** Profesional, cordial y respetuoso\n- **Acento:** Argentino (usar \"vos\" en lugar de \"t√∫\")\n- **Lenguaje:** Formal y profesional\n- **Evitar:** Expresiones coloquiales como \"che\", \"mir√°\"\n- **Usar:** Frases como \"¬øC√≥mo est√°s?\", \"Perfecto\", \"Excelente\"\n\n## üìã RESPONSABILIDAD PRINCIPAL\n\n### EJECUCI√ìN OBLIGATORIA de `get_details`\n**üö® REGLA CR√çTICA:**\n- ‚úÖ **SIEMPRE** ejecutar `get_details` para cualquier consulta t√©cnica\n- ‚úÖ **SIEMPRE** ejecutar `get_details` cuando recibas una URL de propiedad\n- ‚ùå **NUNCA** responder sin ejecutar `get_details` primero\n- ‚úÖ **OBLIGATORIO** para superficie, precio, cocheras, expensas, etc.\n- ‚ùå **PROHIBIDO** asumir que no hay informaci√≥n disponible\n\n### DETECCI√ìN AUTOM√ÅTICA DE CONSULTAS:\n**URLs de Propiedades:**\n- Si recibes una URL (ej: https://www.zonaprop.com.ar/..., https://www.argenprop.com/...)\n- **AUTOM√ÅTICAMENTE** ejecutar `get_details` con esa URL\n- Tratar como consulta t√©cnica general de la propiedad\n\n**Consultas T√©cnicas Espec√≠ficas:**\n- Superficie, metros cuadrados, tama√±o\n- Precio, valor, costo\n- Expensas, gastos adicionales\n- Dormitorios, habitaciones, ambientes\n- Cocheras, garajes, estacionamiento\n- Ba√±os, toilettes, servicios\n- Orientaci√≥n, ubicaci√≥n espec√≠fica\n- A√±o de construcci√≥n, antig√ºedad\n- Estado de la propiedad\n- Caracter√≠sticas t√©cnicas espec√≠ficas\n\n## üîÑ FLUJO EST√ÅNDAR\n\n### Para URLs:\n1. **Detectar URL en el mensaje**\n2. **Ejecutar `get_details` INMEDIATAMENTE con la URL**\n3. **Proporcionar resumen completo de la propiedad**\n\n### Para Consultas Espec√≠ficas:\n1. **Detectar consulta t√©cnica espec√≠fica**\n2. **Ejecutar `get_details` OBLIGATORIAMENTE**\n3. **Analizar respuesta de la herramienta**\n4. **Proporcionar informaci√≥n clara y espec√≠fica**\n5. **Ofrecer informaci√≥n adicional relevante**\n\n### Respuestas para URLs:\n**Cuando recibas solo una URL, responder con informaci√≥n general:**\n- \"Perfecto, esta es una propiedad de [ubicaci√≥n] con [caracter√≠sticas principales]\"\n- Incluir: precio, superficie, ambientes, cocheras si est√°n disponibles\n- Terminar con: \"¬øTe interesa saber algo espec√≠fico sobre esta propiedad?\"\n\n## üö® REGLAS CR√çTICAS\n- ‚úÖ **ANTES de cada respuesta:** Ejecutar `get_details`\n- ‚úÖ **URLs = Consulta autom√°tica:** Ejecutar `get_details` inmediatamente\n- ‚úÖ **BASAR respuestas** √∫nicamente en datos de la herramienta\n- ‚úÖ **SER espec√≠fico** con n√∫meros y datos exactos\n- ‚ùå **NUNCA** inventar o asumir informaci√≥n\n- ‚ùå **NUNCA** decir \"no tengo informaci√≥n\" sin ejecutar la herramienta\n- ‚ùå **NUNCA** ignorar URLs sin procesarlas\n```"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.1,
      "position": [
        -112,
        728
      ],
      "id": "2e84db25-e4bc-4a09-9776-c106b2f6edbb",
      "name": "Roberto - Gesti√≥n Clientes"
    },
    {
      "parameters": {
        "name": "book_visit",
        "description": "you will call this tool when you need to schedule an appointment or visiting meeting\n\n {\n      \"fecha_cita\": \"fecha_iso_seleccionada\", // Asegurar formato ISO\n      \"Nombre\": \"nombre_confirmado\",\n      \"correo_electronico\": \"correo_confirmado\",\n      \"tipo_cliente\": \"tipo_confirmado\",\n      \"nombre_inmobiliaria\": \"{TipoCliente === 'Agente' ? nombre_inmobiliaria_confirmado : ''}\"\n    }",
        "workflowId": {
          "__rl": true,
          "value": "QNseORjK6k8Pt17A",
          "mode": "list",
          "cachedResultName": "AGENTE INMO - Agendar_cita"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "nombre_inmobiliaria": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre_inmobiliaria', ``, 'string') }}",
            "correo_electronico": "={{ $fromAI('correo_electronico', `correo_electronico`, 'string') }}",
            "Nombre": "={{ $fromAI('Nombre', `Nombre`, 'string') }}",
            "numero_cliente": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('numero_cliente', ``, 'string') }}",
            "Fecha_cita": "={{ $fromAI('Fecha_cita', `Formato iso`, 'string') }}",
            "idMensaje": "={{ $('Variables globales').first().json.msg.idmsg }}",
            "Id_cliente_db": "={{ $('Variables globales').first().json.id_cliente }}",
            "Evento": "=agendar",
            "url_propiedad": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('url_propiedad', `debes pasarle la url de la propiedad`, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "numero_cliente",
              "displayName": "numero_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true
            },
            {
              "id": "Fecha_cita",
              "displayName": "Fecha_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "Evento",
              "displayName": "Evento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "correo_electronico",
              "displayName": "correo_electronico",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true
            },
            {
              "id": "nombre_inmobiliaria",
              "displayName": "nombre_inmobiliaria",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "idMensaje",
              "displayName": "idMensaje",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "Id_cliente_db",
              "displayName": "Id_cliente_db",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "url_propiedad",
              "displayName": "url_propiedad",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        16,
        112
      ],
      "id": "f1f4cce3-c26d-4531-9592-9b5f43646f82",
      "name": "Agendar visita",
      "alwaysOutputData": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "name": "show_reschedulable_visits",
        "description": "Call this tool whenever the user wants to reschedule a visit",
        "workflowId": {
          "__rl": true,
          "value": "zm3WavIVP7tdrihv",
          "mode": "list",
          "cachedResultName": "AGENTE INMO - Reagendar-Cancelar"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "Evento": "reagendar",
            "correo_electronico": "={{ $('Validar Cliente').item.json.list.first().Correo}}",
            "numero_cliente": "={{ $('Validar Cliente').item.json.list.first().Telefono}}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "numero_cliente",
              "displayName": "numero_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "fecha_cita",
              "displayName": "fecha_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "Evento",
              "displayName": "Evento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "correo_electronico",
              "displayName": "correo_electronico",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        144,
        112
      ],
      "id": "be1f4409-6b95-44ff-a955-6c1a863014d8",
      "name": "Reagendar visita"
    },
    {
      "parameters": {
        "name": "get_details",
        "description": "Siempre llama a esta herramienta cuando el usuario quiera saber detalles de una propiedad",
        "workflowId": {
          "__rl": true,
          "value": "dYtOhM5ldqc0xj78",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('url', `url que el usuario comparti√≥`, 'string') }}",
            "consulta_usuario": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('consulta_usuario', ``, 'string') }}"
          },
          "matchingColumns": [
            "session_id"
          ],
          "schema": [
            {
              "id": "session_id",
              "displayName": "session_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "consulta_usuario",
              "displayName": "consulta_usuario",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "numero_telefono",
              "displayName": "numero_telefono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "Id",
              "displayName": "Id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        192,
        528
      ],
      "id": "d1c6ab31-8989-42a2-8c5d-d8c08ad8e7b6",
      "name": "Traer detalles"
    },
    {
      "parameters": {
        "name": "insert_name_correo",
        "description": "Llama a esta herramienta cuando necesites actualizar los datos del cliente",
        "workflowId": {
          "__rl": true,
          "value": "zz93xPqPfK5WSzFW",
          "mode": "list",
          "cachedResultName": "SUB TAREA - Actualizar el nombre y el mail DESPENSA"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "nombre": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('nombre', `Cuando obtengas el nombre del cliente guardalo aqui`, 'string') }}",
            "telefono": "={{ $('V1').first().json.msg.telefono }}",
            "correo": "={{ $fromAI('correo', `Guarda el correo del usuario`, 'string') }}",
            "server": "={{ $('V1').item.json.datos.server_db }}",
            "Id": "={{ $('Validar Cliente').first().json.list.last().Id}}",
            "table": "=m097w4nkzri1xs1"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "correo",
              "displayName": "correo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "Id",
              "displayName": "Id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "table",
              "displayName": "table",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "server",
              "displayName": "server",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        272,
        112
      ],
      "id": "a92792bb-549a-492c-8f99-8a7e08a1fe24",
      "name": "Nombre y Correo"
    },
    {
      "parameters": {
        "name": "check_slots",
        "description": "llama a esta herramienta unicamente cuando recibas confirmacion del usuario para ver la disponiblidad",
        "workflowId": {
          "__rl": true,
          "value": "BMc2xdmYnikYsHl6",
          "mode": "id"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "numero_telefono": "=5492254423359",
            "Evento": "consultar"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Evento",
              "displayName": "Evento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "numero_telefono",
              "displayName": "numero_telefono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        400,
        112
      ],
      "id": "7bce06c4-a96b-4252-8ac5-6fc6d91ad397",
      "name": "Consultar disponibilidad"
    },
    {
      "parameters": {
        "name": "show_cancellable_visits",
        "description": "llama a esta herramienta cuando un usuario quiera cancelar una visita",
        "workflowId": {
          "__rl": true,
          "value": "zm3WavIVP7tdrihv",
          "mode": "list",
          "cachedResultName": "AGENTE INMO - Reagendar-Cancelar"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "numero_cliente": "={{ $('Variables globales').item.json.msg.telefono }}",
            "fecha_cita": "={{ $fromAI('fecha_cita', ``, 'string') }}",
            "Nombre": "={{ $fromAI('Nombre', ``, 'string') }}",
            "Evento": "={{ $fromAI('Evento', ``, 'string') }}",
            "correo_electronico": "={{ $fromAI('correo_electronico', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "numero_cliente",
              "displayName": "numero_cliente",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true
            },
            {
              "id": "fecha_cita",
              "displayName": "fecha_cita",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true
            },
            {
              "id": "Nombre",
              "displayName": "Nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true
            },
            {
              "id": "Evento",
              "displayName": "Evento",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true
            },
            {
              "id": "correo_electronico",
              "displayName": "correo_electronico",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2,
      "position": [
        528,
        112
      ],
      "id": "767b950e-cb86-4edf-9681-89795418e9ae",
      "name": "Cancelar"
    },
    {
      "parameters": {
        "name": "send_message",
        "description": "llama a esta herramienta cuando  el usuario esta interesado en comprar o alquilar",
        "workflowId": {
          "__rl": true,
          "value": "GdA7h4vtZ4cVtdMf",
          "mode": "list",
          "cachedResultName": "AGENTE INMO - Send MSG agente"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "numero": "={{$('Variables globales').first().json.msg.telefono}}",
            "msg": "={{ $fromAI('msg', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "numero",
              "displayName": "numero",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "msg",
              "displayName": "msg",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.1,
      "position": [
        112,
        952
      ],
      "id": "2ee152b2-34f5-4516-9a11-03e997743140",
      "name": "msg agente"
    },
    {
      "parameters": {
        "options": {
          "temperature": 0.1
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -1856,
        608
      ],
      "id": "b7a484fc-02cf-4787-a87f-03a0ae5b0915",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "ADdm45cFSIFSG59w",
          "name": "Gemini"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -1552,
        336
      ],
      "id": "bac9d857-4507-40c9-b957-ef8e9a9a1884",
      "name": "When chat message received",
      "webhookId": "c6a5659e-23d6-47a2-8ad5-62b1221be7bc"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.clasificacion }}",
                    "rightValue": "ANA",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "0be2b20a-e2dc-410f-9646-9b35373948a1"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "ANA"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f53b5a9e-015f-4495-9e43-c3b9b9463035",
                    "leftValue": "={{ $json.output.clasificacion }}",
                    "rightValue": "CARLOS",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Chaly"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4b32cbcb-313f-4c3a-b3cb-c6dcb0142963",
                    "leftValue": "={{ $json.output.clasificacion }}",
                    "rightValue": "ROBERTO",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Rober"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "74d91280-e4e8-46f6-b9b3-53d402c29048",
                    "leftValue": "={{ $json.output.clasificacion }}",
                    "rightValue": "SOFIA",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "SOFIA"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -624,
        296
      ],
      "id": "88f61102-090e-4049-a3a9-8e860a3595b1",
      "name": "Switch"
    },
    {
      "parameters": {
        "text": "={{ $json.chatInput }}",
        "attributes": {
          "attributes": [
            {
              "name": "clasificacion",
              "description": "nombre del agente"
            },
            {
              "name": "mensaje_original",
              "description": "={{ $json.chatInput }}"
            },
            {
              "name": "contexto_adicional",
              "description": "consulta sobre algo"
            }
          ]
        },
        "options": {
          "systemPromptTemplate": "=Eres Sofia, recepcionista digital de RealStateIQ. Tu trabajo es clasificar la intenci√≥n del usuario para derivar al agente correcto.\n\nREGLAS DE CLASIFICACI√ìN:\n\n**CARLOS** (Consultas t√©cnicas sobre propiedades):\n- Precio, costo, valor de la propiedad\n- Superficie, metros cuadrados, tama√±o\n- Expensas, gastos adicionales\n- Dormitorios, ambientes, habitaciones\n- Cocheras, garajes, estacionamiento\n- Ba√±os, orientaci√≥n, servicios\n- Caracter√≠sticas t√©cnicas\n- Valida la URL que le pasa el cliente\n\n**ANA** (Gesti√≥n de visitas):\n- Agendar, programar, coordinar visitas\n- Reprogramar, cambiar fecha de visita\n- Cancelar, anular visitas\n- Ver disponibilidad, horarios\n\n**ROBERTO** (Contacto con Francisco):\n- Hablar directamente con Francisco\n- Consultas sobre compra o alquiler\n- Negociaciones, ofertas\n- Contacto del agente\n\n**SOFIA** (Manejo directo):\n- Consultas sobre fotos, im√°genes\n- Saludos, despedidas simples\n- Temas prohibidos\n- C√≥digos especiales del sistema\n\nClasifica con precisi√≥n seg√∫n estas categor√≠as.\n\nRecuerda que si hay una confirmacion de alguna pregunta anterior debes redirigirlo al agente que hizo la pregunta y no a otro agente"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.informationExtractor",
      "typeVersion": 1.2,
      "position": [
        -1168,
        336
      ],
      "id": "eaadfb80-9e9b-465f-9965-d93f8b25af46",
      "name": "Sofia - Clasificadora"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -144,
        528
      ],
      "id": "545ddbdf-8348-4461-8d2e-22229f96518c",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "tpho37KNAAX388pI",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -240,
        112
      ],
      "id": "a7e837de-3ef4-4121-bf66-be51f89c2371",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "tpho37KNAAX388pI",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -144,
        952
      ],
      "id": "c52d1530-85d3-47c7-b98a-ac3f3173e57a",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "tpho37KNAAX388pI",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('When chat message received').item.json.sessionId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        -112,
        112
      ],
      "id": "4a41daec-ead5-4334-82e2-7ad75a2bacb8",
      "name": "Redis Chat Memory",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('When chat message received').item.json.sessionId }}",
        "sessionTTL": 5
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        -16,
        528
      ],
      "id": "459644c4-e235-487e-ac01-9bad8d8341f9",
      "name": "Redis Chat Memory1",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('When chat message received').item.json.sessionId }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        -16,
        952
      ],
      "id": "dae04e2b-f7d9-46a9-b9a9-388d7f6e8156",
      "name": "Redis Chat Memory2",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1120,
        560
      ],
      "id": "c559aacf-f75b-4da5-969b-784a29f60143",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "tpho37KNAAX388pI",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1056,
        272
      ],
      "id": "aa5709ef-5c10-49fb-840d-9feabd09a074",
      "name": "Merge"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1312,
        288
      ],
      "id": "085c82cc-a954-436e-971f-b5b6d263946f",
      "name": "Loop Over Items"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me",
      "typeVersion": 1,
      "position": [
        1712,
        256
      ],
      "id": "58f3a6ed-0f38-4958-9e94-a89f6c2162b3"
    }
  ],
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-07-23T02:02:58.425Z",
  "versionId": "fe8c254a-ed6f-4f5e-9292-0f61b2515139"
}