{
  "active": false,
  "connections": {
    "datos": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        []
      ]
    },
    "Code": {
      "main": [
        []
      ]
    }
  },
  "createdAt": "2025-06-16T05:55:41.064Z",
  "id": "ZsFRTsq745Q0BDJ2",
  "isArchived": false,
  "meta": null,
  "name": "AGENTE TECHNO GAS - Buttons confirm",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// OBTENER DATOS DEL INPUT\nconst inputData = $input.all();\nconst cliente = inputData[0]?.json?.cliente || {};\nconst producto = inputData[0]?.json?.producto || {};\nconst pedido = inputData[0]?.json?.pedido || {};\n\n// PREPARAR DATOS PARA EL MENSAJE\nconst phoneNumber = cliente.telefono || \"5492254423359\";\nconst productName = producto.nombre || \"Producto\";\nconst price = producto.precio || 0;\nconst stock = producto.stock || \"disponible\";\nconst cantidad = producto.cantidad || 1;\nconst subtotal = producto.subtotal || price;\n\n// CONFIGURAR EL MENSAJE SEG√öN EL TIPO DE PEDIDO\nlet headerTitle = \"\";\nlet messageText = \"\";\nlet footerText = \"\";\nlet buttons = [];\n\nif (pedido.tipo === \"compra\") {\n  // PRODUCTO DISPONIBLE PARA COMPRA\n  headerTitle = \"üîß Techno Gas - Producto Disponible\";\n  \n  messageText = `üéØ **${productName}**\n\nüí∞ Precio: ${price.toLocaleString()}\nüî¢ Cantidad: ${cantidad}\nüíµ Subtotal: ${subtotal.toLocaleString()}\nüì¶ Stock: ‚úÖ Disponible\n\nüöö Env√≠os a Villa Gesell, Madariaga y Costa Esmeralda`;\n\n  footerText = \"¬øQu√© quer√©s hacer?\";\n  \n  buttons = [\n    {\n      \"type\": \"quick_reply\",\n      \"id\": \"buy_now\",\n      \"text\": \"üõí Comprar\"\n    },\n    {\n      \"type\": \"quick_reply\", \n      \"id\": \"more_info\",\n      \"text\": \"‚ÑπÔ∏è M√°s info\"\n    },\n    {\n      \"type\": \"quick_reply\",\n      \"id\": \"other_product\", \n      \"text\": \"üîç Buscar otro\"\n    }\n  ];\n\n} else if (pedido.tipo === \"encargo\") {\n  // PRODUCTO PARA ENCARGAR\n  headerTitle = \"üìã Techno Gas - Encargo Disponible\";\n  \n  messageText = `üéØ **${productName}**\n\nüí∞ Precio total: ${price.toLocaleString()}\nüí∏ Se√±a (30%): \nüìÖ Demora estimada: 7-10 d√≠as\nüì¶ Estado: A encargar\n\nüöö Env√≠os a Villa Gesell, Madariaga y Costa Esmeralda`;\n\n  footerText = \"¬øQuer√©s encargarlo?\";\n  \n  buttons = [\n    {\n      \"type\": \"quick_reply\",\n      \"id\": \"order_now\",\n      \"text\": \"‚úÖ Encargar\"\n    },\n    {\n      \"type\": \"quick_reply\",\n      \"id\": \"ask_more\",\n      \"text\": \"‚ùì Consultar\"\n    },\n    {\n      \"type\": \"quick_reply\",\n      \"id\": \"other_option\",\n      \"text\": \"üîç Ver otros\"\n    }\n  ];\n\n} else {\n  // CONFIRMACI√ìN GENERAL DE PEDIDO\n  headerTitle = \"üéâ Techno Gas - Confirmaci√≥n\";\n  \n  messageText = `‚úÖ **Pedido confirmado**\n\nüë§ Cliente: ${cliente.nombre}\nüì¶ Producto: ${productName}\nüí∞ Total: ${pedido.total.toLocaleString()}\n\nüè¶ Alias: techno.gas.arg\nüì± Te contactamos para coordinar entrega`;\n\n  footerText = \"Pr√≥ximos pasos:\";\n  \n  buttons = [\n    {\n      \"type\": \"quick_reply\",\n      \"id\": \"payment_done\",\n      \"text\": \"üí≥ Ya transfer√≠\"\n    },\n    {\n      \"type\": \"quick_reply\",\n      \"id\": \"payment_later\",\n      \"text\": \"‚è∞ Pago despu√©s\"\n    },\n    {\n      \"type\": \"quick_reply\",\n      \"id\": \"need_help\",\n      \"text\": \"‚ùì Ayuda\"\n    }\n  ];\n}\n\n// CONSTRUIR EL PAYLOAD COMPLETO PARA WHATSAPP\nconst whatsappPayload = {\n  \"to\": phoneNumber,\n  \"header\": {\n    \"title\": headerTitle,\n    \"hasMediaAttachment\": false\n  },\n  \"text\": messageText,\n  \"footer\": footerText,\n  \"buttons\": buttons\n};\n\n// RETORNAR EL PAYLOAD EN FORMATO N8N\nreturn [{\n  json: whatsappPayload\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        640,
        40
      ],
      "id": "e9cea8f7-f994-4157-846f-88c9697ef72d",
      "name": "Code"
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "id": "c055762a-8fe7-4141-a639-df2372f30060",
      "typeVersion": 1.1,
      "name": "datos",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        120,
        300
      ]
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{ $json.query }}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        340,
        300
      ],
      "id": "af3bc02b-71c6-405c-be45-750213e64bf8",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://us.api-wa.me/2522xe636258b15/message/button_reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $json.to }}"
            },
            {
              "name": "header",
              "value": "={{ $json.header }}"
            },
            {
              "name": "text",
              "value": "={{ $json.text }}"
            },
            {
              "name": "footer",
              "value": "={{ $json.footer }}"
            },
            {
              "name": "buttons",
              "value": "={{ $json.buttons }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1000,
        300
      ],
      "id": "a1c4bb62-416c-4bf4-b168-5ad19c3061c1",
      "name": "HTTP Request"
    }
  ],
  "pinData": {
    "datos": [
      {
        "json": {
          "query": "\n{\n  \"header\": {\n    \"type\": \"text\",\n    \"title\": \"Confirmaci√≥n de Pedido\"\n  },\n  \"text\": \"Cliente: 5492254423359\\n\\nüßæ Pedido:\\n- CABEZAL PILOTO ESKABE 2000/3000 KCAL. ‚Üí $17684,27\\n\\nTotal: $17684,27\\n¬øConfirm√°s este pedido?\",\n  \"footer\": \"Techno Gas\",\n  \"buttons\": [\n    {\n      \"type\": \"reply\",\n      \"reply\": {\n        \"id\": \"confirmar_pedido\",\n        \"title\": \"‚úÖ Confirmar\"\n      }\n    },\n    {\n      \"type\": \"reply\",\n      \"reply\": {\n        \"id\": \"cancelar_pedido\",\n        \"title\": \"‚ùå Cancelar\"\n      }\n    }\n  ]\n}\n"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-06-16T21:42:55.362Z",
  "versionId": "39591c0d-3c87-42a9-9329-4c2b78d2008d"
}