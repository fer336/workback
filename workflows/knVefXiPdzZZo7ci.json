{
  "active": false,
  "connections": {
    "Inbound": {
      "main": [
        [
          {
            "node": "Normalizacion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Normalizacion": {
      "main": [
        [
          {
            "node": "status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch type": {
      "main": [
        [
          {
            "node": "GET audio",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "Text content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GET audio": {
      "main": [
        [
          {
            "node": "Convert audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert audio": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "Audio content",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Audio content": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Text content": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "Chat input": {
      "main": [
        [
          {
            "node": "Chat Memory Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Push message buffer": {
      "main": [
        [
          {
            "node": "Get message bufer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get message bufer": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Delete message buffer",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Get message bufer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete message buffer": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "JSON parse",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JSON parse": {
      "main": [
        [
          {
            "node": "Switch type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Sort",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Chat input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Filtrar mensajes con URL de imagen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filtrar mensajes con URL de imagen": {
      "main": [
        [
          {
            "node": "Extraer URL de imagen y limpiar mensaje1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "buscar_productos": {
      "ai_tool": [
        [
          {
            "node": "AI",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "AI",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [],
        [
          {
            "node": "From Me2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "From Me2": {
      "main": [
        [
          {
            "node": "Push message buffer",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "status": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Envio al Grupo de Whatsapp": {
      "main": [
        [
          {
            "node": "Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat Memory Manager": {
      "main": [
        [
          {
            "node": "limpiamos msg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain1": {
      "main": [
        [
          {
            "node": "Envio al Grupo de Whatsapp",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenRouter Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Basic LLM Chain1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "calculate": {
      "ai_tool": [
        [
          {
            "node": "AI",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI": {
      "main": [
        [
          {
            "node": "Separa datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "txt": {
      "main": [
        [
          {
            "node": "jpg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "text": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Text Classifier",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "limpiamos msg": {
      "main": [
        [
          {
            "node": "Quitamos url",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Quitamos url": {
      "main": [
        [
          {
            "node": "Text Classifier",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sub Loop": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "txt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Chat Memory Manager",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "AI",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Extraer URL de imagen y limpiar mensaje1": {
      "main": [
        [
          {
            "node": "Sub Loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Separa datos": {
      "main": [
        [
          {
            "node": "Split Out1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "call_seller": {
      "ai_tool": [
        [
          {
            "node": "AI",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Text Classifier": {
      "main": [
        [
          {
            "node": "AI",
            "type": "main",
            "index": 0
          },
          {
            "node": "Basic LLM Chain1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        []
      ]
    },
    "IMAGEN": {
      "main": [
        [],
        [],
        []
      ]
    },
    "png": {
      "main": [
        []
      ]
    },
    "jpg": {
      "main": [
        [
          {
            "node": "Sub Loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "jpeg": {
      "main": [
        []
      ]
    }
  },
  "createdAt": "2025-08-01T10:16:22.807Z",
  "id": "knVefXiPdzZZo7ci",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "AGENTE MUEBLERIA copia",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "manager",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -2528,
        400
      ],
      "id": "d36c6843-cb82-439f-bcbe-2ab001947b0f",
      "name": "Inbound",
      "webhookId": "7f8d8de8-e1a8-4258-8963-311d6dee31f8"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1a2b64a9-d6f0-46dd-9fbc-494cbd87b4f7",
              "name": "instance.server_url",
              "value": "={{ $json.body.server_url }}",
              "type": "string"
            },
            {
              "id": "9c0dd914-b7e2-400f-9481-8089c12f11fc",
              "name": "instance.name",
              "value": "={{ $json.body.instance }}",
              "type": "string"
            },
            {
              "id": "1bdab8ea-6301-48f1-9124-b1a17462d63b",
              "name": "instance.apikey",
              "value": "={{ $json.body.apikey }}",
              "type": "string"
            },
            {
              "id": "db8ebb9e-b6d8-4b0f-b98b-d244e9b840af",
              "name": "message.message_id",
              "value": "={{ $json.body.data.key.id }}",
              "type": "string"
            },
            {
              "id": "25dbf636-a6f8-4554-97ec-790b94c86178",
              "name": "message.chat_id",
              "value": "={{ $json.body.data.key.remoteJid.replace(/\\D/g, '') }}",
              "type": "string"
            },
            {
              "id": "20f805d6-b026-454d-bcca-e76c7ac44edb",
              "name": "message.content_type",
              "value": "={{ $json.body.data.message.extendedTextMessage ? 'text': ''}}{{ $json.body.data.message.conversation ? 'text': ''}}{{ $json.body.data.message.audioMessage ? 'audio': ''}}{{ $json.body.data.message.imageMessage ? 'image': ''}}",
              "type": "string"
            },
            {
              "id": "486adbfc-47ae-4619-8ceb-d906e8272696",
              "name": "message.content",
              "value": "={{ $json.body.data.message.extendedTextMessage?.text ||  ''}}{{  $json.body.data.message.imageMessage?.caption || ''}}{{ $json.body.data.message.conversation || ''  }}",
              "type": "string"
            },
            {
              "id": "429863fe-528a-4afc-8b4f-cc68a6c6df3e",
              "name": "message.timestamp",
              "value": "={{ $json.body.date_time.toDateTime().toISO() }}",
              "type": "string"
            },
            {
              "id": "23d87dd3-7d39-4407-8e29-316923560dbf",
              "name": "user.name",
              "value": "={{ $json.body.data.pushName }}",
              "type": "string"
            },
            {
              "id": "07fe48f2-77ee-42be-9f37-f5856214bece",
              "name": "instance.number",
              "value": "={{ $json.body.sender }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2304,
        400
      ],
      "id": "03f0c631-932a-4c8c-801b-555755b1126b",
      "name": "Normalizacion"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.content_type }}",
                    "rightValue": "audio",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "7d4aeff7-e188-48b6-a33d-c92f8419abdb"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b9b82bf2-ed06-4fad-877d-b0dfb3b489f6",
                    "leftValue": "={{ $json.content_type }}",
                    "rightValue": "image",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Image"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "c414ac50-b8ff-4358-bed1-43e174554fe5",
                    "leftValue": "={{ $json.content_type }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Text"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Other"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        336,
        240
      ],
      "id": "9eceb8ea-5c65-41a2-8e6a-504052a0eb1e",
      "name": "Switch type"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Normalizacion').item.json.instance.server_url }}/chat/getBase64FromMediaMessage/{{ $('Normalizacion').item.json.instance.name }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Normalizacion').item.json.instance.apikey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message.key.id",
              "value": "={{ $('Normalizacion').item.json.message.message_id }}"
            },
            {
              "name": "convertToMp4",
              "value": "={{Boolean(false)}}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        560,
        176
      ],
      "id": "53d9408c-3aff-4362-a637-2e1a08d2cdd3",
      "name": "GET audio"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "base64",
        "options": {
          "mimeType": "={{ $json.mimetype }}"
        }
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        784,
        176
      ],
      "id": "f0417198-2bae-4921-9682-e91a80d5d0a9",
      "name": "Convert audio"
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.8,
      "position": [
        1008,
        176
      ],
      "id": "a2e799c5-7958-4fe7-8c53-0a5c4b768590",
      "name": "OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "tpho37KNAAX388pI",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4b82217d-2238-4b2e-9932-f1f308b9c2bc",
              "name": "content",
              "value": "={{ $json.text }}",
              "type": "string"
            },
            {
              "id": "4b44a1ab-373d-4595-a686-296e8e48233b",
              "name": "timestamp",
              "value": "={{ $('JSON parse').item.json.timestamp }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1232,
        176
      ],
      "id": "eda84a0a-4bd0-493b-8829-e7a31ecfa62b",
      "name": "Audio content"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "548bf0e8-90b9-4929-9cd4-d6e507dea74e",
              "name": "content",
              "value": "={{ $json.content }}",
              "type": "string"
            },
            {
              "id": "41d4896e-0d9d-4eb6-b414-31242a60ba04",
              "name": "timestamp",
              "value": "={{ $('JSON parse').item.json.timestamp }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1232,
        368
      ],
      "id": "66d3c587-7b71-4bc1-93dc-e1c62fa42002",
      "name": "Text content"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "061f39f8-c904-48f1-9921-2eb3acd43120",
              "name": "chat_input",
              "value": "={{ $json.messages.join('\\n') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2464,
        -864
      ],
      "id": "c73670e1-8d91-4310-8d17-2bbdb8f14e53",
      "name": "Chat input"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "message",
        "key": "={{ $('Normalizacion').item.json.message.chat_id }}_buffer",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -784,
        400
      ],
      "id": "4e7c1735-8e6a-4138-b95f-e63c613e0e60",
      "name": "Get message bufer",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Normalizacion').item.json.message.chat_id }}_buffer",
        "messageData": "={{ JSON.stringify( $('Normalizacion').item.json.message) }}",
        "tail": true
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1008,
        400
      ],
      "id": "54717a13-bcd6-4e82-882d-d9668ad285dc",
      "name": "Push message buffer",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ JSON.parse($json.message.last()).message_id}}",
                    "rightValue": "={{ $('Normalizacion').item.json.message.message_id }}",
                    "operator": {
                      "type": "string",
                      "operation": "notEquals"
                    },
                    "id": "0f802549-ccc6-4f68-8603-aba8a48dead3"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "No hacer nada"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "c1afb5c3-b5ff-4d9e-a5ba-16e806f97c7c",
                    "leftValue": "={{ DateTime.fromISO(JSON.parse($json.message.last()).timestamp, { zone: 'utc' }).setZone('America/Argentina/Buenos_Aires').toISO() }}",
                    "rightValue": "={{ $now.minus({ hours: 3, seconds: 5 }).toISO() }}\n",
                    "operator": {
                      "type": "dateTime",
                      "operation": "before"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Seguir"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Esperar"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -560,
        288
      ],
      "id": "2da36de2-6728-4be0-8a41-80c6575a9e4f",
      "name": "Switch"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -336,
        496
      ],
      "id": "ca056389-afd4-4351-b011-c4aeb6fc3468",
      "name": "Wait",
      "webhookId": "043b92f1-8200-4cca-b617-04186d5b3cae"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -336,
        80
      ],
      "id": "e80b0cec-a5a7-45db-b10a-905cf055faf6",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('Normalizacion').item.json.message.chat_id }}_buffer"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -336,
        272
      ],
      "id": "2f082121-adbd-4bf1-abb8-6dcbd6f997fe",
      "name": "Delete message buffer",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "message",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -112,
        272
      ],
      "id": "f234af4c-b7d5-44f5-83a7-7ca3b992c564",
      "name": "Split Out"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "=\n {{ JSON.parse($json.message) }}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        112,
        272
      ],
      "id": "557350a8-f7eb-42ed-add8-6dfa38913b05",
      "name": "JSON parse"
    },
    {
      "parameters": {
        "numberInputs": 3
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        1456,
        256
      ],
      "id": "9334c628-8daa-49a5-972d-2ef4d4c82d9d",
      "name": "Merge"
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "=timestamp"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        1680,
        272
      ],
      "id": "839c0f19-dc5d-458c-b4ca-bdc49cfeb032",
      "name": "Sort"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "content",
              "renameField": true,
              "outputFieldName": "messages"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1904,
        272
      ],
      "id": "5cc54da2-9605-4d16-bc01-fd80c330a5ce",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "fieldToSplitOut": "messages",
        "include": "allOtherFields",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -112,
        -720
      ],
      "id": "11dd187c-9970-44e5-967e-fd83e04d5c59",
      "name": "Split Out1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        304,
        -544
      ],
      "id": "95b2d79c-bcad-4277-8c51-fe59eee82e37",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "606499c8-7b8d-4fef-8681-1f7cbefa70fb",
              "leftValue": "={{ $json.messages.texto }}",
              "rightValue": "https?:\\/\\/.*\\.(jpe?g|png|gif|webp)",
              "operator": {
                "type": "string",
                "operation": "regex"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        512,
        -1120
      ],
      "id": "952b5fe9-aa0b-43bf-84d9-91b670620e85",
      "name": "Filtrar mensajes con URL de imagen"
    },
    {
      "parameters": {
        "sseEndpoint": "https://appwebhook.smartflow.uno/mcp/c2d2111a-f407-4eff-b7bb-407ac4260a4b/sse"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1,
      "position": [
        -880,
        -304
      ],
      "id": "7f7c0704-9f3c-41eb-9d52-da9b61b5261e",
      "name": "buscar_productos"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1,
      "position": [
        -704,
        -304
      ],
      "id": "e776e72f-80f0-47e7-925d-38a836e410d1",
      "name": "Think"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Normalizacion').last().json.instance.server_url }}/message/sendText/{{ $('Normalizacion').last().json.instance.name }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "={{ $('Normalizacion').last().json.instance.apikey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "5492254423359"
            },
            {
              "name": "text",
              "value": "={{ $json.text.replace(/\\\\n/g, '\\n') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -336,
        -1232
      ],
      "id": "1026af0b-f980-4f06-bada-84057f737777",
      "name": "Envio al Grupo de Whatsapp"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "94746291-c0f3-44f3-b635-1fe696d7d74e",
              "leftValue": "={{ $('Inbound').first().json.body.data.key.fromMe }}",
              "rightValue": "false",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            },
            {
              "id": "7216b3e8-2aeb-4512-bf22-8ad17559b9f5",
              "leftValue": "={{ $('Normalizacion').item.json.message.chat_id }}",
              "rightValue": "5492254423359",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "02b28e99-eacb-4071-b029-40118e354f3e",
      "name": "From Me2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1232,
        512
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "dedeb630-ea71-4ac7-808d-7401688ff128",
              "leftValue": "={{ $json.msg.grupo }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1456,
        400
      ],
      "id": "fbd801b0-10b8-4d43-b637-13f3e60ba4f3",
      "name": "If1"
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "BOT_STATUS",
        "key": "=status:{{ $json.message.chat_id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -2000,
        400
      ],
      "id": "d105f82e-2db4-43db-873e-0f25710f32aa",
      "name": "status",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "set",
        "key": "=status:{{ $('Normalizacion').item.json.message.chat_id }}",
        "value": "bot_off",
        "expire": true,
        "ttl": 600
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -112,
        -1232
      ],
      "id": "52362db9-f177-43b4-a600-02100ad0a4bb",
      "name": "Redis",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.memoryManager",
      "typeVersion": 1.1,
      "position": [
        -2208,
        -864
      ],
      "id": "ab1e1c22-0087-44ff-a46c-2bf7b1b762ac",
      "name": "Chat Memory Manager"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        928,
        -1104
      ],
      "id": "b0aca0ab-d65a-4918-a562-a3c1c48efcef",
      "name": "Wait1",
      "webhookId": "6deb4772-b5af-44c6-a211-502ce17487b6"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Mensaje del humano: {{ $json.msg.human }}\n\nContexto de la IA: {{ $json.msg.IA }}",
        "messages": {
          "messageValues": [
            {
              "message": "=Eres un asistente que genera mensajes para el grupo de ventas de Muebles San FermÃ­n.\n\nINSTRUCCIÃ“N PRINCIPAL: Analiza la conversaciÃ³n y genera ÃšNICAMENTE el mensaje en el formato que corresponda, sin agregar texto adicional.\n\n## CUANDO GENERAR CADA FORMATO:\n\n**FORMATO 1 - PEDIDO CONFIRMADO**: Cuando el cliente confirmÃ³ todos los datos del pedido\n**FORMATO 2 - ATENCIÃ“N HUMANA**: Cuando el cliente solicita hablar con un vendedor\n**FORMATO 3 - RECLAMO**: Cuando hay problemas con pedidos anteriores\n\n## FORMATOS DE MENSAJE:\n\n### Si es PEDIDO CONFIRMADO, usa EXACTAMENTE este formato:\n```\nğŸ”” PEDIDO CONFIRMADO #[fecha y hora actual]\n\nğŸ‘¤ CLIENTE: [Nombre] - [TelÃ©fono]\n\nğŸ“¦ PRODUCTOS:\nâ€¢ [Cantidad] x [Producto] - $[Precio]\nâ€¢ Total: $[Total]\n\nğŸ’° PAGO: [MÃ©todo] - Pendiente\n\nğŸ“ ENTREGA: [Retiro en showroom/EnvÃ­o a domicilio]\n\nâ“ CONSULTAS PENDIENTES:\nâ€¢ Ninguna\n\nâš ï¸ OBSERVACIONES:\nâ€¢ Sin observaciones\n\nâœ… PRÃ“XIMO PASO:\nâ†’ Preparar pedido y coordinar entrega/retiro\nâ†’ Confirmar horario con cliente\n```\n\n### Si es ATENCIÃ“N HUMANA, usa EXACTAMENTE este formato:\n```\nğŸ”” SOLICITUD DE ATENCIÃ“N HUMANA #\n\nğŸ‘¤ CLIENTE: [Nombre] - [TelÃ©fono]\n\nğŸ“‹ MOTIVO: [DescripciÃ³n breve]\n\nğŸ• URGENCIA: [Alta/Media/Baja]\n\nâœ… PRÃ“XIMO PASO:\nâ†’ Contactar al cliente\nâ†’ Tiempo sugerido: En las prÃ³ximas 2 horas\n```\n\n### Si es RECLAMO, usa EXACTAMENTE este formato:\n```\nğŸ”” RECLAMO #[fecha y hora]\n\nğŸ‘¤ CLIENTE: [Nombre] - [TelÃ©fono]\n\nâŒ PROBLEMA: [DescripciÃ³n]\n\nâœ… PRÃ“XIMO PASO:\nâ†’ PRIORIDAD ALTA: Contactar en menos de 1 hora\nâ†’ Preparar soluciÃ³n\n```\n\n## REGLAS IMPORTANTES:\n- NO agregues introducciones como \"### Para PEDIDOS:\"\n- NO expliques quÃ© informaciÃ³n necesitas\n- SOLO genera el mensaje en el formato correspondiente\n- Usa los datos exactos de la conversaciÃ³n\n- Respeta TODOS los saltos de lÃ­nea mostrados\n- Si falta algÃºn dato, usa \"No especificado\"\n- Para productos mÃºltiples, lista cada uno en una lÃ­nea separada con bullet point\n\n## EJEMPLO DE SALIDA CORRECTA:\n```\nğŸ”” PEDIDO CONFIRMADO #SÃ¡bado 2 de agosto 2025 a las 15:30\n\nğŸ‘¤ CLIENTE: Fernando Cassera - 5492254423359\n\nğŸ“¦ PRODUCTOS:\nâ€¢ 1 x ALACENA RUSIA - $30.200\nâ€¢ Total: $27.180\n\nğŸ’° PAGO: Efectivo - Pendiente\n\nğŸ“ ENTREGA: Retiro en showroom\n\nâ“ CONSULTAS PENDIENTES:\nâ€¢ Ninguna\n\nâš ï¸ OBSERVACIONES:\nâ€¢ Descuento 10% aplicado\n\nâœ… PRÃ“XIMO PASO:\nâ†’ Preparar pedido y coordinar entrega/retiro\nâ†’ Confirmar horario con cliente\n```"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -832,
        -1232
      ],
      "id": "a67e538d-beba-4795-8a52-18c50d41076d",
      "name": "Basic LLM Chain1"
    },
    {
      "parameters": {
        "model": "google/gemini-2.5-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -656,
        -944
      ],
      "id": "f4ff04f3-3f23-49ad-8784-972009fd9e17",
      "name": "OpenRouter Chat Model",
      "credentials": {
        "openRouterApi": {
          "id": "ADdm45cFSIFSG59w",
          "name": "Gemini"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        -528,
        -304
      ],
      "id": "ec82bd52-2d12-4799-91ce-5754d35fecd2",
      "name": "calculate"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "= {{ $('Chat input').last().json.chat_input}}",
        "options": {
          "systemMessage": "=# Prompt para Sole - Asistente Virtual de Muebles San FermÃ­n\n\n## ğŸ§  ROLE\n\nTu nombre es \"Sole\" y sos la asistente virtual de atenciÃ³n comercial de **Muebles San FermÃ­n**, una fÃ¡brica especializada en **muebles de pino crudo sin pintar** con precios accesibles para venta **mayorista y minorista**. Tu objetivo es guiar a los clientes paso a paso desde la exploraciÃ³n inicial hasta completar TODOS los datos necesarios antes de derivar a un humano.\n\n> *Emotional Prompt:*  \n> Cada paso que das con el cliente es crucial. Tu paciencia y profesionalismo al recolectar cada dato asegura que el asesor humano pueda cerrar la venta sin interrupciones. Sos el puente perfecto entre el interÃ©s y la compra concreta.\n\n---\n\n## âœ… TASK - FLUJO PASO A PASO\n\n### FASE 1: EXPLORACIÃ“N Y SELECCIÃ“N\n\n**Paso 1 - Saludo**\n> \"Hola ğŸ‘‹ Soy Sole, tu asistente virtual de *Muebles San FermÃ­n*. Estoy acÃ¡ para ayudarte a encontrar el mueble perfecto para tu espacio ğŸ   \n> Â¿QuÃ© tipo de mueble estÃ¡s buscando hoy?\"\n\n**Paso 2 - Identificar necesidad**\n- Esperar respuesta del cliente\n- Preguntar: \"Â¿Es para tu hogar o para un negocio?\"\n- Usar `buscar_productos(categoria)`\n\n**Paso 3 - Mostrar productos**\n```\n\"Te muestro 2 opciones que tenemos disponibles:\n\n\n1. [NOMBRE]: \n. ğŸ’µ Precio: $[PRECIO]\n. ğŸ“ Medidas: [medidas]\n [URL]\n\n\n2. [NOMBRE]: \n. ğŸ’µ Precio: $[PRECIO]\n. ğŸ“ Medidas: [medidas]\n [URL]\n\n\nÂ¿Te interesa alguno de estos modelos?\"\n```\n\n**Paso 4 - Confirmar selecciÃ³n**\n- Cliente elige por nÃºmero\n- Responder: \"Â¡Excelente elecciÃ³n! El [NOMBRE] es ideal ğŸŒŸ\"\n- Preguntar: \"Â¿CuÃ¡ntas unidades necesitÃ¡s?\"\n\n**Paso 5 - CotizaciÃ³n**\n```\n\"ğŸ“‹ Tu cotizaciÃ³n:\nâ€¢ {X} unidades de {PRODUCTO}  \nâ€¢ Precio unitario: ${PRECIO}\nâ€¢ TOTAL: ${TOTAL}\n\nÂ¿Te gustarÃ­a avanzar con este pedido?\"\n```\n\n### FASE 2: RECOLECCIÃ“N DE DATOS (OBLIGATORIA)\n\nSi el cliente confirma, iniciar recolecciÃ³n paso a paso:\n\n**Paso 6 - Inicio de datos**\n> \"Â¡Genial! Para preparar tu pedido voy a necesitar algunos datos ğŸ“  \n> Â¿CuÃ¡l es tu nombre completo?\"\n\n**Paso 7 - Email**\n- Esperar nombre\n- Guardar respuesta\n- Preguntar: \"Perfecto [NOMBRE]! Â¿CuÃ¡l es tu correo electrÃ³nico?\"\n\n**Paso 8 - Confirmar telÃ©fono**\n- Esperar email\n- Validar formato bÃ¡sico\n- Preguntar: \"Â¿Este es tu nÃºmero de WhatsApp: {telefono}?\" \n- Si dice \"No\": \"Â¿CuÃ¡l es el nÃºmero correcto donde podemos contactarte?\"\n- Si dice \"SÃ­\": Continuar al siguiente paso\n\n**Paso 9 - MÃ©todo de pago**\n- Preguntar: \n  > \"Â¿CÃ³mo te gustarÃ­a pagar tu pedido?  \n  > ğŸ’µ Efectivo (10% descuento en showroom)  \n  > ğŸ’³ Tarjetas  \n  > ğŸ“± Mercado Pago  \n  > ğŸ¦ Transferencia\"\n\n**Paso 10 - MÃ©todo de entrega**\n- Esperar mÃ©todo de pago\n- Si eligiÃ³ efectivo, actualizar precio con descuento\n- Preguntar: \"Â¿PreferÃ­s retirar en nuestro showroom o necesitÃ¡s envÃ­o a domicilio?\"\n\n**Paso 11 - DirecciÃ³n (solo si eligiÃ³ envÃ­o)**\n- Si eligiÃ³ envÃ­o: \"Â¿CuÃ¡l es la direcciÃ³n completa donde entregarÃ­amos?\"\n- Si eligiÃ³ retiro: \"Perfecto! Te esperamos en Arenales 1297, San Fernando\"\n\n### FASE 3: CONFIRMACIÃ“N Y DERIVACIÃ“N\n\n**Paso 12 - Resumen completo**\n```\n\"âœ… CONFIRMEMOS TUS DATOS:\n\nğŸ‘¤ INFORMACIÃ“N PERSONAL:\nâ€¢ Nombre: [NOMBRE]\nâ€¢ Email: [EMAIL]\nâ€¢ WhatsApp: {telefono}\n\nğŸ“¦ TU PEDIDO:\nâ€¢ [CANTIDAD] x [PRODUCTO]\nâ€¢ Subtotal: $[SUBTOTAL]\n[Si hay descuento]\nâ€¢ Descuento 10% efectivo: -$[DESCUENTO]\nâ€¢ TOTAL FINAL: $[TOTAL_FINAL]\n\nğŸ’° Forma de pago: [MÃ‰TODO]\nğŸšš Entrega: [RETIRO/ENVÃO + DIRECCIÃ“N]\n\nÂ¿Todos los datos estÃ¡n correctos? (RespondÃ© SÃ­ o No)\"\n```\n\n**Paso 13 - ValidaciÃ³n final**\n- Si responde \"No\": \"Â¿QuÃ© dato necesitÃ¡s corregir?\"\n- Volver al paso correspondiente\n- Si responde \"SÃ­\": Continuar al paso 14\n\n**Paso 14 - DerivaciÃ³n (SOLO con datos completos)**\n> \"Â¡Perfecto! ğŸ‰ Ya tengo toda tu informaciÃ³n. En los prÃ³ximos minutos un asesor se va a comunicar a este WhatsApp para confirmar tu pedido y coordinar los detalles finales.  \n> Â¡Gracias por elegir Muebles San FermÃ­n! ğŸªµ\"\n\n---\n\n## ğŸ¯ REGLAS CRÃTICAS\n\n### Variables del Sistema:\n- `{telefono}`: NÃºmero de WhatsApp del cliente (obtenido automÃ¡ticamente)\n- Usar esta variable cuando necesites mostrar o confirmar el nÃºmero\n\n### Control de Flujo:\n- **NUNCA** saltear pasos\n- **SIEMPRE** esperar la respuesta antes de continuar\n- **NO** hacer mÃºltiples preguntas en un mismo mensaje\n- **NO** derivar sin completar TODOS los pasos\n\n### Validaciones:\n- Si falta algÃºn dato: \"DisculpÃ¡ [NOMBRE], pero necesito tu [dato] para poder procesar el pedido\"\n- Si da respuesta vaga: \"Para poder ayudarte mejor, Â¿podrÃ­as darme [dato especÃ­fico]?\"\n- Si no quiere dar un dato: \"Entiendo tu preocupaciÃ³n, pero sin [dato] no puedo completar tu pedido ğŸ˜”\"\n\n### Manejo de interrupciones:\n\n**Cliente cambia de opiniÃ³n sobre producto:**\n> \"No hay problema! Volvamos a buscar. Â¿QuÃ© tipo de mueble preferÃ­s ver?\"\n[Volver al Paso 2]\n\n**Cliente abandona en medio del proceso:**\n> \"Â¡No hay problema! Tu cotizaciÃ³n queda guardada. Cuando quieras continuar, acÃ¡ estarÃ© ğŸ˜Š\"\n\n**Cliente con prisa:**\n> \"Entiendo que tenÃ©s poco tiempo. Igual necesito estos datos para que el asesor pueda ayudarte. Son solo unos segunditos mÃ¡s ğŸ™\"\n\n**Cliente quiere hablar con humano sin datos:**\n> \"Por supuesto! Pero para conectarte con un asesor necesito primero completar tus datos bÃ¡sicos. AsÃ­ puede llamarte con toda la informaciÃ³n lista. Â¿CuÃ¡l es tu nombre completo?\"\n\n---\n\n## ğŸ¯ SPECIFIC BEHAVIORS\n\n### GestiÃ³n de Datos:\n- **NUNCA** derivar sin tener TODOS los datos completos\n- Recolectar informaciÃ³n de forma conversacional, no como formulario\n- Los datos requeridos son: Nombre, Email, TelÃ©fono (confirmado), MÃ©todo de pago, MÃ©todo de entrega, DirecciÃ³n (si es envÃ­o)\n\n### Uso de Tools:\n- `think` : Antes de utilizar cualquier herramienta debes usar esta si o si para poder seguir adelante\n- `buscar_productos(categoria)`: SIEMPRE que el cliente solicite ver productos\n- `calculate(price, cantidad)`: Para todos los cÃ¡lculos\n- Solo mostrar productos con **stock = TRUE**\n- `call_seller` : Llama a esta tool cuando un usuario necesite hablar con un vendedor, pero antes debes obtener los datos, nombre,correo y telefono una vez obtenido esto ejecutas la herramienta, sin esta informaciÃ³n no debes ejecutar esta herramienta, es `CRITICO`. enviar esta informacion:\n\n```\nğŸ”” SOLICITUD DE ATENCIÃ“N HUMANA #\n\nğŸ‘¤ CLIENTE: [Nombre] - [TelÃ©fono]\n\nğŸ“‹ MOTIVO: [DescripciÃ³n breve]\n\nğŸ• URGENCIA: [Alta/Media/Baja]\n\nâœ… PRÃ“XIMO PASO:\n\nâ†’ Contactar al cliente\nâ†’ Tiempo sugerido: En las prÃ³ximas 2 horas\n```\n\n### Estilo de ComunicaciÃ³n:\n- Usar emojis estratÃ©gicamente (no mÃ¡s de 2 por mensaje)\n- Mantener mensajes concisos (mÃ¡ximo 3-4 lÃ­neas)\n- Incluir SIEMPRE las medidas del producto desde 'description'\n- Una pregunta por mensaje\n\n### InformaciÃ³n del Showroom:\n**Si pregunta por showroom:**\n> \"ğŸ“ Nos encontrÃ¡s en **Arenales 1297, San Fernando (Buenos Aires)**  \n> Horarios: Lun a Vie 7-13h y 14-18h  \n> ğŸ’° 10% OFF pagando efectivo en el local\"\n\n---\n\n## âš™ï¸ CONTEXT\n\n- **Empresa**: Muebles San FermÃ­n - FÃ¡brica familiar desde 1985\n- **Productos**: Muebles de pino crudo sin pintar, personalizables\n- **Ventaja competitiva**: Precios directos de fÃ¡brica\n- **PÃºblico**: Familias y pequeÃ±os negocios buscando calidad-precio\n- **Descuento especial**: 10% efectivo en showroom\n- **EnvÃ­os**: A toda provincia de Buenos Aires\n- **Base de datos**: PostgreSQL con campos: product, price, image_url, description, stock\n- **Canal**: WhatsApp (via Evolution API)\n- **El bot deriva al humano cuando**: El cliente confirma todos los datos correctos\n\n---\n\n## ğŸ“‹ EJEMPLO COMPLETO DE CONVERSACIÃ“N\n\n```\nSole: \"Hola ğŸ‘‹ Soy Sole, tu asistente virtual de Muebles San FermÃ­n. Estoy acÃ¡ para ayudarte a encontrar el mueble perfecto para tu espacio ğŸ \n\nÂ¿QuÃ© tipo de mueble estÃ¡s buscando hoy?\"\n\nCliente: \"Una mesa de luz\"\n\nSole: \"Â¡Perfecto! Mesa de luz. Â¿Es para tu hogar o para un negocio?\"\n\nCliente: \"Para mi casa\"\n\n[buscar_productos(mesas de luz)]\n\nSole: \"Te muestro 2 opciones que tenemos disponibles:\n\n1. [NOMBRE]: \n. ğŸ’µ Precio: $[PRECIO]\n. ğŸ“ Medidas: [medidas]\n [URL]\n\n\n2. [NOMBRE]: \n. ğŸ’µ Precio: $[PRECIO]\n. ğŸ“ Medidas: [medidas]\n [URL]\n\nÂ¿Te interesa alguno de estos modelos?\"\n\nCliente: \"La primera\"\n\nSole: \"Â¡Excelente elecciÃ³n! La Mesa de ***** es ideal ğŸŒŸ\nÂ¿CuÃ¡ntas unidades necesitÃ¡s?\"\n\nCliente: \"2\"\n\nSole: \"ğŸ“‹ Tu cotizaciÃ³n:\nâ€¢ 2 unidades de MESA DE LUZ NÃ“RDICA\nâ€¢ Precio unitario: $22.500\nâ€¢ TOTAL: $45.000\n\nÂ¿Te gustarÃ­a avanzar con este pedido?\"\n\nCliente: \"SÃ­\"\n\nSole: \"Â¡Genial! Para preparar tu pedido voy a necesitar algunos datos ğŸ“\nÂ¿CuÃ¡l es tu nombre completo?\"\n\nCliente: \"Juan PÃ©rez\"\n\nSole: \"Perfecto Juan! Â¿CuÃ¡l es tu correo electrÃ³nico?\"\n\nCliente: \"juanperez@gmail.com\"\n\nSole: \"Â¿Este es tu nÃºmero de WhatsApp: 11-4444-4444?\"\n\nCliente: \"SÃ­\"\n\nSole: \"Â¿CÃ³mo te gustarÃ­a pagar tu pedido?\nğŸ’µ Efectivo (10% descuento en showroom)\nğŸ’³ Tarjetas\nğŸ“± Mercado Pago\nğŸ¦ Transferencia\"\n\nCliente: \"Efectivo\"\n\nSole: \"Â¡Excelente! Con efectivo tenÃ©s un 10% de descuento ğŸ‰\nÂ¿PreferÃ­s retirar en nuestro showroom o necesitÃ¡s envÃ­o a domicilio?\"\n\nCliente: \"Retiro yo\"\n\nSole: \"Perfecto! Te esperamos en Arenales 1297, San Fernando\n\nâœ… CONFIRMEMOS TUS DATOS:\n\nğŸ‘¤ INFORMACIÃ“N PERSONAL:\nâ€¢ Nombre: Juan PÃ©rez\nâ€¢ Email: juanperez@gmail.com\nâ€¢ WhatsApp: 11-4444-4444\n\nğŸ“¦ TU PEDIDO:\nâ€¢ 2 x MESA DE LUZ NÃ“RDICA\nâ€¢ Subtotal: $45.000\nâ€¢ Descuento 10% efectivo: -$4.500\nâ€¢ TOTAL FINAL: $40.500\n\nğŸ’° Forma de pago: Efectivo\nğŸšš Entrega: Retiro en showroom\n\nÂ¿Todos los datos estÃ¡n correctos? (RespondÃ© SÃ­ o No)\"\n\nCliente: \"SÃ­\"\n\nSole: \"Â¡Perfecto! ğŸ‰ Ya tengo toda tu informaciÃ³n. En los prÃ³ximos minutos un asesor se va a comunicar a este WhatsApp para confirmar tu pedido y coordinar los detalles finales.\nÂ¡Gracias por elegir Muebles San FermÃ­n! ğŸªµ\"\n```\n\n---\n\n## ğŸ“ NOTAS IMPORTANTES\n\n1. **Orden estricto**: Los pasos deben seguirse en el orden establecido\n2. **Una pregunta por vez**: Nunca hacer mÃºltiples preguntas en un mensaje\n3. **ConfirmaciÃ³n obligatoria**: El cliente DEBE confirmar que todos los datos estÃ¡n correctos\n4. **Sin datos = Sin derivaciÃ³n**: NUNCA derivar a un humano sin completar todos los pasos\n5. **TelÃ©fono automÃ¡tico**: El nÃºmero se obtiene de WhatsApp, solo confirmar con el cliente\n6. **Fecha de hoy es :** {{ $now.setLocale('es').toFormat('EEEE d \\'de\\' MMMM yyyy \\'a las\\' H:mm') }}\n---\n\nReferirse a esta variable por numero de telefono \n{telefono} = {{ $('Normalizacion').item.json.message.chat_id }}\n",
          "maxIterations": 5
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -832,
        -720
      ],
      "id": "56c48a54-0666-413b-8887-94c64349cdbd",
      "name": "AI"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Normalizacion').last().json.instance.server_url }}/message/sendText/{{ $('Normalizacion').last().json.instance.name }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "={{ $('Normalizacion').last().json.instance.apikey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{$('Normalizacion').last().json.message.chat_id}}"
            },
            {
              "name": "text",
              "value": "={{ $json.messages.texto }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1760,
        -336
      ],
      "id": "c157508c-9896-432c-a429-9426af0acbde",
      "name": "txt"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Normalizacion').last().json.instance.server_url }}/message/sendText/{{ $('Normalizacion').last().json.instance.name }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "={{ $('Normalizacion').last().json.instance.apikey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{$('Normalizacion').last().json.message.chat_id}}"
            },
            {
              "name": "text",
              "value": "={{ $json.messages.texto.replace(/\\\\n/g, '\\n') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1152,
        -1008
      ],
      "id": "8e8fa38d-f690-497c-b22e-7bad028c7aef",
      "name": "text"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-nano",
          "mode": "list",
          "cachedResultName": "gpt-4.1-nano"
        },
        "options": {
          "temperature": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -1616,
        -464
      ],
      "id": "55606ef6-8c85-45e8-9fdd-5b402230d088",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "tpho37KNAAX388pI",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e325c5b3-b99c-43da-a5c8-a478c9048312",
              "name": "msg.IA",
              "value": "={{ $json.messages.slice(-2) }}",
              "type": "string"
            },
            {
              "id": "9c1b9005-d6a7-4781-9b46-111eef3ba0ce",
              "name": "msg.original",
              "value": "={{ $('Normalizacion').first()?.json?.message?.content ||$('Merge').item.json.content  }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1792,
        -864
      ],
      "id": "7bfbc9b5-bdbe-40e1-94f4-93e1f75fbc0d",
      "name": "limpiamos msg"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f2c0bf80-c0fb-42df-aaa0-3c7c5233eebd",
              "name": "msg.IA",
              "value": "={{ (typeof $json.msg.IA === 'string' ? JSON.parse($json.msg.IA) : $json.msg.IA).map(obj => `Human: ${obj.human} IA: ${obj.ai}`).join(' ').replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, '$1').replace(/https?:\\/\\/[^\\s]+/g, '').replace(/\\s+/g, ' ').trim() }}",
              "type": "string"
            },
            {
              "id": "a594ea46-3927-4c3f-bf63-4f1f68a37308",
              "name": "msg.human",
              "value": "={{ $json.msg.original }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1568,
        -864
      ],
      "id": "5127bfb3-a7ae-44f7-bfbb-29d3915cae81",
      "name": "Quitamos url"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "534838aa-8344-4a94-9a0a-60597aef677f",
              "leftValue": "={{ $json.BOT_STATUS }}",
              "rightValue": "bot_off",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1728,
        288
      ],
      "id": "e8681f5a-fb9d-4e08-9b1d-d1762b1a2a75",
      "name": "If"
    },
    {
      "parameters": {
        "content": "## Le damos contexto al Clasificador",
        "height": 320,
        "width": 448,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2304,
        -976
      ],
      "typeVersion": 1,
      "id": "d0405911-b3f2-4768-8647-26208a3ebe41",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Limpiamos los msg con url para que no de error",
        "height": 320,
        "width": 400,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1824,
        -976
      ],
      "typeVersion": 1,
      "id": "d9d23b74-5961-4b89-ab39-da03a5f6b7a1",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "### Limpiamos mensajes del Agente y lo particionamos, Quitamos Signos de apertura",
        "height": 224,
        "width": 304,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -448,
        -800
      ],
      "typeVersion": 1,
      "id": "a319489a-ac5c-4a1b-9202-e14cd351838c",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "options": {
          "reset": "={{ $('Sub Loop').context.done}}"
        }
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1392,
        -352
      ],
      "id": "36af3017-8420-478f-9950-587718e27d38",
      "name": "Sub Loop"
    },
    {
      "parameters": {
        "content": "### Agregamos sublooping para el envio de mensajes",
        "height": 448,
        "width": 1056,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1232,
        -480
      ],
      "typeVersion": 1,
      "id": "da4ae93e-5128-42f8-8c95-f5ccaad04088",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "### Limpiamos texto y dividimos el mensaje.",
        "height": 256,
        "width": 304,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        416,
        -1216
      ],
      "typeVersion": 1,
      "id": "0c282b9c-9b94-4dd0-89e2-0bc8a9dc6d6a",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "### Estado Bot",
        "height": 224,
        "width": 288,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2096,
        336
      ],
      "typeVersion": 1,
      "id": "d5901c35-0b6a-4755-97e8-276669df627c",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Normalizacion').item.json.message.chat_id }}",
        "sessionTTL": 1800,
        "contextWindowLength": 6
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        -1648,
        -128
      ],
      "id": "36482de5-cb54-4b6b-b937-1cc0ed896277",
      "name": "Redis Chat Memory",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "content": "### Valida Bot",
        "height": 176,
        "width": 192,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1776,
        240
      ],
      "typeVersion": 1,
      "id": "ab038695-7a3c-4df7-a79a-f89b4600fab3",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "content": "### Delete Memorie",
        "height": 192,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1904,
        -1312
      ],
      "typeVersion": 1,
      "id": "d2506b4d-4b24-4d52-93e3-6219d321cccb",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "content": "### Delete Status Bot",
        "height": 192,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1616,
        -1312
      ],
      "typeVersion": 1,
      "id": "675649aa-ec51-4781-9f8a-1dcab860ee75",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=5492254423359"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1856,
        -1264
      ],
      "id": "7adf6f41-f733-4f53-88df-d3d5a4dd1ee1",
      "name": "memoria",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=status:5492254423359"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -1552,
        -1264
      ],
      "id": "cf44b8e2-4194-4b47-b1fb-4f40fecd8f7d",
      "name": "status bot",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const inputData = $input.first().json;\n\n// Verificar si existe el campo messages.texto\nif (!inputData.messages || !inputData.messages.texto) {\n  return {\n    ...inputData,\n    url: '',\n    urls: [],\n    productoFormateado: null,\n    textoLimpio: '',\n    urlsFormateadas: ''\n  };\n}\n\nconst input = inputData.messages.texto;\n\n// Regex para diferentes tipos de URLs\nconst markdownLinkRegex = /\\[([^\\]]*)\\]\\(([^)]+)\\)/g;\nconst imageRegex = /!\\[([^\\]]*)\\]\\(([^)]+)\\)/g;\nconst directUrlRegex = /(https?:\\/\\/[^\\s<>\"{}|\\\\^\\[\\]`]+)/g;\n\n// Arrays para almacenar URLs y productos\nconst urls = [];\nlet cleanedMessage = input;\n\n// Primero, extraer todas las URLs para evitar duplicados\nconst todasLasUrls = new Set();\n\n// Extraer imÃ¡genes markdown\nlet imageMatch;\nwhile ((imageMatch = imageRegex.exec(input)) !== null) {\n  todasLasUrls.add(imageMatch[2]);\n  urls.push({\n    type: 'image',\n    text: imageMatch[1] || 'imagen',\n    url: imageMatch[2],\n    fullMatch: imageMatch[0]\n  });\n}\n\n// Extraer enlaces markdown\nlet linkMatch;\nwhile ((linkMatch = markdownLinkRegex.exec(input)) !== null) {\n  if (!todasLasUrls.has(linkMatch[2])) {\n    todasLasUrls.add(linkMatch[2]);\n    urls.push({\n      type: 'link',\n      text: linkMatch[1] || 'enlace',\n      url: linkMatch[2],\n      fullMatch: linkMatch[0]\n    });\n  }\n}\n\n// Reemplazar todos los markdown links e imÃ¡genes\nurls.forEach(urlObj => {\n  if (urlObj.fullMatch) {\n    cleanedMessage = cleanedMessage.replace(urlObj.fullMatch, '');\n  }\n});\n\n// Buscar URLs directas que no hayan sido capturadas antes\nlet directMatch;\nconst tempMessage = cleanedMessage;\nwhile ((directMatch = directUrlRegex.exec(tempMessage)) !== null) {\n  if (!todasLasUrls.has(directMatch[1])) {\n    todasLasUrls.add(directMatch[1]);\n    urls.push({\n      type: 'direct',\n      text: 'enlace',\n      url: directMatch[1]\n    });\n  }\n}\n\n// Eliminar todas las URLs directas del mensaje\nurls.forEach(urlObj => {\n  if (urlObj.type === 'direct') {\n    cleanedMessage = cleanedMessage.replace(urlObj.url, '');\n  }\n});\n\n// FunciÃ³n mejorada para extraer informaciÃ³n del producto\nfunction extraerInfoProducto(texto, urls) {\n  const info = {\n    nombre: '',\n    precio: '',\n    medidas: '',\n    foto: ''\n  };\n  \n  // Buscar precio con diferentes formatos\n  const precioMatch = texto.match(/(?:precio|costo|valor|price)[\\s:]*\\$?\\s*([\\d,]+(?:\\.\\d{2})?)/i);\n  if (precioMatch) {\n    info.precio = '$' + precioMatch[1].replace(/[,\\s]/g, '');\n  }\n  \n  // Buscar medidas con diferentes formatos\n  const medidasMatch = texto.match(/(?:medidas?|dimensiones?|tamaÃ±o|size)[\\s:]*([\\d.,]+\\s*x\\s*[\\d.,]+(?:\\s*x\\s*[\\d.,]+)?(?:\\s*(?:cm|m|mm|metros?|centÃ­metros?))?)/i);\n  if (medidasMatch) {\n    info.medidas = medidasMatch[1].trim();\n  }\n  \n  // Extraer nombre del producto\n  const lineas = texto.split('\\n').map(l => l.trim()).filter(l => l);\n  for (const linea of lineas) {\n    // Buscar lÃ­neas que parezcan ser el nombre del producto\n    if (!linea.match(/precio|medidas|dimensiones|\\$|https?:|costo|valor|size/i) && \n        linea.length > 3 && \n        !linea.match(/^\\d+$/) && // No solo nÃºmeros\n        !linea.match(/^[\\d.,]+\\s*x\\s*[\\d.,]+/)) { // No medidas\n      info.nombre = linea;\n      break;\n    }\n  }\n  \n  // Buscar la primera imagen URL\n  const imagenUrl = urls.find(u => u.type === 'image');\n  if (imagenUrl) {\n    info.foto = imagenUrl.url;\n  }\n  \n  return info;\n}\n\n// Limpiar y formatear el texto para WhatsApp\nfunction formatearParaWhatsApp(texto) {\n  // Eliminar espacios mÃºltiples y lÃ­neas vacÃ­as excesivas\n  let textoFormateado = texto\n    .split('\\n')\n    .map(linea => linea.trim())\n    .filter(linea => linea.length > 0)\n    .join('\\n');\n  \n  // Eliminar caracteres especiales que puedan causar problemas\n  textoFormateado = textoFormateado\n    .replace(/\\s{2,}/g, ' ') // MÃºltiples espacios a uno solo\n    .replace(/\\n{3,}/g, '\\n\\n') // MÃ¡ximo 2 saltos de lÃ­nea consecutivos\n    .replace(/^\\s+|\\s+$/g, '') // Trim general\n    .replace(/[.,;:!?]+$/g, ''); // Eliminar puntuaciÃ³n final innecesaria\n  \n  // Eliminar puntos finales en cada lÃ­nea si no son necesarios\n  textoFormateado = textoFormateado\n    .split('\\n')\n    .map(linea => linea.replace(/\\.$/, ''))\n    .join('\\n');\n  \n  return textoFormateado;\n}\n\n// Formatear URLs para WhatsApp\nfunction formatearUrlsParaWhatsApp(urls) {\n  if (urls.length === 0) return '';\n  \n  let urlsFormateadas = '\\nğŸ“ *Enlaces encontrados:*\\n';\n  \n  urls.forEach((urlObj, index) => {\n    if (urlObj.type === 'image') {\n      urlsFormateadas += `\\nğŸ–¼ï¸ Imagen ${index + 1}:\\n${urlObj.url}\\n`;\n    } else {\n      urlsFormateadas += `\\nğŸ”— ${urlObj.text}:\\n${urlObj.url}\\n`;\n    }\n  });\n  \n  return urlsFormateadas;\n}\n\n// Extraer informaciÃ³n del producto\nconst productoInfo = extraerInfoProducto(cleanedMessage, urls);\n\n// Formatear texto limpio\nconst textoLimpio = formatearParaWhatsApp(cleanedMessage);\n\n// Formatear URLs\nconst urlsFormateadas = formatearUrlsParaWhatsApp(urls);\n\n// Formatear la salida del producto\nlet productoFormateado = '';\nif (productoInfo.nombre || productoInfo.precio || productoInfo.medidas) {\n  productoFormateado = 'ğŸ“¦ *INFORMACIÃ“N DEL PRODUCTO*\\n\\n';\n  productoFormateado += `*NOMBRE:* ${productoInfo.nombre || 'No especificado'}\\n`;\n  productoFormateado += `*PRECIO:* ${productoInfo.precio || 'No especificado'}\\n`;\n  productoFormateado += `*MEDIDAS:* ${productoInfo.medidas || 'No especificadas'}\\n`;\n  productoFormateado += `*FOTO:* ${productoInfo.foto || 'No disponible'}`;\n}\n\n// Crear mensaje completo para WhatsApp\nconst mensajeWhatsApp = textoLimpio + \n  (productoFormateado ? '\\n\\n' + productoFormateado : '') + \n  (urlsFormateadas ? '\\n' + urlsFormateadas : '');\n\n// Crear el objeto de salida\nconst output = {\n  ...inputData,\n  messages: {\n    ...inputData.messages,\n    texto: cleanedMessage,\n    textoOriginal: inputData.messages.texto,\n    textoLimpio: textoLimpio,\n    mensajeWhatsApp: mensajeWhatsApp\n  },\n  url: urls.length > 0 ? urls[0].url : '',\n  urls: urls,\n  urlsFormateadas: urlsFormateadas,\n  urlCount: urls.length,\n  productoInfo: productoInfo,\n  productoFormateado: productoFormateado\n};\n\nreturn output;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        976,
        -768
      ],
      "id": "cb25ed9e-8c65-49dd-9dc3-229ec32306a3",
      "name": "Extraer URL de imagen y limpiar mensaje1"
    },
    {
      "parameters": {
        "jsCode": "// --- Funciones de procesamiento de texto ---\n\n// FunciÃ³n para dividir texto en fragmentos con tiempo de lectura\nfunction splitTextIntoChunks(text, maxChars = 200) {\n  // Si el texto es muy corto, devolvemos un solo fragmento\n  if (!text || text.length <= maxChars) {\n    return [{\n      parte: 1,\n      texto: text || '',\n      time: calculateReadingTime(text || '')\n    }];\n  }\n\n  const chunks = [];\n  let currentChunk = '';\n  let partNumber = 1;\n  \n  // Dividimos por palabras para no cortar palabras a la mitad\n  const words = text.split(' ');\n  \n  for (let i = 0; i < words.length; i++) {\n    const word = words[i];\n    const potentialChunk = currentChunk ? currentChunk + ' ' + word : word;\n    \n    // Si agregar la siguiente palabra excede el lÃ­mite\n    if (potentialChunk.length > maxChars) {\n      // Si la palabra sola es mÃ¡s larga que maxChars, la cortamos\n      if (word.length > maxChars) {\n        // Guardamos el chunk actual si tiene contenido\n        if (currentChunk) {\n          chunks.push({\n            parte: partNumber++,\n            texto: currentChunk.trim(),\n            time: calculateReadingTime(currentChunk.trim())\n          });\n        }\n        \n        // Cortamos la palabra larga en pedazos\n        let remainingWord = word;\n        while (remainingWord.length > maxChars) {\n          chunks.push({\n            parte: partNumber++,\n            texto: remainingWord.substring(0, maxChars),\n            time: calculateReadingTime(remainingWord.substring(0, maxChars))\n          });\n          remainingWord = remainingWord.substring(maxChars);\n        }\n        \n        // El resto de la palabra se convierte en el nuevo currentChunk\n        currentChunk = remainingWord;\n      } else {\n        // Guardamos el chunk actual y empezamos uno nuevo con esta palabra\n        chunks.push({\n          parte: partNumber++,\n          texto: currentChunk.trim(),\n          time: calculateReadingTime(currentChunk.trim())\n        });\n        currentChunk = word;\n      }\n    } else {\n      // Si cabe, agregamos la palabra al chunk actual\n      currentChunk = potentialChunk;\n    }\n  }\n  \n  // Agregar el Ãºltimo chunk si queda algo\n  if (currentChunk.trim()) {\n    chunks.push({\n      parte: partNumber,\n      texto: currentChunk.trim(),\n      time: calculateReadingTime(currentChunk.trim())\n    });\n  }\n  \n  return chunks;\n}\n\n// FunciÃ³n para calcular el tiempo de lectura basado en la longitud del texto\nfunction calculateReadingTime(text) {\n  const length = text.length;\n  \n  if (length > 150) {\n    return 4; // segundos\n  } else if (length >= 50) {\n    return 3; // segundos\n  } else {\n    return 1; // segundo\n  }\n}\n\n// FunciÃ³n para determinar si un texto necesita ser dividido\nfunction needsSplitting(text) {\n  if (!text || typeof text !== 'string') return false;\n  \n  // Criterios: mÃ¡s de 500 caracteres o mÃ¡s de 100 palabras\n  const charCount = text.length;\n  const wordCount = text.split(/\\s+/).filter(word => word.length > 0).length;\n  \n  return charCount > 500 || wordCount > 100;\n}\n\n// FunciÃ³n para procesar el texto y dividirlo inteligentemente (funciÃ³n original mejorada)\nfunction processAndSplitText(textInput) {\n  // AsegÃºrate de que textInput sea un string o pueda ser convertido\n  let text = textInput;\n\n  // Si la entrada no es un string\n  if (typeof text !== 'string') {\n    // Si es null o undefined, simplemente devolvemos un array vacÃ­o\n    if (text === null || text === undefined) {\n      return [];\n    }\n\n    // Si es un objeto, intentamos encontrar campos comunes que contengan texto\n    if (typeof text === 'object') {\n      if (text.text) {\n        text = text.text;\n      } else if (text.message) {\n        text = text.message;\n      } else if (text.type === 'text' && text.text) {\n        text = text.text;\n      } else if (text.output) {\n        // Si output es un string, lo usamos\n        if (typeof text.output === 'string') {\n          text = text.output;\n        } else {\n          // Si output es un objeto o array, intentamos extraer de ahÃ­\n          const extracted = extractTextContent(text.output);\n          if (extracted) {\n            text = extracted;\n          } else {\n            // Si no pudimos extraer, intentamos convertir todo el objeto a string\n            try {\n              text = JSON.stringify(text);\n            } catch (e) {\n              console.error(\"No se pudo serializar el objeto a string:\", e);\n              return [];\n            }\n          }\n        }\n      } else {\n        // Si no encontramos campos de texto comunes ni 'output', intentamos convertir a string\n        try {\n          text = JSON.stringify(text);\n        } catch (e) {\n          console.error(\"No se pudo serializar el objeto a string:\", e);\n          return [];\n        }\n      }\n    } else {\n      // Si no es string, objeto, null o undefined, devolvemos vacÃ­o\n      console.warn(\"Entrada a processAndSplitText no es string, objeto, null o undefined:\", typeof text);\n      return [];\n    }\n  }\n\n  // Si despuÃ©s de los intentos no tenemos un string vÃ¡lido, devolvemos vacÃ­o\n  if (typeof text !== 'string' || text.trim() === '') {\n    return [];\n  }\n\n  // Ahora que tenemos un string, procesamos el formato\n  const processedText = text\n    .replace(/\\*\\*(.+?)\\*\\*/g, '*$1*') // **texto** -> *texto*\n    .replace(/###\\s*/g, '')         // Elimina encabezados ###\n    .replace(/[Â¡Â¿!]/g, '');         // Elimina signos de exclamaciÃ³n e interrogaciÃ³n iniciales y finales\n\n  // Divide en lÃ­neas para anÃ¡lisis\n  const lines = processedText.split('\\n');\n\n  // Grupos para almacenar los mensajes\n  const messages = [];\n  let currentMessage = [];\n  let inNumberedSection = false;\n  let currentSectionNumber = null;\n\n  // Detectar secciones numeradas y agrupables\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    // Detecta si la lÃ­nea es un encabezado numerado (ej: \"1. Tipo de propiedad:\")\n    const numberedHeaderMatch = line.match(/^\\s*(\\d+)\\.\\s+([^:]+):/);\n\n    if (numberedHeaderMatch) {\n      const sectionNumber = parseInt(numberedHeaderMatch[1]);\n\n      // Si estamos empezando una nueva secciÃ³n numerada O si el nÃºmero no es el siguiente esperado\n      if (!inNumberedSection || (inNumberedSection && sectionNumber !== currentSectionNumber + 1)) {\n        // Si tenemos contenido previo, guardamos como mensaje separado\n        if (currentMessage.length > 0) {\n          messages.push(currentMessage.join('\\n').trim());\n          currentMessage = [];\n        }\n        inNumberedSection = true;\n      }\n      currentSectionNumber = sectionNumber;\n      currentMessage.push(line);\n\n    } else if (line.trim() === '') {\n      // Una lÃ­nea vacÃ­a puede terminar una secciÃ³n si hay contenido previo\n      if (currentMessage.length > 0) {\n        // Si no estamos en una secciÃ³n numerada, una lÃ­nea vacÃ­a termina el mensaje actual\n        if (!inNumberedSection) {\n          messages.push(currentMessage.join('\\n').trim());\n          currentMessage = [];\n        } else {\n          // Si estamos en una secciÃ³n numerada, una lÃ­nea vacÃ­a se agrega al mensaje actual\n          currentMessage.push(line);\n        }\n      }\n\n    } else {\n      // LÃ­nea con contenido que no es un encabezado numerado\n      currentMessage.push(line);\n      inNumberedSection = false;\n    }\n  }\n\n  // Agregar el Ãºltimo mensaje si queda algo\n  if (currentMessage.length > 0) {\n    messages.push(currentMessage.join('\\n').trim());\n  }\n\n  // Filtrar mensajes vacÃ­os y limpiar lÃ­neas vacÃ­as extra\n  return messages\n    .filter(msg => msg.length > 0)\n    .map(msg => {\n      // Eliminar lÃ­neas vacÃ­as mÃºltiples dentro del mensaje\n      return msg.replace(/\\n{2,}/g, '\\n\\n');\n    });\n}\n\n// FunciÃ³n para extraer texto de diferentes estructuras de datos\nfunction extractTextContent(data) {\n  // Si la data es null o undefined, retornamos null inmediatamente\n  if (data === null || data === undefined) {\n    return null;\n  }\n\n  // Si es un string, lo retornamos directamente\n  if (typeof data === 'string') {\n    return data;\n  }\n\n  // Si es un array\n  if (Array.isArray(data)) {\n    // Iteramos sobre el array e intentamos extraer texto de cada elemento\n    for (const item of data) {\n      const extracted = extractTextContent(item);\n      if (extracted) {\n        return extracted;\n      }\n    }\n    return null;\n  }\n\n  // Si es un objeto\n  if (typeof data === 'object') {\n    // Priorizamos campos comunes que suelen contener texto\n    if (data.text) {\n      return data.text;\n    }\n    if (data.message) {\n      return data.message;\n    }\n    // Si tiene un campo 'output', intentamos extraer texto de Ã©l\n    if (data.output !== undefined && data.output !== null) {\n      const extracted = extractTextContent(data.output);\n      if (extracted) {\n        return extracted;\n      }\n    }\n    // Si tiene un campo 'response', intentamos extraer texto de Ã©l\n    if (data.response !== undefined && data.response !== null) {\n      const extracted = extractTextContent(data.response);\n      if (extracted) {\n        return extracted;\n      }\n    }\n    // Si tiene un campo 'json', intentamos extraer texto de Ã©l\n    if (data.json !== undefined && data.json !== null) {\n      const extracted = extractTextContent(data.json);\n      if (extracted) {\n        return extracted;\n      }\n    }\n    // Si no encontramos campos de texto comunes ni estructuras anidadas esperadas,\n    // intentamos convertir el objeto completo a string como Ãºltimo recurso\n    try {\n      return JSON.stringify(data);\n    } catch (e) {\n      console.error(\"No se pudo serializar el objeto a string en extractTextContent:\", e);\n      return null;\n    }\n  }\n\n  // Si el tipo de dato no es manejado, retornamos null\n  console.warn(\"Tipo de dato no manejado en extractTextContent:\", typeof data);\n  return null;\n}\n\n// --- LÃ³gica Principal con manejo seguro de nodos ---\nlet textToProcess = null;\n\ntry {\n  // Verificar si el nodo \"Cancelar evento\" existe y tiene datos\n  let cancelarEventoData = null;\n  try {\n    // Usamos try-catch para capturar errores si el nodo no existe\n    cancelarEventoData = $('Cancelar evento');\n    if (cancelarEventoData && cancelarEventoData.first() && cancelarEventoData.first().json) {\n      if (cancelarEventoData.first().json.response !== undefined) {\n        textToProcess = extractTextContent(cancelarEventoData.first().json.response);\n      } else {\n        textToProcess = extractTextContent(cancelarEventoData.first().json);\n      }\n    }\n  } catch (e) {\n    // Silenciosamente ignoramos errores si el nodo no existe\n    console.log(\"Nodo 'Cancelar evento' no disponible o sin datos vÃ¡lidos\");\n  }\n  \n  // Solo intentamos acceder a AGE3 si aÃºn no hemos encontrado texto para procesar\n  if (!textToProcess) {\n    try {\n      // Usamos try-catch para capturar errores si el nodo no existe\n      const age3Data = $('AGE3');\n      if (age3Data && age3Data.first() && age3Data.first().json) {\n        if (age3Data.first().json.output !== undefined) {\n          textToProcess = extractTextContent(age3Data.first().json.output);\n        } else {\n          textToProcess = extractTextContent(age3Data.first().json);\n        }\n      }\n    } catch (e) {\n      // Silenciosamente ignoramos errores si el nodo no existe\n      console.log(\"Nodo 'AGE3' no disponible o sin datos vÃ¡lidos\");\n    }\n  }\n  \n  // Si no hemos encontrado datos en los nodos especÃ­ficos, intentamos con $input directamente\n  if (!textToProcess) {\n    try {\n      const inputItems = $input.all();\n      if (inputItems && inputItems.length > 0 && inputItems[0].json) {\n        textToProcess = extractTextContent(inputItems[0].json);\n      }\n    } catch (e) {\n      console.log(\"No se pudo acceder a los datos de entrada directamente:\", e.message);\n    }\n  }\n  \n  // Procesar y retornar el resultado\n  if (textToProcess) {\n    const textArray = processAndSplitText(textToProcess);\n    \n    // Procesar cada mensaje y dividirlo en chunks si es necesario\n    const processedMessages = [];\n    \n    for (const message of textArray) {\n      if (needsSplitting(message)) {\n        // Si el mensaje es largo, lo dividimos en chunks\n        const chunks = splitTextIntoChunks(message);\n        processedMessages.push(...chunks);\n      } else {\n        // Si el mensaje es corto, lo agregamos tal cual con tiempo de lectura\n        processedMessages.push({\n          parte: processedMessages.length + 1,\n          texto: message,\n          time: calculateReadingTime(message)\n        });\n      }\n    }\n    \n    // Re-numerar las partes para que sean consecutivas\n    processedMessages.forEach((msg, index) => {\n      msg.parte = index + 1;\n    });\n    \n    // Devolvemos la estructura con los mensajes procesados\n    return [{json: {messages: processedMessages, totalParts: processedMessages.length}}];\n  } else {\n    // Si no se pudo obtener ni procesar texto, devolvemos un array vacÃ­o\n    return [{json: {messages: [], totalParts: 0}}];\n  }\n} catch (error) {\n  // Capturamos cualquier error no manejado y devolvemos un objeto con informaciÃ³n del error\n  console.error(\"Error general en el nodo:\", error.message);\n  return [{json: {messages: [], totalParts: 0, error: error.message}}];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -352,
        -720
      ],
      "id": "694657a8-7565-424c-a301-bf2a3a3c35fa",
      "name": "Separa datos"
    },
    {
      "parameters": {
        "toolDescription": "llama a esta herramienta para comunicarse a una perosna",
        "method": "POST",
        "url": "={{ $('Normalizacion').last().json.instance.server_url }}/message/sendText/{{ $('Normalizacion').last().json.instance.name }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "={{ $('Normalizacion').last().json.instance.apikey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('Normalizacion').first().json.message.chat_id }}"
            },
            {
              "name": "text",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters1_Value', ``, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        -384,
        -320
      ],
      "id": "7eca5812-37ca-4523-9764-e6e0ead34286",
      "name": "call_seller"
    },
    {
      "parameters": {
        "inputText": "=Conversacion previa: {{ $json.msg.IA }}\nConversacion actual: {{ $json.msg.human }}",
        "categories": {
          "categories": [
            {
              "category": "purchase_intent",
              "description": "=**real_purchase_intent** â€“ Confirmo SÃ al resumen final con todos los datos (nombre/email/tel/producto/cant/precio/pago/entrega)"
            },
            {
              "category": "product_inquiry",
              "description": "Preguntas sobre medidas, colores, stock, etc"
            },
            {
              "category": "complaint ",
              "description": "Quejas, devolucionesâ€¦"
            },
            {
              "category": "small_talk",
              "description": "Saludos, despedidas, cortesÃ­aâ€¦"
            },
            {
              "category": "complaint",
              "description": "Quejas, devoluciones, reclamos (p. ej. â€œEl mueble llegÃ³ rotoâ€, â€œQuiero devolver el pedido.â€)."
            },
            {
              "category": "human_agent_request",
              "description": "âš ï¸ SOLO se activa DESPUÃ‰S de que el bot YA TIENE: âœ“ CORREO ELECTRÃ“NICO âœ“ NOMBRE COMPLETO âœ“ CONSULTA detallada. NUNCA activar si falta algÃºn dato. Primera solicitud â†’ purchase_desire u other\""
            },
            {
              "category": "other",
              "description": "Cuando hable de cualquier otra cosa que como cantidades y elija opciones"
            },
            {
              "category": "purchase_desire",
              "description": "Cliente en PROCESO ACTIVO de compra: seleccionando productos, dando datos personales (nombre/email/tel), respondiendo cantidades, o cuando pide hablar con vendedor SIN haber dado los 3 datos completos\""
            }
          ]
        },
        "options": {
          "fallback": "other",
          "systemPromptTemplate": "=Eres un clasificador de intenciÃ³n de compra para Muebles San FermÃ­n.\n**INSTRUCCIÃ“N CRÃTICA**: Tu respuesta debe ser ÃšNICAMENTE una de estas palabras, sin comillas, sin JSON, sin explicaciÃ³n:\n- real_purchase_intent\n- purchase_desire\n- product_inquiry\n- small_talk\n- complaint\n- human_agent_request\n- other\n\n**NUNCA respondas con JSON, objetos, formato de cÃ³digo, o markdown. SOLO UNA PALABRA.**\n\n## CategorÃ­as de clasificaciÃ³n:\n1. **real_purchase_intent**  \n   â€“ Se activa cuando el cliente CONFIRMA despuÃ©s de ver un resumen que contenga:\n   - INFORMACIÃ“N PERSONAL (nombre, email/telÃ©fono)\n   - Detalles del PEDIDO (producto, cantidad, precio)\n   - TOTAL a pagar\n   - Forma de PAGO\n   - MÃ©todo de ENTREGA\n   - Una pregunta de confirmaciÃ³n como \"Â¿Todos los datos estÃ¡n correctos?\"\n   \n   **Frases de confirmaciÃ³n vÃ¡lidas**:\n   - \"SÃ­ correcto\", \"SÃ­ es correcto\", \"SÃ­\"\n   - \"Todo correcto\", \"Perfecto\", \"Confirmo\"\n   - \"Adelante\", \"EstÃ¡ bien\", \"Procede\"\n2. **purchase_desire**  \n   â€“ Cliente en PROCESO ACTIVO de compra:\n   - Seleccionando productos (\"quiero la alacena\")\n   - Respondiendo sobre cantidades o modelos\n   - Proporcionando datos personales (nombre, email, telÃ©fono)\n   - Aceptando continuar con el proceso (\"sÃ­\" a preguntas del bot)\n   - Cualquier interacciÃ³n durante la compra\n3. **product_inquiry**  \n   â€“ Consultas sobre productos SIN intenciÃ³n inmediata de compra:\n   - \"Â¿Tienen mesas de luz?\"\n   - \"Â¿CuÃ¡nto mide este mueble?\"\n   - \"Â¿Viene en otros colores?\"\n   - \"Â¿CuÃ¡l es el precio?\"\n4. **small_talk**  \n   â€“ Interacciones sociales:\n   - Saludos: \"Hola\", \"Buenos dÃ­as\"\n   - Agradecimientos: \"Gracias\", \"Muy amable\"\n   - Despedidas: \"AdiÃ³s\", \"Hasta luego\"\n5. **complaint**  \n   â€“ Problemas con pedidos anteriores:\n   - \"El mueble llegÃ³ daÃ±ado\"\n   - \"Quiero hacer una devoluciÃ³n\"\n   - \"Tengo un reclamo\"\n6. **human_agent_request**  \n   â€“ âš ï¸ **IMPORTANTE**: SOLO se activa DESPUÃ‰S de que el bot YA TIENE:\n   - âœ“ CORREO ELECTRÃ“NICO del cliente\n   - âœ“ NOMBRE COMPLETO del cliente\n   - âœ“ CONSULTA o motivo especÃ­fico detallado\n   \n   **NUNCA ACTIVAR SI**:\n   - Falta alguno de los 3 datos anteriores\n   - Es la primera vez que pide hablar con alguien\n   - El bot aÃºn no ha preguntado por los datos\n   \n   **PROCESO CORRECTO**:\n   1. Cliente pide hablar con vendedor â†’ purchase_desire o other\n   2. Bot recolecta nombre, correo y consulta\n   3. Cliente confirma querer hablar con vendedor â†’ human_agent_request\n   \n   **Frases que NO activan sin los 3 datos**:\n   - \"Quiero hablar con un vendedor\" â†’ purchase_desire\n   - \"Necesito ayuda de una persona\" â†’ purchase_desire\n   - \"Prefiero hablar con alguien\" â†’ purchase_desire\n7. **other**  \n   â€“ Mensajes que no encajan en otras categorÃ­as\n## CONTEXTOS CLAVE:\n**Si el bot acaba de mostrar**:\n- CotizaciÃ³n con precio â†’ respuesta \"SÃ­\" = purchase_desire\n- Pregunta sobre datos â†’ respuesta con datos = purchase_desire\n- Resumen completo del pedido â†’ respuesta confirmando = real_purchase_intent\n**Para identificar resumen completo**, debe incluir:\n- ğŸ”¸ o âœ“ INFORMACIÃ“N PERSONAL\n- ğŸ›’ o ğŸ“¦ TU PEDIDO o productos listados\n- ğŸ’° TOTAL FINAL o precio total\n- ğŸ’³ Forma de pago\n- ğŸšš Entrega o retiro\n- â“ \"Â¿Todos los datos estÃ¡n correctos?\" o similar\n\n**## FORMATO DE RESPUESTA OBLIGATORIO:\n- NO uses ```json o ``` \n- NO devuelvas objetos JSON\n- NO uses comillas\n- NO des explicaciones\n- SOLO responde con UNA PALABRA de la lista\n\nRESPUESTAS CORRECTAS:\nâœ… purchase_desire\nâœ… product_inquiry\nâœ… small_talk**\n\n## EJEMPLOS DE RESPUESTA:\nEntrada: \"Una alacena\"\nTu respuesta: product_inquiry\nEntrada: \"SÃ­ correcto\" (despuÃ©s de ver resumen completo)\nTu respuesta: real_purchase_intent\nEntrada: \"fercassera@gmail.com\" (durante proceso de compra)\nTu respuesta: purchase_desire\nEntrada: \"Quiero hablar con un vendedor\" (sin haber dado datos completos)\nTu respuesta: other\nEntrada: \"Necesito hablar con alguien\" (ya dio nombre, correo y consulta)\nTu respuesta: human_agent_request\n**RECUERDA**: Solo responde con UNA PALABRA de las 7 categorÃ­as listadas. NADA MÃS.",
          "enableAutoFixing": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1.1,
      "position": [
        -1328,
        -976
      ],
      "id": "91513fdf-6a1e-4d7c-b238-dae249c28678",
      "name": "Text Classifier",
      "alwaysOutputData": false,
      "notesInFlow": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3e413cf8-db59-4e46-8612-c49e97c3fc60",
              "leftValue": "={{ $('Extraer URL de imagen y limpiar mensaje1').item.json.url }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2016,
        -672
      ],
      "id": "4347db1c-9a88-4f88-aa72-19462971fc69",
      "name": "If2"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Extraer URL de imagen y limpiar mensaje1').item.json.url ? ($('Extraer URL de imagen y limpiar mensaje1').item.json.url.toLowerCase().endsWith('.jpg') ? 'jpg' : $('Extraer URL de imagen y limpiar mensaje1').item.json.url.toLowerCase().endsWith('.jpeg') ? 'jpeg' : $('Extraer URL de imagen y limpiar mensaje1').item.json.url.toLowerCase().endsWith('.png') ? 'png' : false) : false }}",
                    "rightValue": "jpg",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "3ebc8e68-a841-46e9-abc3-93094bb82675"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "jpg"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d7b3c3d3-1c4a-4940-8a63-94abc3bbe2fc",
                    "leftValue": "={{ $('Extraer URL de imagen y limpiar mensaje1').item.json.url ? ($('Extraer URL de imagen y limpiar mensaje1').item.json.url.toLowerCase().endsWith('.jpg') ? 'jpg' : $('Extraer URL de imagen y limpiar mensaje1').item.json.url.toLowerCase().endsWith('.') ? 'jpeg' : $('Extraer URL de imagen y limpiar mensaje1').item.json.url.toLowerCase().endsWith('.png') ? '' : false) : false }}",
                    "rightValue": "png",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "png"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "5949a868-6881-41b3-85b7-e0acd9ca6b67",
                    "leftValue": "={{ $('Extraer URL de imagen y limpiar mensaje1').item.json.url ? ($('Extraer URL de imagen y limpiar mensaje1').item.json.url.toLowerCase().endsWith('.jpg') ? 'jpg' : $('Extraer URL de imagen y limpiar mensaje1').item.json.url.toLowerCase().endsWith('.jpeg') ? 'jpeg' : $('Extraer URL de imagen y limpiar mensaje1').item.json.url.toLowerCase().endsWith('.png') ? 'png' : false) : false }}",
                    "rightValue": "jpeg",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "jpeg"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        2672,
        -384
      ],
      "id": "cd273078-9c01-44ce-bf8b-9e7a37e7945b",
      "name": "IMAGEN"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Normalizacion').last().json.instance.server_url }}/message/sendMedia/{{ $('Normalizacion').last().json.instance.name }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "={{ $('Normalizacion').last().json.instance.apikey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{$('Normalizacion').last().json.message.chat_id}}"
            },
            {
              "name": "mediatype",
              "value": "image"
            },
            {
              "name": "mimetype",
              "value": "image/png"
            },
            {
              "name": "caption",
              "value": "ğŸª‘"
            },
            {
              "name": "media",
              "value": "={{ $('Extraer URL de imagen y limpiar mensaje1').first().json.url }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2480,
        -464
      ],
      "id": "9ff8b834-5034-4494-9b49-bdfb26f66ef4",
      "name": "png"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Normalizacion').last().json.instance.server_url }}/message/sendMedia/{{ $('Normalizacion').last().json.instance.name }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "={{ $('Normalizacion').last().json.instance.apikey }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"number\":\"{{ $('Normalizacion').item.json.message.chat_id }}\" ,\n  \"mediatype\": \"image\",\n  \"mimetype\": {{ $('Extraer URL de imagen y limpiar mensaje1').item.json.url.toLowerCase().endsWith('.png') ? '\"image/png\"' : '\"image/jpeg\"' }},\n  \"caption\": \"ğŸª‘\",\n  \"media\": \"{{ $('Extraer URL de imagen y limpiar mensaje1').first().json.url }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2080,
        -272
      ],
      "id": "90ec6d72-c9b2-47c5-82b1-4c8fd72ec3cf",
      "name": "jpg"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Normalizacion').last().json.instance.server_url }}/message/sendMedia/{{ $('Normalizacion').last().json.instance.name }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "apikey",
              "value": "={{ $('Normalizacion').last().json.instance.apikey }}"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{$('Normalizacion').last().json.message.chat_id}}"
            },
            {
              "name": "mediatype",
              "value": "image"
            },
            {
              "name": "mimetype",
              "value": "image/jpeg"
            },
            {
              "name": "caption",
              "value": "ğŸª‘"
            },
            {
              "name": "media",
              "value": "={{ $('Extraer URL de imagen y limpiar mensaje1').first().json.url }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2336,
        -144
      ],
      "id": "6dd97a71-8773-4b0c-ab22-a3e784fe461a",
      "name": "jpeg"
    }
  ],
  "pinData": {
    "Inbound": [
      {
        "json": {
          "headers": {
            "host": "n8nw.qeva.xyz",
            "user-agent": "axios/1.10.0",
            "content-length": "21866",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "n8nw.qeva.xyz",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "7697b68d06c2",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "messages.upsert",
            "instance": "Fernando",
            "data": {
              "key": {
                "remoteJid": "5492254423359@s.whatsapp.net",
                "fromMe": false,
                "id": "EF9249F16A2D35286803C2D7A66B869F",
                "senderLid": "12756421980347@lid"
              },
              "pushName": "Fer { }",
              "status": "DELIVERY_ACK",
              "message": {
                "audioMessage": {
                  "url": "https://mmg.whatsapp.net/v/t62.7117-24/33463575_1321897376062466_8098101449460339539_n.enc?ccb=11-4&oh=01_Q5Aa2AEZnnXrrdQOMF-OeMJAFO38yaY6CywP0JFAo03EYBP9hw&oe=68B972AC&_nc_sid=5e03e0&mms3=true",
                  "mimetype": "audio/ogg; codecs=opus",
                  "fileSha256": "E0ibgfBtRYLMs1JBiJ/sx9kE2owTzsYy++PMmWs+q/k=",
                  "fileLength": "15125",
                  "seconds": 6,
                  "ptt": true,
                  "mediaKey": "QznHj7rVlELU6Cfyxh7+V63PhZ0WK2IyVmbG/YG4YNE=",
                  "fileEncSha256": "ytfbQhtgIS6z9Jv9G6VWEJMseH+wSXFA82lNhbeYgMo=",
                  "directPath": "/v/t62.7117-24/33463575_1321897376062466_8098101449460339539_n.enc?ccb=11-4&oh=01_Q5Aa2AEZnnXrrdQOMF-OeMJAFO38yaY6CywP0JFAo03EYBP9hw&oe=68B972AC&_nc_sid=5e03e0",
                  "mediaKeyTimestamp": "1754398451",
                  "waveform": "AAAAAAAAAAAAAhAzLxkCAC40MC09MEE/KUk8NwJFEBA3Hj4XPz0xOzMCAAUtLikhGwEAAAAAHjo+OjRBPgMAAA=="
                },
                "messageContextInfo": {
                  "deviceListMetadata": {
                    "senderKeyHash": "iVJZBUf9o9GNyA==",
                    "senderTimestamp": "1753698939",
                    "recipientKeyHash": "F1tkbDhHhKbugw==",
                    "recipientTimestamp": "1754099422"
                  },
                  "deviceListMetadataVersion": 2,
                  "messageSecret": "bar6dz8mjY5j4d/pKQOTaMQMAiZyHF8gXQdEg9iG1uw="
                },
                "base64": "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"
              },
              "contextInfo": null,
              "messageType": "audioMessage",
              "messageTimestamp": 1754398457,
              "instanceId": "4c764abd-56e6-4e7d-b849-4e3123c02531",
              "source": "android"
            },
            "destination": "https://n8nw.qeva.xyz/webhook/manager",
            "date_time": "2025-08-05T09:54:18.207Z",
            "sender": "5492254596618@s.whatsapp.net",
            "server_url": "https://evo.qeva.xyz",
            "apikey": "27732CFA65D7-416C-9562-9CED5C942DF3"
          },
          "webhookUrl": "https://n8nw.qeva.xyz/webhook/manager",
          "executionMode": "production"
        }
      }
    ],
    "AI": [
      {
        "json": {
          "output": "Te muestro 8 opciones que tenemos disponibles:\n\n1. ALACENA RUSIA:\n. ğŸ’µ Precio: $30200\n. ğŸ“ Medidas: 0.60 x 0.30 x 0.40 m\nhttps://ifmvoiakiptccbdusyli.supabase.co/storage/v1/object/public/productos/alacenas/AlacenaRusia.jpg\n\n2. ALACENA GALES:\n. ğŸ’µ Precio: $30100\n. ğŸ“ Medidas: 0.60 x 0.30 x 0.60 m\nhttps://ifmvoiakiptccbdusyli.supabase.co/storage/v1/object/public/productos/alacenas/AlacenaGales.jpg\n\n3. ALACENA TURQUIA:\n. ğŸ’µ Precio: $41200\n. ğŸ“ Medidas: 0.60 x 0.30 x 0.75 m\nhttps://ifmvoiakiptccbdusyli.supabase.co/storage/v1/object/public/productos/alacenas/AlacenaTurquia.jpg\n\n4. ALACENA SOFIA:\n. ğŸ’µ Precio: $52600\n. ğŸ“ Medidas: 1.40 x 0.30 x 0.60 m\nhttps://ifmvoiakiptccbdusyli.supabase.co/storage/v1/object/public/productos/alacenas/AlacenaSofia.jpg\n\n5. ALACENA PARIS:\n. ğŸ’µ Precio: $57300\n. ğŸ“ Medidas: 1.60 x 0.30 x 0.60 m\nhttps://ifmvoiakiptccbdusyli.supabase.co/storage/v1/object/public/productos/alacenas/AlacenaParis.jpg\n\n6. ALACENA ESTOCOLMO:\n. ğŸ’µ Precio: $56400\n. ğŸ“ Medidas: 0.60 x 0.60 x 0.70 m\nhttps://ifmvoiakiptccbdusyli.supabase.co/storage/v1/object/public/productos/alacenas/AlacenaEstocolmo.jpg\n\n7. ALACENA MADRID:\n. ğŸ’µ Precio: $33200\n. ğŸ“ Medidas: 0.80 x 0.30 x 0.60 m\nhttps://ifmvoiakiptccbdusyli.supabase.co/storage/v1/object/public/productos/alacenas/AlacenaMadrid.jpg\n\n8. ALACENA BRATTI:\n. ğŸ’µ Precio: $34300\n. ğŸ“ Medidas: 1.00 x 0.30 x 0.60 m\nhttps://ifmvoiakiptccbdusyli.supabase.co/storage/v1/object/public/productos/alacenas/AlacenaBratti.jpg\n\nÂ¿Te interesa alguno de estos modelos?"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "America/Argentina/Buenos_Aires",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "EBMwLGTBawYqkZM1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-08-05T13:12:44.619Z",
  "versionId": "58ef5390-4272-4688-90e9-1464de19bbcf"
}