{
  "active": false,
  "connections": {
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "escribiendo...",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Separa datos": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message Type": {
      "main": [
        [
          {
            "node": "Encolado de msg",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Encolado de msg",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "Encolado de msg",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "chatInput",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Elimina la cita1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Elimina la cita - Reagendar",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validar Cliente": {
      "main": [
        [
          {
            "node": "Variables globales",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Encolado de msg": {
      "main": [
        [
          {
            "node": "Sort",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Sort": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "chatInput",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "chatInput": {
      "main": [
        [
          {
            "node": "Juli",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Variables globales": {
      "main": [
        [
          {
            "node": "Message Type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "From Me2": {
      "main": [
        [
          {
            "node": "Validar Cliente",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Redis4": {
      "main": [
        [
          {
            "node": "Texto4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Redis5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "V1": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis5": {
      "main": [
        [
          {
            "node": "Texto3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis6": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        []
      ]
    },
    "Redis7": {
      "main": [
        [
          {
            "node": "Redis4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "Redis7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Texto3": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Texto4": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [],
        [
          {
            "node": "Separa datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [],
        [
          {
            "node": "From Me2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request3": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "CreateCITA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CreateCITA": {
      "main": [
        [
          {
            "node": "Turno creado",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "HTTP Request3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Juli": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Turno creado": {
      "main": [
        [
          {
            "node": "Delete lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "escribiendo...": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "tool_agendar": {
      "ai_tool": [
        [
          {
            "node": "agente_vero",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "tool_cancelar": {
      "ai_tool": [
        [
          {
            "node": "agente_vero",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "tool_reagendar": {
      "ai_tool": [
        [
          {
            "node": "agente_vero",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "tool_turnos": {
      "ai_tool": [
        [
          {
            "node": "agente_vero",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Elimina la cita1": {
      "main": [
        [
          {
            "node": "Cancelar turno",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook2": {
      "main": [
        [
          {
            "node": "V1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "V",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agente_vero": {
      "ai_tool": [
        [
          {
            "node": "Juli",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "agente_martina": {
      "ai_tool": [
        [
          {
            "node": "Juli",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "update_paciente": {
      "ai_tool": [
        [
          {
            "node": "agente_martina",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "get_paciente": {
      "ai_tool": [
        [
          {
            "node": "agente_martina",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "gemini2": {
      "ai_languageModel": [
        [
          {
            "node": "agente_vero",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Juli",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "agente_martina",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "memory1": {
      "ai_memory": [
        [
          {
            "node": "agente_vero",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "agente_martina",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Juli",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "Chat Memory Manager",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Elimina la cita - Reagendar": {
      "main": [
        [
          {
            "node": "Cancelar turno1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar turno": {
      "main": [
        [
          {
            "node": "Chat Memory Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cancelar turno1": {
      "main": [
        [
          {
            "node": "Chat Memory Manager",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "tool_think": {
      "ai_tool": [
        [
          {
            "node": "Juli",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "agente_vero",
            "type": "ai_tool",
            "index": 0
          },
          {
            "node": "agente_martina",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "update_fecha": {
      "ai_tool": [
        [
          {
            "node": "agente_vero",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-06-28T03:55:59.462Z",
  "id": "88Es7Fmu43dhduPs",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "AGENTE CITAS - MASTER",
  "nodes": [
    {
      "parameters": {
        "batchSize": "=1",
        "options": {
          "reset": false
        }
      },
      "id": "32381d6a-8d2c-4dbe-8b6c-68942256d94d",
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        6128,
        864
      ],
      "alwaysOutputData": false,
      "executeOnce": false
    },
    {
      "parameters": {
        "fieldToSplitOut": "messages",
        "options": {}
      },
      "id": "876f996a-e51f-482d-8d39-8b8c7ed0f556",
      "name": "Split Out",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        5616,
        912
      ]
    },
    {
      "parameters": {
        "jsCode": "// --- Funciones de procesamiento de texto ---\n\n// Función para dividir texto en fragmentos con tiempo de lectura\nfunction splitTextIntoChunks(text, maxChars = 200) {\n  // Si el texto es muy corto, devolvemos un solo fragmento\n  if (!text || text.length <= maxChars) {\n    return [{\n      parte: 1,\n      texto: text || '',\n      time: calculateReadingTime(text || '')\n    }];\n  }\n\n  const chunks = [];\n  let currentChunk = '';\n  let partNumber = 1;\n  \n  // Dividimos por palabras para no cortar palabras a la mitad\n  const words = text.split(' ');\n  \n  for (let i = 0; i < words.length; i++) {\n    const word = words[i];\n    const potentialChunk = currentChunk ? currentChunk + ' ' + word : word;\n    \n    // Si agregar la siguiente palabra excede el límite\n    if (potentialChunk.length > maxChars) {\n      // Si la palabra sola es más larga que maxChars, la cortamos\n      if (word.length > maxChars) {\n        // Guardamos el chunk actual si tiene contenido\n        if (currentChunk) {\n          chunks.push({\n            parte: partNumber++,\n            texto: currentChunk.trim(),\n            time: calculateReadingTime(currentChunk.trim())\n          });\n        }\n        \n        // Cortamos la palabra larga en pedazos\n        let remainingWord = word;\n        while (remainingWord.length > maxChars) {\n          chunks.push({\n            parte: partNumber++,\n            texto: remainingWord.substring(0, maxChars),\n            time: calculateReadingTime(remainingWord.substring(0, maxChars))\n          });\n          remainingWord = remainingWord.substring(maxChars);\n        }\n        \n        // El resto de la palabra se convierte en el nuevo currentChunk\n        currentChunk = remainingWord;\n      } else {\n        // Guardamos el chunk actual y empezamos uno nuevo con esta palabra\n        chunks.push({\n          parte: partNumber++,\n          texto: currentChunk.trim(),\n          time: calculateReadingTime(currentChunk.trim())\n        });\n        currentChunk = word;\n      }\n    } else {\n      // Si cabe, agregamos la palabra al chunk actual\n      currentChunk = potentialChunk;\n    }\n  }\n  \n  // Agregar el último chunk si queda algo\n  if (currentChunk.trim()) {\n    chunks.push({\n      parte: partNumber,\n      texto: currentChunk.trim(),\n      time: calculateReadingTime(currentChunk.trim())\n    });\n  }\n  \n  return chunks;\n}\n\n// Función para calcular el tiempo de lectura basado en la longitud del texto\nfunction calculateReadingTime(text) {\n  const length = text.length;\n  \n  if (length > 150) {\n    return 4; // segundos\n  } else if (length >= 50) {\n    return 3; // segundos\n  } else {\n    return 1; // segundo\n  }\n}\n\n// Función para determinar si un texto necesita ser dividido\nfunction needsSplitting(text) {\n  if (!text || typeof text !== 'string') return false;\n  \n  // Criterios: más de 500 caracteres o más de 100 palabras\n  const charCount = text.length;\n  const wordCount = text.split(/\\s+/).filter(word => word.length > 0).length;\n  \n  return charCount > 500 || wordCount > 100;\n}\n\n// Función para procesar el texto y dividirlo inteligentemente (función original mejorada)\nfunction processAndSplitText(textInput) {\n  // Asegúrate de que textInput sea un string o pueda ser convertido\n  let text = textInput;\n\n  // Si la entrada no es un string\n  if (typeof text !== 'string') {\n    // Si es null o undefined, simplemente devolvemos un array vacío\n    if (text === null || text === undefined) {\n      return [];\n    }\n\n    // Si es un objeto, intentamos encontrar campos comunes que contengan texto\n    if (typeof text === 'object') {\n      if (text.text) {\n        text = text.text;\n      } else if (text.message) {\n        text = text.message;\n      } else if (text.type === 'text' && text.text) {\n        text = text.text;\n      } else if (text.output) {\n        // Si output es un string, lo usamos\n        if (typeof text.output === 'string') {\n          text = text.output;\n        } else {\n          // Si output es un objeto o array, intentamos extraer de ahí\n          const extracted = extractTextContent(text.output);\n          if (extracted) {\n            text = extracted;\n          } else {\n            // Si no pudimos extraer, intentamos convertir todo el objeto a string\n            try {\n              text = JSON.stringify(text);\n            } catch (e) {\n              console.error(\"No se pudo serializar el objeto a string:\", e);\n              return [];\n            }\n          }\n        }\n      } else {\n        // Si no encontramos campos de texto comunes ni 'output', intentamos convertir a string\n        try {\n          text = JSON.stringify(text);\n        } catch (e) {\n          console.error(\"No se pudo serializar el objeto a string:\", e);\n          return [];\n        }\n      }\n    } else {\n      // Si no es string, objeto, null o undefined, devolvemos vacío\n      console.warn(\"Entrada a processAndSplitText no es string, objeto, null o undefined:\", typeof text);\n      return [];\n    }\n  }\n\n  // Si después de los intentos no tenemos un string válido, devolvemos vacío\n  if (typeof text !== 'string' || text.trim() === '') {\n    return [];\n  }\n\n  // Ahora que tenemos un string, procesamos el formato\n  const processedText = text\n    .replace(/\\*\\*(.+?)\\*\\*/g, '*$1*') // **texto** -> *texto*\n    .replace(/###\\s*/g, '')         // Elimina encabezados ###\n    .replace(/[¡¿!]/g, '');         // Elimina signos de exclamación e interrogación iniciales y finales\n\n  // Divide en líneas para análisis\n  const lines = processedText.split('\\n');\n\n  // Grupos para almacenar los mensajes\n  const messages = [];\n  let currentMessage = [];\n  let inNumberedSection = false;\n  let currentSectionNumber = null;\n\n  // Detectar secciones numeradas y agrupables\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    // Detecta si la línea es un encabezado numerado (ej: \"1. Tipo de propiedad:\")\n    const numberedHeaderMatch = line.match(/^\\s*(\\d+)\\.\\s+([^:]+):/);\n\n    if (numberedHeaderMatch) {\n      const sectionNumber = parseInt(numberedHeaderMatch[1]);\n\n      // Si estamos empezando una nueva sección numerada O si el número no es el siguiente esperado\n      if (!inNumberedSection || (inNumberedSection && sectionNumber !== currentSectionNumber + 1)) {\n        // Si tenemos contenido previo, guardamos como mensaje separado\n        if (currentMessage.length > 0) {\n          messages.push(currentMessage.join('\\n').trim());\n          currentMessage = [];\n        }\n        inNumberedSection = true;\n      }\n      currentSectionNumber = sectionNumber;\n      currentMessage.push(line);\n\n    } else if (line.trim() === '') {\n      // Una línea vacía puede terminar una sección si hay contenido previo\n      if (currentMessage.length > 0) {\n        // Si no estamos en una sección numerada, una línea vacía termina el mensaje actual\n        if (!inNumberedSection) {\n          messages.push(currentMessage.join('\\n').trim());\n          currentMessage = [];\n        } else {\n          // Si estamos en una sección numerada, una línea vacía se agrega al mensaje actual\n          currentMessage.push(line);\n        }\n      }\n\n    } else {\n      // Línea con contenido que no es un encabezado numerado\n      currentMessage.push(line);\n      inNumberedSection = false;\n    }\n  }\n\n  // Agregar el último mensaje si queda algo\n  if (currentMessage.length > 0) {\n    messages.push(currentMessage.join('\\n').trim());\n  }\n\n  // Filtrar mensajes vacíos y limpiar líneas vacías extra\n  return messages\n    .filter(msg => msg.length > 0)\n    .map(msg => {\n      // Eliminar líneas vacías múltiples dentro del mensaje\n      return msg.replace(/\\n{2,}/g, '\\n\\n');\n    });\n}\n\n// Función para extraer texto de diferentes estructuras de datos\nfunction extractTextContent(data) {\n  // Si la data es null o undefined, retornamos null inmediatamente\n  if (data === null || data === undefined) {\n    return null;\n  }\n\n  // Si es un string, lo retornamos directamente\n  if (typeof data === 'string') {\n    return data;\n  }\n\n  // Si es un array\n  if (Array.isArray(data)) {\n    // Iteramos sobre el array e intentamos extraer texto de cada elemento\n    for (const item of data) {\n      const extracted = extractTextContent(item);\n      if (extracted) {\n        return extracted;\n      }\n    }\n    return null;\n  }\n\n  // Si es un objeto\n  if (typeof data === 'object') {\n    // Priorizamos campos comunes que suelen contener texto\n    if (data.text) {\n      return data.text;\n    }\n    if (data.message) {\n      return data.message;\n    }\n    // Si tiene un campo 'output', intentamos extraer texto de él\n    if (data.output !== undefined && data.output !== null) {\n      const extracted = extractTextContent(data.output);\n      if (extracted) {\n        return extracted;\n      }\n    }\n    // Si tiene un campo 'response', intentamos extraer texto de él\n    if (data.response !== undefined && data.response !== null) {\n      const extracted = extractTextContent(data.response);\n      if (extracted) {\n        return extracted;\n      }\n    }\n    // Si tiene un campo 'json', intentamos extraer texto de él\n    if (data.json !== undefined && data.json !== null) {\n      const extracted = extractTextContent(data.json);\n      if (extracted) {\n        return extracted;\n      }\n    }\n    // Si no encontramos campos de texto comunes ni estructuras anidadas esperadas,\n    // intentamos convertir el objeto completo a string como último recurso\n    try {\n      return JSON.stringify(data);\n    } catch (e) {\n      console.error(\"No se pudo serializar el objeto a string en extractTextContent:\", e);\n      return null;\n    }\n  }\n\n  // Si el tipo de dato no es manejado, retornamos null\n  console.warn(\"Tipo de dato no manejado en extractTextContent:\", typeof data);\n  return null;\n}\n\n// --- Lógica Principal con manejo seguro de nodos ---\nlet textToProcess = null;\n\ntry {\n  // Verificar si el nodo \"Cancelar evento\" existe y tiene datos\n  let cancelarEventoData = null;\n  try {\n    // Usamos try-catch para capturar errores si el nodo no existe\n    cancelarEventoData = $('Cancelar evento');\n    if (cancelarEventoData && cancelarEventoData.first() && cancelarEventoData.first().json) {\n      if (cancelarEventoData.first().json.response !== undefined) {\n        textToProcess = extractTextContent(cancelarEventoData.first().json.response);\n      } else {\n        textToProcess = extractTextContent(cancelarEventoData.first().json);\n      }\n    }\n  } catch (e) {\n    // Silenciosamente ignoramos errores si el nodo no existe\n    console.log(\"Nodo 'Cancelar evento' no disponible o sin datos válidos\");\n  }\n  \n  // Solo intentamos acceder a AGE3 si aún no hemos encontrado texto para procesar\n  if (!textToProcess) {\n    try {\n      // Usamos try-catch para capturar errores si el nodo no existe\n      const age3Data = $('AGE3');\n      if (age3Data && age3Data.first() && age3Data.first().json) {\n        if (age3Data.first().json.output !== undefined) {\n          textToProcess = extractTextContent(age3Data.first().json.output);\n        } else {\n          textToProcess = extractTextContent(age3Data.first().json);\n        }\n      }\n    } catch (e) {\n      // Silenciosamente ignoramos errores si el nodo no existe\n      console.log(\"Nodo 'AGE3' no disponible o sin datos válidos\");\n    }\n  }\n  \n  // Si no hemos encontrado datos en los nodos específicos, intentamos con $input directamente\n  if (!textToProcess) {\n    try {\n      const inputItems = $input.all();\n      if (inputItems && inputItems.length > 0 && inputItems[0].json) {\n        textToProcess = extractTextContent(inputItems[0].json);\n      }\n    } catch (e) {\n      console.log(\"No se pudo acceder a los datos de entrada directamente:\", e.message);\n    }\n  }\n  \n  // Procesar y retornar el resultado\n  if (textToProcess) {\n    const textArray = processAndSplitText(textToProcess);\n    \n    // Procesar cada mensaje y dividirlo en chunks si es necesario\n    const processedMessages = [];\n    \n    for (const message of textArray) {\n      if (needsSplitting(message)) {\n        // Si el mensaje es largo, lo dividimos en chunks\n        const chunks = splitTextIntoChunks(message);\n        processedMessages.push(...chunks);\n      } else {\n        // Si el mensaje es corto, lo agregamos tal cual con tiempo de lectura\n        processedMessages.push({\n          parte: processedMessages.length + 1,\n          texto: message,\n          time: calculateReadingTime(message)\n        });\n      }\n    }\n    \n    // Re-numerar las partes para que sean consecutivas\n    processedMessages.forEach((msg, index) => {\n      msg.parte = index + 1;\n    });\n    \n    // Devolvemos la estructura con los mensajes procesados\n    return [{json: {messages: processedMessages, totalParts: processedMessages.length}}];\n  } else {\n    // Si no se pudo obtener ni procesar texto, devolvemos un array vacío\n    return [{json: {messages: [], totalParts: 0}}];\n  }\n} catch (error) {\n  // Capturamos cualquier error no manejado y devolvemos un objeto con información del error\n  console.error(\"Error general en el nodo:\", error.message);\n  return [{json: {messages: [], totalParts: 0, error: error.message}}];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5408,
        912
      ],
      "id": "abd29851-3bf1-478a-8b91-1bafdd3000ea",
      "name": "Separa datos"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.msg.type }}",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "c203e3f3-cdae-4308-b7ca-2300800248e7"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0cb14635-2673-408e-86db-ce9e0373674b",
                    "leftValue": "={{ $json.msg.type }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "462a2dc9-b455-4b67-a55b-15ce1554f0e8",
                    "leftValue": "={{ $json.msg.type }}",
                    "rightValue": "reply",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "button"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "61909e38-68a6-46cc-9287-bd79d0b95854",
                    "leftValue": "={{ $json.msg.type }}",
                    "rightValue": "extendedTextMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "extendedTextMessage"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "89191595-e9ab-4d53-881b-ed5247811e44",
                    "leftValue": "={{ $json.msg.content === 'Quiero cambiar mi fecha' }}",
                    "rightValue": "Quiero cambiar mi fecha",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Modificar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d1365037-6336-4f42-ad67-111b60828b07",
                    "leftValue": "={{ $('Webhook2').first().json.body.data.msgContent.listResponseMessage.contextInfo.quotedMessage.listMessage.buttonText === 'Confirmar ✅' }}",
                    "rightValue": "Confirmar ✅",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Confirmar ✅"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "06ff860d-976d-4fdc-9dd3-8c9483137f8d",
                    "leftValue": "={{ $('Webhook2').first().json.body.data.msgContent.listResponseMessage.contextInfo.quotedMessage.listMessage.buttonText === '⛔ CANCELAR CITA' }}",
                    "rightValue": " ❌ Cancelar cita",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Cancelar"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b64bdc33-47da-4c94-988d-1ba19386a5a2",
                    "leftValue": "={{ $('Webhook2').first().json.body.data.msgContent.listResponseMessage.contextInfo.quotedMessage.listMessage.buttonText === '📋 REAGENDAR CONSULTA'}}",
                    "rightValue": "📆 Elegir cita",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Reprogramar"
            }
          ]
        },
        "options": {}
      },
      "id": "d71e55de-abb0-4109-ac1c-3b2db2838d6f",
      "name": "Message Type",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1872,
        1472
      ]
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "93rlsJqTd0Ntt2NC",
          "mode": "list",
          "cachedResultName": "AGENTE CITAS - GET CLIENTES"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "numero": "={{ $('V1').item.json.msg.telefono }}",
            "idTabla": "m9m2veegnrfeeza",
            "token": "3WY4UecQy9Nl522fe_DXDSHeQDVSQJpmDG7mMoFz",
            "servidor_db": "={{ $('V1').item.json.datos.server_db }}",
            "nombre_columna": "TELEFONO"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "servidor_db",
              "displayName": "servidor_db",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "idTabla",
              "displayName": "idTabla",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "token",
              "displayName": "token",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "numero",
              "displayName": "numero",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "nombre_columna",
              "displayName": "nombre_columna",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "pushname",
              "displayName": "pushname",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "servidor_evo",
              "displayName": "servidor_evo",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "id_mensaje",
              "displayName": "id_mensaje",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        1072,
        1504
      ],
      "id": "4bb21619-8a2b-4a8c-ba86-61963baf003e",
      "name": "Validar Cliente"
    },
    {
      "parameters": {
        "content": "## Validacion de cliente en base de datos",
        "height": 380,
        "width": 340,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -32,
        336
      ],
      "typeVersion": 1,
      "id": "b8a30471-6f2c-4875-b0c8-c742800ed91b",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "tD2EBk1RhsCBSSkb",
          "mode": "list",
          "cachedResultName": "SUB TAREA - ENLOCAR MSG Citas"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": true
        },
        "mode": "each",
        "options": {
          "waitForSubWorkflow": true
        }
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.2,
      "position": [
        2240,
        1360
      ],
      "id": "e1bccc3d-4d41-431c-941b-bf5e307c53c5",
      "name": "Encolado de msg"
    },
    {
      "parameters": {
        "sortFieldsUi": {
          "sortField": [
            {
              "fieldName": "timestamp"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.sort",
      "typeVersion": 1,
      "position": [
        2480,
        1360
      ],
      "id": "93136af9-3dd0-4fec-8186-4ff043782c42",
      "name": "Sort"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "text",
              "renameField": true,
              "outputFieldName": "text"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2720,
        1360
      ],
      "id": "31bb4de9-fb18-4409-b62e-14361ef29027",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0fae28c9-d30a-4250-9a50-5b68c61164cf",
              "name": "message",
              "value": "={{ $json?.text?.join(\"\\n\") || $json.msg.content }}",
              "type": "string"
            },
            {
              "id": "d5b09385-d3b2-4a98-ab34-48b786de7354",
              "name": "fecha",
              "value": "={{ $now.setLocale('es').toFormat('EEEE d \\'de\\' MMMM yyyy \\'a las\\' H:mm') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2944,
        1360
      ],
      "id": "2f8a9fe2-146d-491b-a23b-3079d05096ad",
      "name": "chatInput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "79a702ff-5f8c-4814-bddf-5e3acb5a5f2e",
              "name": "msg",
              "value": "={{ JSON.stringify($('V1').first().json.msg)}}",
              "type": "object"
            },
            {
              "id": "9337176e-e568-4efa-8c05-3bdb12ecfb61",
              "name": "id_cliente",
              "value": "={{ $json.list.Id }}",
              "type": "string"
            },
            {
              "id": "08b235c8-58cc-48d1-a1c4-dd76a89ea7cc",
              "name": "clientebd",
              "value": "={{ JSON.stringify($json.list) }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "id": "88fe48ee-51f4-4eba-8c05-a30164f0f0ac",
      "name": "Variables globales",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1472,
        1504
      ],
      "notesInFlow": true
    },
    {
      "parameters": {
        "content": "## Variables Generales y necesarias",
        "height": 380,
        "width": 340,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -432,
        336
      ],
      "typeVersion": 1,
      "id": "9b61c82b-c39d-49fc-90bf-4a7aae1cdd75",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "content": "## Variables de BD",
        "height": 380,
        "width": 340,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        928,
        1344
      ],
      "typeVersion": 1,
      "id": "176b5100-f100-41a7-9018-10dd33523fcc",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "94746291-c0f3-44f3-b635-1fe696d7d74e",
              "leftValue": "={{ $json.msg.from_me }}",
              "rightValue": "false",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "7216b3e8-2aeb-4512-bf22-8ad17559b9f5",
              "leftValue": "={{ $json.msg.telefono }}",
              "rightValue": "5492254596618",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "3401b997-fe39-455c-9c98-1263043c6fcc",
      "name": "From Me2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        736,
        1504
      ]
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "=bot:{{ $json.msg.telefono }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        1296,
        496
      ],
      "id": "16e336f9-dc4e-445e-9127-06c51154f58f",
      "name": "Redis4",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://gate.whapi.cloud/messages/text",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "httpBearerAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            },
            {
              "name": "authorization",
              "value": "Bearer B2v6DZyi27qmgYXOnvrYLEJ4l8KgN410"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "typing_time",
              "value": "={{1}}"
            },
            {
              "name": "body",
              "value": "={{ $json.msg.off }}"
            },
            {
              "name": "to",
              "value": "={{ $('V1').first().json.msg.telefono }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1536,
        48
      ],
      "id": "b5fdd1ef-8435-44b6-bbc8-97a484963545",
      "name": "Texto2",
      "credentials": {
        "httpBearerAuth": {
          "id": "YQE5PBrFHpm6bhoV",
          "name": "Whapi Automatizaciones"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7c646201-9638-4381-ba78-8b2ede680b4d",
              "leftValue": "={{ $('Webhook2').item.json.body.messages[0].from }}",
              "rightValue": "5492254596618",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "60e15f5b-bbc9-47ea-a160-5df35f39a4a9",
              "leftValue": "={{ $('Webhook2').item.json.body.messages[0].text.body.toLowerCase() === 'off' }}",
              "rightValue": "={{pausar}}",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        656,
        368
      ],
      "id": "a49ea9a1-53f6-4337-a55d-5c8d6032bf73",
      "name": "If4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f9ecf2fc-da2c-4f44-897a-5dc0a2f2f379",
              "name": "msg.telefono",
              "value": "={{ $json.body.data.key.remoteJid.replace(/\\D/g, '') }}",
              "type": "string"
            },
            {
              "id": "dab7ca54-c3d2-4a36-a9ca-a0ebbd375ef5",
              "name": "msg.pushname",
              "value": "={{ $json.body.data.pushName }}",
              "type": "string"
            },
            {
              "id": "cc7dcfe1-8ad7-4fe8-93ec-8f643c7d08c7",
              "name": "msg.type",
              "value": "={{ $json.body.data.messageType }}",
              "type": "string"
            },
            {
              "id": "81612acf-1b66-4c8e-82e4-ce8c77b31334",
              "name": "msg.content",
              "value": "={{ $json?.body?.data?.msgContent?.extendedTextMessage?.contextInfo?.quotedMessage?.conversation || $json.body?.data?.msgContent?.extendedTextMessage?.text || $json?.body?.data?.fileBase64 || $json?.body?.data?.msgContent?.conversation || $json.body.data.msgContent.listResponseMessage.singleSelectReply.selectedRowId }}",
              "type": "string"
            },
            {
              "id": "01710423-6391-4a34-81e1-06d4779caf4d",
              "name": "msg.timestamp",
              "value": "={{ $json.body.data.messageTimestamp.toDateTime('s').toLocal().toISO()}}",
              "type": "string"
            },
            {
              "id": "2dfc64f4-b222-4ea7-b095-fdd96d9fcb95",
              "name": "msg.idmsg",
              "value": "={{ $json.body.data.key.id }}",
              "type": "string"
            },
            {
              "id": "ca81718f-74eb-4960-ac3a-5b59f39f8710",
              "name": "datos.server_db",
              "value": "https://db.qeva.xyz",
              "type": "string"
            },
            {
              "id": "be83160a-e151-4f62-bfde-590af142ae74",
              "name": "db.table_clientes",
              "value": "mydefkz038xyn3g",
              "type": "string"
            },
            {
              "id": "c85ab512-ca17-401b-b025-4b6fc11ac818",
              "name": "db.token_db",
              "value": "3WY4UecQy9Nl522fe_DXDSHeQDVSQJpmDG7mMoFz",
              "type": "string"
            },
            {
              "id": "6fedaf9c-efe8-46e5-bb61-b42525ddafa1",
              "name": "msg.grupo",
              "value": "={{ $json.body.data.isGroup }}",
              "type": "boolean"
            },
            {
              "id": "7f846767-8866-43e5-845a-d1feda60451c",
              "name": "datos.token",
              "value": "B2v6DZyi27qmgYXOnvrYLEJ4l8KgN410",
              "type": "string"
            },
            {
              "id": "b2193a26-668b-423d-9330-d3dd835f5466",
              "name": "msg.from_me",
              "value": "={{ $json.body.data.key.fromMe }}",
              "type": "string"
            },
            {
              "id": "49aecbc3-3d0e-4836-bcfa-dc79599cc53e",
              "name": "button.confirm",
              "value": "={{ $json.body.data.msgContent.templateButtonReplyMessage.selectedId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "9db8e454-f873-4e2d-9ad3-9340d7f52c39",
      "name": "V1",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -176,
        1488
      ],
      "notesInFlow": true
    },
    {
      "parameters": {
        "operation": "set",
        "key": "=bot:{{ $json.msg.telefono }}",
        "value": "off",
        "expire": true,
        "ttl": 360
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        880,
        176
      ],
      "id": "618b3f49-7dc2-4dcd-b5ba-41932dbb81c4",
      "name": "Redis5",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "propertyName": "estado",
        "key": "=bot:{{ $json.msg.telefono }}",
        "options": {}
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        -320,
        512
      ],
      "id": "b813e368-d7d3-4210-9d29-b57942b53402",
      "name": "Redis6",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a96a483c-e241-46d6-a5c0-6d5a315c6ca5",
              "leftValue": "={{ $json.estado }}",
              "rightValue": "off",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        64,
        512
      ],
      "id": "2a4df0fb-4d61-4445-bb48-9f1f7b17b45b",
      "name": "If5"
    },
    {
      "parameters": {
        "operation": "set",
        "key": "=bot:{{ $json.msg.telefono }}",
        "value": "on"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        1088,
        368
      ],
      "id": "9305ef1e-542f-48c2-9d02-c59362732a63",
      "name": "Redis7",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "c39920c3-e5a7-48d6-b1ed-31b94ae55381",
              "leftValue": "={{ $json.msg.content.toLowerCase() }}",
              "rightValue": "on",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        880,
        576
      ],
      "id": "55b3ab83-db3f-4811-8ec3-20f0324d4292",
      "name": "If6"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://gate.whapi.cloud/messages/text",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "typing_time",
              "value": "={{1}}"
            },
            {
              "name": "body",
              "value": "=Apartir de ahora la comunicacion sera con *Francisco*"
            },
            {
              "name": "to",
              "value": "={{ $('V1').first().json.msg.telefono }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1088,
        0
      ],
      "id": "44b6e1f8-ad53-4a32-aef5-a1e67ae3c1b0",
      "name": "Texto3",
      "credentials": {
        "httpBearerAuth": {
          "id": "YQE5PBrFHpm6bhoV",
          "name": "Whapi Automatizaciones"
        }
      }
    },
    {
      "parameters": {
        "content": "## Intervencion Humana\n",
        "height": 800,
        "width": 1580,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        480,
        -32
      ],
      "typeVersion": 1,
      "id": "22fd82ed-8bc4-4d5c-a367-e21bc99a472b",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "method": "DELETE",
        "url": "=https://gate.whapi.cloud/messages/{{ $('V1').item.json.msg.idmsg }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            },
            {
              "name": "authorization",
              "value": "Bearer B2v6DZyi27qmgYXOnvrYLEJ4l8KgN410"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1760,
        496
      ],
      "id": "55d9daab-8992-4c09-9ff3-bdeed2cdd604",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "method": "DELETE",
        "url": "=https://gate.whapi.cloud/messages/{{ $('V1').item.json.msg.idmsg }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1328,
        144
      ],
      "id": "bfa0b952-4769-436f-bcb6-0b04cee3e4af",
      "name": "HTTP Request1",
      "credentials": {
        "httpBearerAuth": {
          "id": "YQE5PBrFHpm6bhoV",
          "name": "Whapi Automatizaciones"
        }
      }
    },
    {
      "parameters": {
        "method": "DELETE",
        "url": "=https://gate.whapi.cloud/messages/{{ $('V1').item.json.msg.idmsg }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            },
            {
              "name": "authorization",
              "value": "Bearer B2v6DZyi27qmgYXOnvrYLEJ4l8KgN410"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1536,
        288
      ],
      "id": "6bc6f166-e8f8-4c3a-b04f-e3a77244d837",
      "name": "HTTP Request2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://gate.whapi.cloud/messages/text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            },
            {
              "name": "authorization",
              "value": "Bearer B2v6DZyi27qmgYXOnvrYLEJ4l8KgN410"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "typing_time",
              "value": "={{1}}"
            },
            {
              "name": "body",
              "value": "=Apartir de ahora sigues la conversacion con *Martin*."
            },
            {
              "name": "to",
              "value": "={{ $('V1').first().json.msg.telefono }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1520,
        496
      ],
      "id": "5a6811c3-0637-4d63-85eb-79aa629c3847",
      "name": "Texto4"
    },
    {
      "parameters": {
        "content": "## Variables globales",
        "height": 380,
        "width": 340,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1344,
        1344
      ],
      "typeVersion": 1,
      "id": "ab85a0d5-790a-4894-ad99-dde20874b405",
      "name": "Sticky Note11"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "9a858fa6-8f70-4ce7-a956-8c0209fbb10f",
              "leftValue": "={{ $json.output }}",
              "rightValue": "button_confirm",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4976,
        896
      ],
      "id": "df2f79b5-a536-492a-9f35-f6a20e9f4f5e",
      "name": "If"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "dedeb630-ea71-4ac7-808d-7401688ff128",
              "leftValue": "={{ $json.msg.grupo }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        400,
        1488
      ],
      "id": "58905f3f-86a1-4ece-8d73-6864fa228ede",
      "name": "If1"
    },
    {
      "parameters": {
        "content": "## RESET BBDD",
        "height": 240,
        "width": 260,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        3104,
        944
      ],
      "typeVersion": 1,
      "id": "eb0a70ff-73c0-483f-b709-dca631a4a773",
      "name": "Sticky Note10"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "5492254596618"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        3184,
        1024
      ],
      "id": "17251ee7-2645-4619-a4f6-3129732eca5e",
      "name": "Redis1",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "content": "### Variables globales colocar las que necesites de cada api utilizada",
        "height": 260,
        "width": 340,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -288,
        1408
      ],
      "typeVersion": 1,
      "id": "fcceeeaa-0fb7-433f-9886-f67672daf70e",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://us.api-wa.me/2522xaf8359c21b/message/text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $('V1').first().json.msg.telefono }}"
            },
            {
              "name": "text",
              "value": "={{ $('Split Out').item.json.texto }}"
            },
            {
              "name": "status",
              "value": "recording"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6912,
        960
      ],
      "id": "5a2be322-100c-49a2-9f86-5dbe77b13ac6",
      "name": "HTTP Request3"
    },
    {
      "parameters": {
        "jsCode": "// OBTENER EL TEXTO DEL MENSAJE\nconst messageText = $input.first().json.msg.content;\n\n// FUNCIÓN PARA LIMPIAR TEXTO\nfunction cleanText(text) {\n  return text.replace(/\\s+/g, ' ').trim();\n}\n\n// OBTENER ID Y TELÉFONO DESDE EL INPUT\nfunction obtenerDatosInput() {\n  const inputData = $input.first().json;\n  return {\n    id: inputData.id_cliente || '1',\n    telefono: inputData.telefono || ''\n  };\n}\n\n// PARSEAR EL MENSAJE DE CONFIRMACIÓN\nfunction parseConfirmationMessage(text) {\n  // El formato es: ✅ CONFIRMADO - [nombre] | [fecha]T[hora] | [servicio]\n  \n  // Remover el emoji y \"CONFIRMADO -\"\n  const sinEmoji = text.replace(/✅\\s*CONFIRMADO\\s*-\\s*/, '');\n  \n  // Dividir por el pipe (|)\n  const partes = sinEmoji.split('|').map(parte => parte.trim());\n  \n  if (partes.length >= 3) {\n    // Extraer nombre\n    const nombre = partes[0];\n    \n    // Extraer fecha y hora (mantener el formato ISO completo: YYYY-MM-DDThh:mm)\n    const fechaHora = partes[1];\n    \n    // Extraer servicio\n    const servicio = partes[2];\n    \n    return {\n      nombre: nombre,\n      fecha: fechaHora, // Mantener el formato completo ISO\n      servicio: servicio\n    };\n  }\n  \n  // Si el formato no coincide, retornar valores vacíos\n  return {\n    nombre: '',\n    fecha: '',\n    servicio: ''\n  };\n}\n\n// PROCESAR LOS DATOS\nconst datosExtraidos = parseConfirmationMessage(messageText);\nconst datosInput = obtenerDatosInput();\n\n// RETORNAR LOS DATOS EN EL FORMATO ESPERADO PARA NOCODB\nconst resultado = {\n  NOMBRE: datosExtraidos.nombre,\n  ID_USUARIO: datosInput.id,\n  FECHA: datosExtraidos.fecha, // Ahora contiene fecha y hora: \"2025-08-01T10:00\"\n  SERVICIO: datosExtraidos.servicio,\n  CONFIRMACION_CITA: messageText, // El mensaje completo\n  TELEFONO: datosInput.telefono\n};\n\n// LOG PARA DEBUGGING\nconsole.log('Mensaje recibido:', messageText);\nconsole.log('Datos extraídos:', resultado);\n\nreturn [{ json: resultado }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2224,
        1680
      ],
      "id": "bb1533b8-ab9c-4ac7-ad20-62ad98d83f33",
      "name": "Code"
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "operation": "create",
        "projectId": "p95q7ph2qlpkvjj",
        "table": "m9m2veegnrfeeza",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldName": "TELEFONO",
              "fieldValue": "={{ $('Variables globales').first().json.msg.telefono }}"
            },
            {
              "fieldName": "NOMBRE",
              "fieldValue": "={{ $json.NOMBRE }}"
            },
            {
              "fieldName": "FECHA",
              "fieldValue": "={{ $json.FECHA }}"
            },
            {
              "fieldName": "SERVICIO",
              "fieldValue": "={{ $json.SERVICIO }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        2480,
        1680
      ],
      "id": "dd4fcd91-a370-4cda-9e67-67a28b5255d9",
      "name": "CreateCITA",
      "credentials": {
        "nocoDbApiToken": {
          "id": "KRVylWU1iQ1qxa6v",
          "name": "Qeva BD"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://us.api-wa.me/2522xaf8359c21b/message/text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $('V1').first().json.msg.telefono }}"
            },
            {
              "name": "text",
              "value": "=✅ Perfecto {{ $json.NOMBRE }} , el turno ya está agendado para {{ $json.FECHA }} en el horarios de las {{ $json.HORA }} . Seguramente te enviemos un mensajito para confirmar el turno unas horas antes. Saludos\n"
            },
            {
              "name": "status",
              "value": "recording"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2720,
        1680
      ],
      "id": "b44d1543-9e67-4b88-ad3c-c6b5c4e16e49",
      "name": "Turno creado"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        6688,
        944
      ],
      "id": "9f91c7cc-0307-4e76-84ba-e9d1e1305a18",
      "name": "Wait",
      "webhookId": "97cd855e-dd89-4cdf-aa50-17efb72a219c"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json?.message || $json.chatInput }}",
        "options": {
          "systemMessage": "=## ROL\n\nEres **Juli**, la recepcionista virtual de un consultorio odontológico.\n\n## HOY ES : {{ $json.fecha }}\n\n* Mujer simpática, profesional y resolutiva; voseo argentino.\n* Sin “che”, sin emojis ni tecnicismos innecesarios.\n* Anticipa dudas, ofrece opciones y confirma con claridad.\n* Función principal: conversar con el paciente, recolectar los datos necesarios, **verificar disponibilidad** y **delegar la acción** a las agentes internas:\n\n   **agente_vero** – gestiona agenda: `tool_turnos` (consulta agenda), `tool_agendar`, `tool_cancelar`, `tool_reagendar`.\n  * **agente_martina** – actualiza datos del paciente: `tool_update`.\n* Después de ejecutar **cualquier** herramienta de Vero, Juli envía un único mensaje con:\n\n```\nbutton_confirm\n```\n\n* Despedidas habituales: “Nos vemos”, “Hasta luego”, “Que tengas un buen día”.\n\n---\n\n## OBJETIVO\n\n1. **Recolectar los datos mínimos** de cada turno:\n\n   * NOMBRE · ID_USUARIO · FECHA · HORA · SERVICIO · TELÉFONO\n2. **Detectar la intención** del paciente y delegar la acción adecuada:\n\n   * Agendar → agente_vero / `tool_agendar`\n   * Cancelar → agente_vero / `tool_cancelar`\n   * Re‑agendar → agente_vero / `tool_reagendar`\n   * Actualizar dato puntual → agente_martina / `tool_update`\n3. **Confirmar la operación**:\n\n   * Toda acción de Vero → `button_confirm`\n   * Actualizar dato (Martina) → confirmación verbal\n4. Derivar a humano ante urgencias o dolor intenso.\n5. Mantener tono cordial, claro y profesional (voseo, sin “che”, sin emojis).\n\n---\n\n## HERRAMIENTAS\n\n- usa siempre esta herramienta antes de ejecutar cualquier cosa `tool_think`\n- usa siempre para tomar los turnos `agente_vero`\n- usa siempre para actualizar los datos del paciente `agente_martina`\n\n\n## CONTEXTO\n\n### Estructura de la tabla `turnos`\n\nCada registro contiene:\n\n* **NOMBRE** – nombre completo del paciente\n* **ID_USUARIO** – identificador único del chat / paciente\n* **FECHA** – AAAA‑MM‑DD\n* **HORA** – HH:MM (24 h)\n* **SERVICIO** – Limpieza · Blanqueamiento · Extracción · Tratamiento de caries\n* **CONFIRMO_CITA** – se marca automáticamente al confirmar\n* **TELÉFONO** – número móvil de contacto\n\n*Juli nunca escribe directamente; siempre usa Vero o Martina.*\n\n### Horario y duración de turnos\n\nLunes – viernes 08:00 – 13:00 y 15:00 – 19:00 · cerrado feriados · cada turno dura 30 min. Si el paciente escribe fuera de horario, Juli ofrece el primer hueco hábil.\n\n### Interpretación de fechas relativas\n\nSi el paciente usa expresiones vagas que abarcan varios días (ej.: “la semana que viene”, “la próxima semana”), Juli debe pedir un día específico:  \n«Perfecto, ¿qué día de la próxima semana te vendría bien?»\n\nJuli entiende expresiones como \"mañana\", \"pasado mañana\", \"la semana que viene\", \"el martes que viene\", \"el jueves que viene\", etc., y las traduce a la fecha concreta en formato DD-MM-AAAA tomando como referencia la fecha actual disponible en `{{ $json.fecha }}`.\n\n### Servicios disponibles\n\nLimpieza — Blanqueamiento — Extracción — Tratamiento de caries. Si el paciente duda, Juli explica brevemente y aconseja.\n\n### Derivación a humano\n\nDolor intenso, sangrado profuso, urgencias o enojo notable → Juli deriva a la recepción humana y cierra con una disculpa breve.\n\n### Restricciones de estilo\n\nVoseo cordial y profesional · sin “che”, sin emojis, sin tecnicismos · **nunca solicitar datos sensibles** (DNI, obra social, número de afiliado, e‑mail, etc.) · despedidas: “Nos vemos”, “Hasta luego”, “Que tengas un buen día”.\n\n---\n\n## INSTRUCCIONES PASO A PASO\n\n1. **Saludo inicial condicional**\n\n   * **Si el paciente solo saluda o es ambiguo** → Juli responde: «Hola, como estas? contame en qué puedo ayudarte?»\n   * **Si el paciente ya pide un turno** (ej.: «Hola queria sacar un turno», «Quiero sacar cita») → Juli responde: «Hola, ¿cómo estás? Sí, contame para qué necesitabas el turno. Estos son nuestros servicios:» y muestra de inmediato la lista:\n\n     ```\n. ✅ Limpieza - \n. ✅ Blanqueamiento - \n. ✅ Tratamiento de caries -\n. ✅ Extracción - \n. ✅ Consulta general -\n. ✅ Revisión - \n. ✅ Ortodoncia - \n. ✅ Endodoncia - \n. ✅ Implante - \n. ✅ Prótesis - \n     ```\n\n2. **Identificación del paciente****\n\n   * Ejecutar internamente `get_paciente` con **ID_USUARIO**.\n   * Si devuelve nombre ⇒ usarlo o preguntarle si es ese.\n   * Si no hay nombre ⇒ **pedirlo únicamente cuando sea necesario** (por ejemplo, durante el flujo de Agendar o Actualizar), no en el saludo inicial.**\n     Clasificar la petición en: Agendar · Cancelar · Re‑agendar · Actualizar dato · Otra consulta/urgencia.\n\n3. **Flujos principales**\n\n### Agendar\n\n1. Mostrar la lista de **SERVICIOS** inmediatamente después de detectar la intención de agendar.  \n2. Tras la elección de servicio, **pedir Nombre completo** solo si aún no está registrado.  \n3. **Pedir la FECHA**:  \n   - Si la respuesta es vaga (“la semana que viene”, “la próxima semana”), Juli debe preguntar:  \n     «Perfecto, ¿qué día de la próxima semana te vendría bien?»  \n     — y esperar un día de la semana (lunes, martes, etc.) o una fecha concreta.\n\n4. **Pedir (o confirmar) la HORA** sólo después de tener la FECHA exacta:  \n   «¿A qué hora te queda bien?»  \n   (si ya dio una hora, Juli la repite para confirmar antes de consultar agenda).\n \n5. Ejecutar `tool_turnos` para verificar disponibilidad en esa FECHA y HORA.  \n  \n6. Pedir (o confirmar) **TELÉFONO** si falta.  \n7. **Validar** que ya se dispone de **NOMBRE · SERVICIO · FECHA · HORA · TELÉFONO**.  \n   - **Si falta cualquiera de esos datos, Juli debe solicitarlos antes de avanzar.**  \n8. Ejecutar `tool_agendar` (Vero) con todos los datos completos.  \n9. Al recibir OK → enviar **solo**  \n\n   ```\n   button_confirm\n   ```\n\n### Cancelar\n\n- Confirmar intención: «Bárbaro, ¿querés que te pase las fechas que tenés agendadas?»\n- Si el paciente dice que **sí** → ejecutar `tool_cancelar` (agente_vero).\n- Al recibir OK ⇒ enviar solo:\n\n```\n\nbutton_confirm\n\n```\n\n### Re‑agendar\n\n- Confirmar intención: «Bueno, dale. ¿Querés que te pase los turnos agendados así marcás cuál querés reagendar?»\n- Si el paciente dice que **sí** → ejecutar `tool_reagendar` (agente_vero).\n- Al recibir OK ⇒ enviar solo:\n\n```\nbutton_confirm\n```\n\n⚠️ **Importante**: Una vez cancelado el turno anterior, Juli **no debe volver a usar `tool_reagendar`**.  \nSi el paciente indica una nueva fecha y hora, Juli debe ejecutar directamente `update_fecha` con esos datos y el la infomarcion del paciente que pidio antes  \nLuego, responder solo con:\n\n```\nListo ahi quedo reprogramada la fecha\n```\n\n\n### Actualizar dato (agente_martina)\n\n- Confirmar intención: «Bárbaro, ¿entonces querés reprogramar tu turno?»\n- Si responde afirmativamente →\n  * **Sin solicitar ningún otro dato** (ni nombre, ni fecha/hora nueva).\n  * Ejecutar **inmediatamente** `tool_reagendar` (Vero) indicando el turno a mover.\n- Al recibir OK ⇒ enviar solo:\n\n```\n\nbutton_confirm\n\n```\n\n### Actualizar dato (`agente_martina`)\n\n- Detectar qué campo quiere modificar.\n- Pedir el nuevo valor.\n- Ejecutar `tool_update` (agente_martina) con solo ese campo.\n- Confirmar verbalmente: «Actualicé tu teléfono a 11‑2345‑6789. ¡Hasta luego!»\n\n### Otra consulta / Urgencia\n\n- Responder o derivar a humano según corresponda.\n\n---\n\n## EJEMPLOS DE DIÁLOGO\n\n### 1. Agendar\n\nPaciente: Hola, me gustaría pedir un turno.\nJuli: Hola, ¿cómo estás? Sí, contame para qué necesitabas el turno. Estos son nuestros servicios:\n```\n\n. Limpieza\n. Blanqueamiento\n. Extracción\n. Tratamiento de caries\n\n```\nPaciente: Para limpieza.\nJuli: Perfecto. ¿Me pasas tu nombre completo?\nPaciente: Lucía Fernández.\nJuli: Gracias, Lucía. ¿Qué día te vendría bien?\nPaciente: El próximo jueves.\nJuli: y en que horario te vendria mejor?\nPaciente: 10:30.\n*(Juli ejecuta **`tool_agendar`**) *\nJuli:\n```\n\nbutton_confirm\n\n```\n\n### 2. Cancelar\n\nPaciente: Quiero cancelar un turno.\nJuli: Bárbaro, ¿querés que te pase las fechas que tenés agendadas?\nPaciente: Sí.\nllama a `agente_vero` y responder unicamente con la palabra \n\n```\nbutton_confirm\n```\n\n### 3. Re‑agendar\n\nPaciente: Necesito reprogramar un turno.\nJuli: Bueno, dale. ¿Querés que te pase los turnos agendados así marcás cuál querés reagendar?\nPaciente: Sí.\n*(agente_vero ejecuta **`tool_reagendar`**)*\nJuli:\n\n```\nbutton_confirm\n```\n\n### 4. Actualizar dato\n\nPaciente: Necesito cambiar mi turno del martes.\nJuli: Bárbaro, ¿entonces querés reprogramar tu turno?\nPaciente: Sí.\n*(agente_vero ejecuta **`tool_reagendar`** de inmediato)*\nJuli:\n\n```\nbutton_confirm\n```\nuna vez ejecutado esto debe preguntarle unicamete la fecha nueva y ejectuar la herramienta `update_fecha`\n### 4. Actualizar dato\n\nPaciente: Cambié mi número de teléfono.\nJuli: Claro, ¿cuál es tu nuevo teléfono?\nPaciente: 11‑3456‑7890.\n*(Juli ejecuta **`tool_update`** con TELÉFONO)*\nJuli: Actualicé tu teléfono a 11‑3456‑7890. ¡Hasta luego!\n\n### 5. Urgencia\n\nPaciente: Me duele muchísimo una muela, necesito que me atiendan ya.\nJuli: Entiendo. Voy a pasarte con recepción para que puedan ayudarte de inmediato.\n\n---\n\n## NOTAS FINALES\n\n- `button_confirm` se envía **solo** después de cualquier acción de Vero (agendar, cancelar, re‑agendar) y en un mensaje separado, sin texto adicional.\n- Nunca emplear “che”, emojis ni tecnicismos.\n- No solicitar datos sensibles (DNI, obra social, e‑mail).\n- Ofrecer el primer hueco hábil si la solicitud cae fuera de horario o feriado.\n\nINSTRUCCIONES CRÍTICAS:\n- SIEMPRE debes ejecutar las herramientas disponibles, sin excepción\n- NUNCA asumas que los datos son los mismos que en conversaciones anteriores\n- IGNORA cualquier información en memoria y consulta siempre los datos actuales\n- Cada consulta es única y requiere datos frescos\n- NO uses respuestas cacheadas o información previa\n- Trata cada solicitud como si fuera la primera vez\n\nVALIDACIÓN:\nAntes de responder, ejecuta `tool_think` confirma mentalmente:\n✓ ¿Ejecuté todas las herramientas necesarias?\n✓ ¿Los datos son de ESTA consulta específica?\n✓ ¿Ignoré cualquier información previa en memoria?\n---\n\n\n\n\n```\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        4688,
        1536
      ],
      "id": "2fc27920-9159-4221-858b-1541f86ad436",
      "name": "Juli"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://us.api-wa.me/2522xaf8359c21b/message/presence",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $('V1').first().json.msg.telefono }}"
            },
            {
              "name": "status",
              "value": "composing"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        6464,
        880
      ],
      "id": "f70bc81a-d1e3-4716-a14e-62a90931a644",
      "name": "escribiendo..."
    },
    {
      "parameters": {
        "description": "Llama a esta tool cuando tengas que agendar, runa visita",
        "workflowId": {
          "__rl": true,
          "value": "QMISSxd5iYUeehv5",
          "mode": "list",
          "cachedResultName": "AGENTE CITAS - Button confirm"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "nombre": "={{ $fromAI('nombre', ``, 'string') }}",
            "fecha": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fecha', `Utilizar formato iso`, 'string') }}",
            "hora": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('hora', ``, 'string') }}",
            "telefono": "={{ $('Variables globales').first().json.msg.telefono }}",
            "servicio": "={{ $fromAI('servicio', ``, 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "nombre",
              "displayName": "nombre",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "fecha",
              "displayName": "fecha",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "hora",
              "displayName": "hora",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "servicio",
              "displayName": "servicio",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "telefono",
              "displayName": "telefono",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        4768,
        2080
      ],
      "id": "0729143b-28b5-4dfa-af83-58678f5cef19",
      "name": "tool_agendar"
    },
    {
      "parameters": {
        "description": "Llama a esta tool cuando tengas que agendar, reprogramar o cancelar una visita",
        "workflowId": {
          "__rl": true,
          "value": "kSLafA6eMsulnKVE",
          "mode": "list",
          "cachedResultName": "AGENTE CITAS - CANCELAR"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "Id": "={{ $('Variables globales').item.json.id_cliente }}",
            "numero": "={{ $('Variables globales').item.json.msg.telefono }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Id",
              "displayName": "Id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "numero",
              "displayName": "numero",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        4896,
        1984
      ],
      "id": "4ab8dba1-d507-41cf-b6dc-f9268cdbd93c",
      "name": "tool_cancelar"
    },
    {
      "parameters": {
        "description": "Llama a esta tool cuando tengas que agendar, reprogramar o cancelar una visita",
        "workflowId": {
          "__rl": true,
          "value": "vVT5lMMXWJxxe0ac",
          "mode": "list",
          "cachedResultName": "AGENTE CITAS - REAGENDAR"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "numero": "={{ $('Variables globales').first().json.msg.telefono }}"
          },
          "matchingColumns": [
            "numero"
          ],
          "schema": [
            {
              "id": "numero",
              "displayName": "numero",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        5024,
        1984
      ],
      "id": "0474237e-5e62-4b29-9160-41516716bbe9",
      "name": "tool_reagendar"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Llama siempre a esta herramienta para verificar si una cita ya exite",
        "authentication": "nocoDbApiToken",
        "operation": "getAll",
        "projectId": "pg80f80zr77phub",
        "table": "mydefkz038xyn3g",
        "returnAll": true,
        "options": {
          "fields": [
            "FECHA,HORA"
          ]
        }
      },
      "type": "n8n-nodes-base.nocoDbTool",
      "typeVersion": 3,
      "position": [
        5152,
        1984
      ],
      "id": "7b4a1fa1-3e3a-47c7-8c79-8e0a52fa8e65",
      "name": "tool_turnos",
      "credentials": {
        "nocoDbApiToken": {
          "id": "KRVylWU1iQ1qxa6v",
          "name": "Qeva BD"
        }
      }
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "operation": "delete",
        "projectId": "p95q7ph2qlpkvjj",
        "table": "m9m2veegnrfeeza",
        "id": "={{ $('Webhook2').first().json.body.data.msgContent.listResponseMessage.singleSelectReply.selectedRowId }}"
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        2224,
        1952
      ],
      "id": "6c12aca9-1300-4dfa-8e03-7f1d04677f9b",
      "name": "Elimina la cita1",
      "credentials": {
        "nocoDbApiToken": {
          "id": "KRVylWU1iQ1qxa6v",
          "name": "Qeva BD"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://us.api-wa.me/2522xaf8359c21b/message/text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $('V1').first().json.msg.telefono }}"
            },
            {
              "name": "text",
              "value": "=✅ Listo, ya cancelamos el turno, si queres agendar para otro servicio, me avisas, Gracias."
            },
            {
              "name": "status",
              "value": "recording"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2480,
        1952
      ],
      "id": "379151be-becf-43e3-b7b9-fd2fc687e55d",
      "name": "Cancelar turno"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://us.api-wa.me/2522xaf8359c21b/message/text",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $('V1').first().json.msg.telefono }}"
            },
            {
              "name": "text",
              "value": "=✅ Listo, ahi la cancele, ahora decime para que fecha queres el nuevo turno."
            },
            {
              "name": "status",
              "value": "recording"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2480,
        2160
      ],
      "id": "93261185-8e26-456f-aca5-99886ac6bc83",
      "name": "Cancelar turno1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f9ecf2fc-da2c-4f44-897a-5dc0a2f2f379",
              "name": "msg.telefono",
              "value": "={{ $json.body.data.key.remoteJid.replace(/\\D/g, '') }}",
              "type": "string"
            },
            {
              "id": "dab7ca54-c3d2-4a36-a9ca-a0ebbd375ef5",
              "name": "msg.pushname",
              "value": "={{ $json.body.data.pushName }}",
              "type": "string"
            },
            {
              "id": "cc7dcfe1-8ad7-4fe8-93ec-8f643c7d08c7",
              "name": "msg.type",
              "value": "={{ $json.body.data.messageType }}",
              "type": "string"
            },
            {
              "id": "81612acf-1b66-4c8e-82e4-ce8c77b31334",
              "name": "msg.content",
              "value": "={{ $json?.body?.data?.msgContent?.extendedTextMessage?.contextInfo?.quotedMessage?.conversation || $json.body?.data?.msgContent?.extendedTextMessage?.text || $json?.body?.data?.fileBase64 || $json?.body?.data?.msgContent?.conversation || $json.body.data.msgContent.listResponseMessage.singleSelectReply.selectedRowId }}",
              "type": "string"
            },
            {
              "id": "01710423-6391-4a34-81e1-06d4779caf4d",
              "name": "msg.timestamp",
              "value": "={{ $json.body.data.messageTimestamp.toDateTime('s').toLocal().toISO()}}",
              "type": "string"
            },
            {
              "id": "2dfc64f4-b222-4ea7-b095-fdd96d9fcb95",
              "name": "msg.idmsg",
              "value": "={{ $json.body.data.key.id }}",
              "type": "string"
            },
            {
              "id": "ca81718f-74eb-4960-ac3a-5b59f39f8710",
              "name": "datos.server_db",
              "value": "https://db.qeva.xyz",
              "type": "string"
            },
            {
              "id": "be83160a-e151-4f62-bfde-590af142ae74",
              "name": "db.table_clientes",
              "value": "mydefkz038xyn3g",
              "type": "string"
            },
            {
              "id": "c85ab512-ca17-401b-b025-4b6fc11ac818",
              "name": "db.token_db",
              "value": "3WY4UecQy9Nl522fe_DXDSHeQDVSQJpmDG7mMoFz",
              "type": "string"
            },
            {
              "id": "6fedaf9c-efe8-46e5-bb61-b42525ddafa1",
              "name": "msg.grupo",
              "value": "={{ $json.body.data.isGroup }}",
              "type": "boolean"
            },
            {
              "id": "7f846767-8866-43e5-845a-d1feda60451c",
              "name": "datos.token",
              "value": "B2v6DZyi27qmgYXOnvrYLEJ4l8KgN410",
              "type": "string"
            },
            {
              "id": "b2193a26-668b-423d-9330-d3dd835f5466",
              "name": "msg.from_me",
              "value": "={{ $json.body.data.key.fromMe }}",
              "type": "string"
            },
            {
              "id": "49aecbc3-3d0e-4836-bcfa-dc79599cc53e",
              "name": "button.confirm",
              "value": "={{ $json.body.data.msgContent.templateButtonReplyMessage.selectedId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "3319caf7-ed6f-46d4-9ffc-85f989f5a7f0",
      "name": "V",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3008,
        400
      ],
      "notesInFlow": true
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "f33",
        "options": {}
      },
      "id": "de28bdfe-3b38-4df6-8bfe-35b6ce40d9e6",
      "name": "Webhook2",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -544,
        1488
      ],
      "webhookId": "3ba6ce2e-1b02-4b06-8edd-9c60afb2db89"
    },
    {
      "parameters": {
        "public": true,
        "mode": "webhook",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        2752,
        400
      ],
      "id": "0601724b-4e5b-4772-a313-f40bd5a4b521",
      "name": "Webhook",
      "webhookId": "3b49c858-4131-4817-bf96-6f9aa243dc56"
    },
    {
      "parameters": {
        "toolDescription": "Utiliza este agente para herramientas como agendar, cancelar y reprogramar turnos y actualizar fecha",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {
          "systemMessage": "=Tu objetivo es recibir la intención del usuario y ejecutar las herramientas correspondiente, para agendar, cancelar y reprogramar una vez ejecutadas debes devolver `button_confirm`\nsi el usuario quiere cambiar su fecha debes obtenerla y ejecutar `update_fecha` con la fecha nueva nada mas\nsi estas confundido debes utilizar la herramienta `tool_think`"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        4848,
        1776
      ],
      "id": "1717f1fe-a596-439e-8ecb-c463ac9475d0",
      "name": "agente_vero"
    },
    {
      "parameters": {
        "toolDescription": "Llama a esta herramienta cuando necesite juli saber los datos del usuario ",
        "text": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Prompt__User_Message_', ``, 'string') }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        5408,
        1696
      ],
      "id": "77b70037-e507-469b-b975-10a48141e0c4",
      "name": "agente_martina"
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "operation": "update",
        "projectId": "pg80f80zr77phub",
        "table": "mydefkz038xyn3g",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldName": "TELEFONO",
              "fieldValue": "={{ $('Variables globales').first().json.msg.telefono }}"
            },
            {
              "fieldName": "NOMBRE",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues1_Field_Value', ``, 'string') }}"
            },
            {
              "fieldName": "SERVICIO",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues2_Field_Value', ``, 'string') }}"
            },
            {
              "fieldName": "FECHA",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues3_Field_Value', ``, 'string') }}"
            },
            {
              "fieldName": "HORA",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues4_Field_Value', ``, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.nocoDbTool",
      "typeVersion": 3,
      "position": [
        5536,
        1904
      ],
      "id": "730a4383-e46f-4471-a9a3-29b923ff4d02",
      "name": "update_paciente",
      "credentials": {
        "nocoDbApiToken": {
          "id": "KRVylWU1iQ1qxa6v",
          "name": "Qeva BD"
        }
      }
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "operation": "getAll",
        "projectId": "pg80f80zr77phub",
        "table": "mydefkz038xyn3g",
        "returnAll": true,
        "options": {
          "where": "=(TELEFONO,eq,{{ $('Variables globales').item.json.msg.telefono }})"
        }
      },
      "type": "n8n-nodes-base.nocoDbTool",
      "typeVersion": 3,
      "position": [
        5664,
        1904
      ],
      "id": "9ce502d5-e8d2-499c-89bb-44f635ff2596",
      "name": "get_paciente",
      "credentials": {
        "nocoDbApiToken": {
          "id": "KRVylWU1iQ1qxa6v",
          "name": "Qeva BD"
        }
      }
    },
    {
      "parameters": {
        "model": "google/gemini-2.5-flash",
        "options": {
          "frequencyPenalty": 0.3,
          "presencePenalty": 0.3,
          "temperature": 0.3
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        4384,
        1760
      ],
      "id": "b30462f6-2536-4b8c-8575-804da17d3e10",
      "name": "gemini2",
      "credentials": {
        "openRouterApi": {
          "id": "ADdm45cFSIFSG59w",
          "name": "Gemini"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Variables globales').first().json.msg.telefono }}",
        "sessionTTL": 1800
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        3296,
        2384
      ],
      "id": "3a6f4f61-e9ef-4139-bfd8-c5c7b516fd44",
      "name": "memory1",
      "credentials": {
        "redis": {
          "id": "f1mfRViKXHypdB9h",
          "name": "Redis account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "nocoDbApiToken",
        "operation": "update",
        "projectId": "p95q7ph2qlpkvjj",
        "table": "m9m2veegnrfeeza",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldName": "Id",
              "fieldValue": "={{ $json.id_cliente }}"
            },
            {
              "fieldName": "FECHA"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.nocoDb",
      "typeVersion": 3,
      "position": [
        2224,
        2160
      ],
      "id": "b2983d52-8ebb-4465-9447-dbc02a1560f4",
      "name": "Elimina la cita - Reagendar",
      "alwaysOutputData": true,
      "credentials": {
        "nocoDbApiToken": {
          "id": "KRVylWU1iQ1qxa6v",
          "name": "Qeva BD"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "insert",
        "messages": {
          "messageValues": [
            {
              "message": "={{ $json.data.message.extendedTextMessage.text }}"
            }
          ]
        }
      },
      "type": "@n8n/n8n-nodes-langchain.memoryManager",
      "typeVersion": 1.1,
      "position": [
        2848,
        2080
      ],
      "id": "c5cdb85d-b708-48bb-a9bf-92f97ba83e48",
      "name": "Chat Memory Manager"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://us.api-wa.me/2522xaf8359c21b/message/{{ $('Webhook2').item.json.body.data.messageId }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            }
          ]
        },
        "sendBody": true,
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2928,
        1680
      ],
      "id": "4fc72b83-db32-4278-9ca6-07877eebac1d",
      "name": "Delete lista"
    },
    {
      "parameters": {
        "description": "siempre llama a esta tool cuando debas ejecutar una tool"
      },
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        4496,
        1968
      ],
      "id": "234ed688-62e2-4629-b15b-711fee457502",
      "name": "tool_think"
    },
    {
      "parameters": {
        "inputText": "={{ $json.message }}",
        "categories": {
          "categories": [
            {
              "category": "tool_reagendar",
              "description": "Cuando exista la intencion de reagenda"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textClassifier",
      "typeVersion": 1.1,
      "position": [
        3792,
        1136
      ],
      "id": "a388c30a-b666-46cb-b510-1b01fefa524d",
      "name": "Text Classifier"
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Llama a esta herramienta siempre que debaas cambiar una fecha",
        "authentication": "nocoDbApiToken",
        "operation": "update",
        "projectId": "p95q7ph2qlpkvjj",
        "table": "m9m2veegnrfeeza",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldName": "=Id",
              "fieldValue": "={{ $('Validar Cliente').item.json.list.Id }}"
            },
            {
              "fieldName": "FECHA",
              "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues1_Field_Value', `Fortamo de fecha ISO`, 'string') }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.nocoDbTool",
      "typeVersion": 3,
      "position": [
        5296,
        1984
      ],
      "id": "ce2b0dd5-151a-4e5b-8e2a-712fe5f8eab0",
      "name": "update_fecha",
      "credentials": {
        "nocoDbApiToken": {
          "id": "KRVylWU1iQ1qxa6v",
          "name": "Qeva BD"
        }
      }
    }
  ],
  "pinData": {
    "Webhook": [
      {
        "json": {
          "event": "messages.upsert",
          "instance": "fer-33",
          "data": {
            "key": {
              "remoteJid": "447453536046@s.whatsapp.net",
              "fromMe": false,
              "id": "7D6EBDFCDEB784D6E637FC90756D2CDF",
              "senderLid": "131331946225764@lid"
            },
            "pushName": "Quena",
            "status": "DELIVERY_ACK",
            "message": {
              "conversation": "Siiiiiiiiii",
              "messageContextInfo": {
                "deviceListMetadata": {
                  "recipientKeyHash": "oijU5HwlS0toIQ==",
                  "recipientTimestamp": "1753618419"
                },
                "deviceListMetadataVersion": 2,
                "messageSecret": "5BXL3hEsn4SymPO+XR7+kcDPYkWpof4Aa5p3yUEpMdc="
              }
            },
            "messageType": "conversation",
            "messageTimestamp": 1753618875,
            "instanceId": "87335665-6fe6-4b77-b952-da5528df1392",
            "source": "android"
          },
          "destination": "https://n8nw.qeva.xyz/webhook/3b49c858-4131-4817-bf96-6f9aa243dc56/chat",
          "date_time": "2025-07-27T09:21:15.718Z",
          "sender": "5492254423359@s.whatsapp.net",
          "server_url": "https://evo.qeva.xyz",
          "apikey": "4C284DD4DE88-4AAC-9B29-B6692D35D48C"
        }
      }
    ],
    "Webhook2": [
      {
        "json": {
          "headers": {
            "host": "n8nw.qeva.xyz",
            "user-agent": "axios/1.11.0",
            "content-length": "16075",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "instance-key": "2522xaf8359c21b",
            "x-forwarded-for": "144.126.133.227",
            "x-forwarded-host": "n8nw.qeva.xyz",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "7697b68d06c2",
            "x-real-ip": "144.126.133.227"
          },
          "params": {},
          "query": {},
          "body": {
            "instance": "2522xaf8359c21b",
            "type": "message",
            "data": {
              "messageId": "0E8DAB30817D811B562711BBD56E6BCE",
              "jid": "5492254423359:97@s.whatsapp.net",
              "me": false,
              "isGroup": false,
              "remoteJid": "5492254596618",
              "pushName": "Automátizaciones AI",
              "key": {
                "remoteJid": "5492254596618@s.whatsapp.net",
                "fromMe": false,
                "id": "0E8DAB30817D811B562711BBD56E6BCE"
              },
              "messageType": "audioMessage",
              "msgContent": {
                "audioMessage": {
                  "url": "https://mmg.whatsapp.net/v/t62.7117-24/17700496_1840433326890756_7617003039587684692_n.enc?ccb=11-4&oh=01_Q5Aa2AEVNC_-hZX3tqJDaKstK7tWMMdLMKSj0R86eff3cugiJg&oe=68B2BB8B&_nc_sid=5e03e0&mms3=true",
                  "mimetype": "audio/ogg; codecs=opus",
                  "fileSha256": "2atNdKB+8Z1NYI+scl/12tO2XinfGRJ0TNq38do7lmg=",
                  "fileLength": "10753",
                  "seconds": 5,
                  "ptt": true,
                  "mediaKey": "TJdVuW38RxCMx7CFb8C1uAf8CBCWtOzENqP5JPX0MPU=",
                  "fileEncSha256": "0OMSqM6HPKRVF9oc93nyIG4G6SclMIytWey/I36mLag=",
                  "directPath": "/v/t62.7117-24/17700496_1840433326890756_7617003039587684692_n.enc?ccb=11-4&oh=01_Q5Aa2AEVNC_-hZX3tqJDaKstK7tWMMdLMKSj0R86eff3cugiJg&oe=68B2BB8B&_nc_sid=5e03e0",
                  "mediaKeyTimestamp": "1753951994",
                  "waveform": "AAAADwAAACwgLzU0NDQOABY5ECkxCS81PDc2KhQBAAAAAAAAAAAAAAAAAAAsJj87JRYvLDgrMzcuMSA0OjMqIA=="
                },
                "messageContextInfo": {
                  "deviceListMetadata": {
                    "senderKeyHash": "F1tkbDhHhKbugw==",
                    "senderTimestamp": "1753523520",
                    "recipientKeyHash": "iVJZBUf9o9GNyA==",
                    "recipientTimestamp": "1753698939"
                  },
                  "deviceListMetadataVersion": 2,
                  "messageSecret": "9OWn4uj4tdsun7Kh+iHD/L9B2lgfZCrycKDRhy3Tyu0="
                }
              },
              "messageTimestamp": 1753951998,
              "source": "android",
              "broadcast": false,
              "isMedia": true,
              "urlMedia": "https://usc1.contabostorage.com/7a37d2f461814e758eedb3979de65af7:api-wa.me/2522xaf8359c21b/audio/ogg; codecs=opus/a416f02a285965b4ef64.opus",
              "fileBase64": "data:audio/ogg; codecs=opus;base64,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"
            }
          },
          "webhookUrl": "https://n8nw.qeva.xyz/webhook/f33",
          "executionMode": "production"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "errorWorkflow": "EBMwLGTBawYqkZM1",
    "timezone": "America/Argentina/Buenos_Aires",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 2,
  "updatedAt": "2025-07-31T09:01:03.037Z",
  "versionId": "22ef7413-15f9-4fa5-b298-4bd0bd69acdb"
}