{
  "active": false,
  "connections": {
    "datos": {
      "main": [
        [
          {
            "node": "var",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "var": {
      "main": [
        [
          {
            "node": "Lista",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        []
      ]
    },
    "HTTP Request1": {
      "main": [
        []
      ]
    },
    "Buttons ": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lista": {
      "main": [
        [
          {
            "node": "Lista2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lista2": {
      "main": [
        [
          {
            "node": "button",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-08-13T14:28:45.259Z",
  "id": "Vaf6IZqsKLUeJpQD",
  "isArchived": false,
  "meta": null,
  "name": "AGENTE CITAS - Button confirm QEVA",
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "nombre"
            },
            {
              "name": "fecha"
            },
            {
              "name": "hora"
            },
            {
              "name": "servicio"
            },
            {
              "name": "telefono"
            }
          ]
        }
      },
      "id": "73f9523b-8cd3-4a4d-be2c-60006d28abd9",
      "typeVersion": 1.1,
      "name": "datos",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        0,
        -48
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://gate.whapi.cloud/messages/interactive",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            },
            {
              "name": "content-type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "header",
              "value": "={{ $json.payload.header }}"
            },
            {
              "name": "body",
              "value": "={{ $json.payload.body }}"
            },
            {
              "name": "footer",
              "value": "={{ $json.payload.footer }}"
            },
            {
              "name": "action",
              "value": "={{ $json.payload.action }}"
            },
            {
              "name": "type",
              "value": "={{ $json.payload.type }}"
            },
            {
              "name": "to",
              "value": "={{ $json.payload.to }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1024,
        224
      ],
      "id": "6e93d088-86f8-4326-bcb7-c730f0faef8a",
      "name": "HTTP Request",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ekaTMbiKps3wYx80",
          "name": "Whapi - Agente inmobiliario"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8fd5e7a2-2acb-41ea-b8e5-4089765dfea7",
              "name": "nombre",
              "value": "={{ $json.nombre }}",
              "type": "string"
            },
            {
              "id": "d77f58ff-fc3b-4646-82aa-19b37f7a6632",
              "name": "fecha",
              "value": "={{ $json.fecha }}",
              "type": "string"
            },
            {
              "id": "7fb26fb1-e320-4a5c-bd4c-5c462ed12b24",
              "name": "hora",
              "value": "={{ $json.hora }}",
              "type": "string"
            },
            {
              "id": "13ed22d1-01fd-4d41-bba4-9af5f34cddbc",
              "name": "servicio",
              "value": "={{ $json.servicio }}",
              "type": "string"
            },
            {
              "id": "69f2dc55-9626-4f0f-9521-b2de136cb450",
              "name": "telefono",
              "value": "={{ $json.telefono }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        224,
        -48
      ],
      "id": "3a1a2fc3-3fca-4ce3-8cd4-dd8edc089e26",
      "name": "var"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://us.api-wa.me/2522xaf8359c21b/message/button_reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $json.to }}"
            },
            {
              "name": "header",
              "value": "={{ $json.header }}"
            },
            {
              "name": "text",
              "value": "={{ $json.text }}"
            },
            {
              "name": "footer",
              "value": "={{ $json.footer }}"
            },
            {
              "name": "buttons",
              "value": "={{ $json.buttons }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        304,
        240
      ],
      "id": "887429ff-593e-48ed-96f1-b04cef2c2e3a",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "046a9531-d8f0-430f-addc-ffb6a6e82c0b",
              "name": "response",
              "value": "`button_confirm`",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        976,
        -48
      ],
      "id": "6511ed28-192a-4ae9-a89c-f911d77b61bd",
      "name": "button"
    },
    {
      "parameters": {
        "jsCode": "// OBTENER DATOS DEL INPUT\nconst editFields = $('var').item.json;\n\n// EXTRAER DATOS DEL TURNO\nconst paciente = editFields.nombre;\nconst fecha = editFields.fecha;\nconst hora = editFields.hora;\nconst motivo = editFields.servicio;\nconst telefono = editFields.telefono;\n\n// CONFIGURACI√ìN DEL MENSAJE DE CONFIRMACI√ìN\nconst phoneNumber = telefono;\n\nconst msgConfig = {\n  title: \"üìÖ Consultorio M√©dico - Confirmar Turno\",\n  text: \"üéØ *Resumen de tu turno*\\nüë§ Paciente: \" + paciente + \"\\nüìÜ Fecha: \" + fecha + \"\\nüïê Hora: \" + hora + \"\\nüè• Motivo: \" + motivo + \"\\nüìç Record√° traer DNI y estudios previos\",\n  footer: \"¬øConfirm√°s tu turno?\",\n  btns: [\n    { type: \"quick_reply\", id: \"confirmar_turno\", text: \"‚úÖ Confirmar\" }\n  ]\n};\n\n// CONSTRUIR PAYLOAD FINAL\nconst result = {\n  to: phoneNumber,\n  header: {\n    title: msgConfig.title,\n    hasMediaAttachment: false\n  },\n  text: msgConfig.text,\n  footer: msgConfig.footer,\n  buttons: msgConfig.btns\n};\n\n// RETORNAR RESULTADO\nreturn [{ json: result }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        64,
        240
      ],
      "id": "4ea974e8-5d0e-426b-bd57-1a0e6179a2db",
      "name": "Buttons "
    },
    {
      "parameters": {
        "jsCode": "{\n  // OBTENER DATOS DEL INPUT\n  const editFields = $('var').item.json;\n\n  // EXTRAER DATOS DEL TURNO\n  const paciente = editFields.nombre;\n  const fecha = editFields.fecha; // \"2025-08-01\"\n  const hora = editFields.hora;   // \"10:00\"\n  const motivo = editFields.servicio;\n  const telefono = editFields.telefono;\n\n  // COMBINAR FECHA Y HORA EN FORMATO ISO\n  const fechaHora = `${fecha}T${hora}`; // \"2025-08-01T10:00\"\n\n  // FORMATEAR FECHA PARA MOSTRAR (DD-MM-YYYY)\n  const [a√±o, mes, dia] = fecha.split('-');\n  const fechaFormateada = `${dia}-${mes}-${a√±o}`; // \"01-08-2025\"\n\n  // CONSTRUIR MENSAJE DE LISTA\n  const requestBody = {\n    to: telefono,\n    buttonText: \"Confirmar ‚úÖ\",\n    title: \"ü¶∑ Consultorio M√©dico\",\n    description: `*Resumen de su turno*\nüë§ *Paciente:* ${paciente}\nüìÖ *Fecha:* ${fechaFormateada}\nüïê *Hora:* ${hora}\nüè• *Servicio:* ${motivo}\nüìç *Recordatorio: Traer DNI y estudios previos*\nSeleccione una opci√≥n:`,\n    footer: \"Centro M√©dico ‚Ä¢ Confirme su asistencia\",\n    sections: [\n      {\n        title: \"üìã Opciones Disponibles\",\n        rows: [\n          {\n            rowId: `‚úÖ CONFIRMADO - ${paciente} | ${fechaHora} | ${motivo}`,\n            title: \"‚úÖ Confirmar Turno\",\n            description: \"Confirmo mi asistencia en la fecha y hora indicada\"\n          }\n         \n        ]\n      }\n    ]\n  };\n\n  // RETORNAR RESULTADO\n  return [{ json: requestBody }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        496,
        -48
      ],
      "id": "07f40e95-f110-4048-bad0-ad220f63b7e6",
      "name": "Lista"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://us.api-wa.me/2522xaf8359c21b/message/list",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $json.to }}"
            },
            {
              "name": "buttonText",
              "value": "={{ $json.buttonText }}"
            },
            {
              "name": "text",
              "value": "={{ $json.text }}"
            },
            {
              "name": "title",
              "value": "={{ $json.title }}"
            },
            {
              "name": "description",
              "value": "={{ $json.description }}"
            },
            {
              "name": "footer",
              "value": "={{ $json.footer }}"
            },
            {
              "name": "sections",
              "value": "={{ $json.sections }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        736,
        -48
      ],
      "id": "a38d91c6-aa6e-46e7-b20a-491501f2d977",
      "name": "Lista2"
    }
  ],
  "pinData": {
    "datos": [
      {
        "json": {
          "nombre": "Cris",
          "fecha": "2025-08-08T10:00",
          "hora": "10:00",
          "servicio": "Limpieza",
          "telefono": "56937434094"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-08-13T14:28:45.259Z",
  "versionId": "843a53b9-ac9e-4d1b-a128-8d43fd9bdbea"
}