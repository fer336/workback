{
  "active": false,
  "connections": {
    "datos": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-06-28T03:55:52.303Z",
  "id": "t03AjGH2oZoCL3KK",
  "isArchived": false,
  "meta": null,
  "name": "AGENTE TECHNO GAS - Buttons confirm",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// OBTENER DATOS DEL INPUT\nconst editFields = $('Edit Fields').item.json;\n\n// EXTRAER LOS 3 DATOS PRINCIPALES\nconst producto = editFields.producto || \"Producto\";\nconst precio = parseFloat(editFields.Precio || editFields.precio || 0);\nconst cantidad = parseInt(editFields.cantidad || 1);\nconst subtotal = precio * cantidad;\n\n// FUNCIÃ“N PARA FORMATEAR MONEDA\nfunction formatMoney(value) {\n  return '$' + parseFloat(value).toLocaleString('es-AR');\n}\n\n// CONFIGURACIÃ“N DEL MENSAJE\nconst phoneNumber = \"5492254423359\";\nconst tipoAccion = \"compra\"; // Puede ser: compra, encargo, confirmacion, sin_stock\n\n// CONFIGURAR MENSAJE SEGÃšN TIPO\nlet msgConfig = {};\n\nif (tipoAccion === \"compra\") {\n  msgConfig = {\n    title: \"ğŸ”§ Techno Gas - Producto Disponible\",\n    text: \"ğŸ¯ *\" + producto + \"*\\nğŸ’° Precio: \" + formatMoney(precio) + \"\\nğŸ”¢ Cantidad: \" + cantidad + \"\\nğŸ’µ Subtotal: \" + formatMoney(subtotal) + \"\\nğŸ“¦ Stock: âœ… disponible\\nğŸšš EnvÃ­os a Villa Gesell, Madariaga y Costa Esmeralda\",\n    footer: \"Â¿QuÃ© querÃ©s hacer?\",\n    btns: [\n      { type: \"quick_reply\", id: \"ğŸ›’ Comprar\", text: \"ğŸ›’ Comprar\" },\n      { type: \"quick_reply\", id: \"other_product\", text: \" ğŸ“¸ Ver imagen\" }\n    ]\n  };\n} else if (tipoAccion === \"encargo\") {\n  const sena = Math.round(precio * 0.3);\n  msgConfig = {\n    title: \"ğŸ“‹ Techno Gas - Encargo Disponible\",\n    text: \"ğŸ¯ *\" + producto + \"*\\nğŸ’° Precio total: \" + formatMoney(precio) + \"\\nğŸ”¢ Cantidad: \" + cantidad + \"\\nğŸ’¸ SeÃ±a (30%): \" + formatMoney(sena) + \"\\nğŸ“… Demora estimada: 7-10 dÃ­as\\nğŸ“¦ Estado: A encargar\\nğŸšš EnvÃ­os a Villa Gesell, Madariaga y Costa Esmeralda\",\n    footer: \"Â¿QuerÃ©s encargarlo?\",\n    btns: [\n      { type: \"quick_reply\", id: \"order_now\", text: \"âœ… Encargar\" },\n      { type: \"quick_reply\", id: \"ask_more\", text: \"â“ Consultar\" },\n      { type: \"quick_reply\", id: \"other_option\", text: \"ğŸ” Ver otros\" }\n    ]\n  };\n} else if (tipoAccion === \"confirmacion\") {\n  msgConfig = {\n    title: \"ğŸ‰ Techno Gas - ConfirmaciÃ³n\",\n    text: \"âœ… *Pedido confirmado*\\nğŸ‘¤ Cliente: Cliente\\nğŸ“¦ Producto: \" + producto + \"\\nğŸ”¢ Cantidad: \" + cantidad + \"\\nğŸ’° Total: \" + formatMoney(subtotal) + \"\\nğŸ¦ Alias: techno.gas.arg\\nğŸ“± Te contactamos para coordinar entrega\",\n    footer: \"PrÃ³ximos pasos:\",\n    btns: [\n      { type: \"quick_reply\", id: \"payment_done\", text: \"ğŸ’³ Ya transferÃ­\" },\n      { type: \"quick_reply\", id: \"payment_later\", text: \"â° Pago despuÃ©s\" },\n      { type: \"quick_reply\", id: \"need_help\", text: \"â“ Ayuda\" }\n    ]\n  };\n} else if (tipoAccion === \"sin_stock\") {\n  msgConfig = {\n    title: \"âŒ Techno Gas - Sin Stock\",\n    text: \"ğŸ¯ *\" + producto + \"*\\nğŸ’° Precio: \" + formatMoney(precio) + \"\\nğŸ”¢ Cantidad solicitada: \" + cantidad + \"\\nğŸ“¦ Stock: âŒ Sin stock\\nğŸ“… ReposiciÃ³n: Consultando con proveedor\\nğŸ”” Te avisamos cuando llegue\",\n    footer: \"Â¿QuÃ© querÃ©s hacer?\",\n    btns: [\n      { type: \"quick_reply\", id: \"notify_arrival\", text: \"ğŸ”” Avisarme\" },\n      { type: \"quick_reply\", id: \"similar_product\", text: \"ğŸ”„ Ver similar\" },\n      { type: \"quick_reply\", id: \"other_search\", text: \"ğŸ” Buscar otro\" }\n    ]\n  };\n} else {\n  msgConfig = {\n    title: \"ğŸ”§ Techno Gas - Consulta\",\n    text: \"Hola! Soy Lucy de Techno Gas.\\nÂ¿En quÃ© puedo ayudarte hoy?\\n\\nğŸ”§ Repuestos para gas\\nğŸšš EnvÃ­os a Villa Gesell, Madariaga y Costa Esmeralda\\nğŸ“± AtenciÃ³n personalizada\",\n    footer: \"ElegÃ­ una opciÃ³n:\",\n    btns: [\n      { type: \"quick_reply\", id: \"search_product\", text: \"ğŸ” Buscar repuesto\" },\n      { type: \"quick_reply\", id: \"view_catalog\", text: \"ğŸ“‹ Ver catÃ¡logo\" },\n      { type: \"quick_reply\", id: \"contact_support\", text: \"ğŸ’¬ Hablar con Lucy\" }\n    ]\n  };\n}\n\n// CONSTRUIR PAYLOAD FINAL\nconst result = {\n  to: phoneNumber,\n  header: {\n    title: msgConfig.title,\n    hasMediaAttachment: false\n  },\n  text: msgConfig.text,\n  footer: msgConfig.footer,\n  buttons: msgConfig.btns\n};\n\n// RETORNAR RESULTADO\nreturn [{ json: result }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        620,
        300
      ],
      "id": "e9cea8f7-f994-4157-846f-88c9697ef72d",
      "name": "Code"
    },
    {
      "parameters": {
        "inputSource": "jsonExample",
        "jsonExample": "{\n  \"producto\": \"cabezal pilot orbis\",\n  \"Precio\": 3400,\n  \"cantidad\": 1\n  \n}"
      },
      "id": "c055762a-8fe7-4141-a639-df2372f30060",
      "typeVersion": 1.1,
      "name": "datos",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "position": [
        120,
        300
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8fd5e7a2-2acb-41ea-b8e5-4089765dfea7",
              "name": "producto",
              "value": "={{ $json.producto }}",
              "type": "string"
            },
            {
              "id": "58165a5d-416b-49d2-b9eb-2d15f7a660c2",
              "name": "Precio",
              "value": "={{ $json.Precio }}",
              "type": "number"
            },
            {
              "id": "d77f58ff-fc3b-4646-82aa-19b37f7a6632",
              "name": "cantidad",
              "value": "={{ $json.cantidad }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        340,
        300
      ],
      "id": "af3bc02b-71c6-405c-be45-750213e64bf8",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://us.api-wa.me/2522xe636258b15/message/button_reply",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "*/*"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "to",
              "value": "={{ $json.to }}"
            },
            {
              "name": "header",
              "value": "={{ $json.header }}"
            },
            {
              "name": "text",
              "value": "={{ $json.text.replace(/\\n/g,'\\n').replace(/\\\"/g,'\\'') }}"
            },
            {
              "name": "footer",
              "value": "={{ $json.footer }}"
            },
            {
              "name": "buttons",
              "value": "={{ $json.buttons }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        900,
        300
      ],
      "id": "a1c4bb62-416c-4bf4-b168-5ad19c3061c1",
      "name": "HTTP Request"
    }
  ],
  "pinData": null,
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 0,
  "updatedAt": "2025-06-28T03:59:07.034Z",
  "versionId": "0ae2de3f-f800-44fa-8882-09a30dea2a73"
}