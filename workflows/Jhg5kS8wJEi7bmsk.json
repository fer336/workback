{
  "active": true,
  "connections": {
    "Preparar Mensaje": {
      "main": [
        [
          {
            "node": "FERNANDO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "vars": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Preparar Mensaje1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Preparar Mensaje1": {
      "main": [
        [
          {
            "node": "Texto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "vars1": {
      "main": [
        [
          {
            "node": "get_participantes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_participantes": {
      "main": [
        [
          {
            "node": "Preparar Mensaje",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "chat": {
      "main": [
        [
          {
            "node": "vars",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Datos": {
      "main": [
        []
      ]
    }
  },
  "createdAt": "2025-06-28T03:55:45.572Z",
  "id": "Jhg5kS8wJEi7bmsk",
  "isArchived": false,
  "meta": null,
  "name": "Mencion fantasma",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// Obtener todos los participantes desde el input\nconst participantes = $input.first().json.participants || [];\nconst config = $node[\"vars1\"].json;\n\n// Filtrar solo los que son números de WhatsApp\nconst numerosTelefono = participantes\n  .filter(p => p && p.jid && p.jid.endsWith('@s.whatsapp.net'))\n  .map(p => p.jid);\n\n// Retornar el objeto para Evolution API - FORMATO CORRECTO\nreturn {\n  json: {\n    number: config.number,           // el grupo destino\n    text: config.text,               // el mensaje que querés enviar\n    delay: config.options?.delay || 1200,\n    presence: config.options?.presence || \"composing\",\n    linkPreview: false,\n    mentionsEveryOne: false,         // false porque vamos a usar mentioned\n    mentioned: numerosTelefono       // Array de JIDs para menciones fantasma\n  }\n};"
      },
      "name": "Preparar Mensaje",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        -80,
        1072
      ],
      "id": "6036c74c-8077-421d-a60b-ea2e115ecdc5"
    },
    {
      "parameters": {
        "content": "## Grupo buitres 5491138677828-1439064022@g.us\n\n## Grupo General IA \"120363409752146229@g.us\"\n\n## Grupo TRAID general \"120363347362371229@g.us\"\n\n## Grupo Inmobiliario \"120363407640794586@g.us\"\n\n## GRUPO RUBEN \"120363150353486693@g.us\"\n\n## GRUPO DEL VILLANO (120363419074159638@g.us)\n\n## GRUPO TESTING 120363403639330017",
        "height": 660,
        "width": 580
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -656,
        272
      ],
      "typeVersion": 1,
      "id": "3a5ac9ca-9811-4765-983c-96f2a4a71a12",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "23189e14-968e-44f2-be6c-32e7889d5294",
              "name": "number",
              "value": "=120363419074159638@g.us",
              "type": "string"
            },
            {
              "id": "c403ade0-2efe-493c-96e6-a45fcb270920",
              "name": "url",
              "value": "=https://evo.innovasoftpro.dev",
              "type": "string"
            },
            {
              "id": "237b606f-962f-485e-8945-2409e46b5ed8",
              "name": "apikey",
              "value": "=B8F21C0B3BFC-453F-A467-B69E2BB0D8E3",
              "type": "string"
            },
            {
              "id": "6b637992-7137-4ec6-adb4-db6fa6706671",
              "name": "instance",
              "value": "=fernando",
              "type": "string"
            },
            {
              "id": "c584414f-8f84-450d-8999-3071701de88c",
              "name": "options",
              "value": "={delay: 1200,presence: 'composing'}",
              "type": "object"
            },
            {
              "id": "d7e9739d-f087-4f35-bd14-b39bb38ab224",
              "name": "text",
              "value": "={{ $json.chatInput }}",
              "type": "string"
            },
            {
              "id": "0def1f68-c153-4d34-8b8a-90014d5be372",
              "name": "mentions",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -544,
        1408
      ],
      "id": "4d448bde-b5b2-4007-a7ee-3e52d8ae13e6",
      "name": "vars"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://gate.whapi.cloud/messages/text",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "typing_time",
              "value": "={{1}}"
            },
            {
              "name": "body",
              "value": "={{ $json.body }}"
            },
            {
              "name": "to",
              "value": "={{ $json.to }}"
            },
            {
              "name": "mentions",
              "value": "={{ $json.mentions }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        240,
        1408
      ],
      "id": "b653112a-bf0c-4c0c-8430-3bcb8c6b56f6",
      "name": "Texto",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ekaTMbiKps3wYx80",
          "name": "Whapi - Fer"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://gate.whapi.cloud/groups/{{ $json.number }}",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "count",
              "value": "200"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            },
            {
              "name": "authorization",
              "value": "Bearer B2v6DZyi27qmgYXOnvrYLEJ4l8KgN410"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -272,
        1408
      ],
      "id": "f2bc2863-9838-43f8-91de-48ab11953d39",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "jsCode": "// VERSIÓN SIMPLE Y DIRECTA\nconst group = $input.item.json;\nconst config = $node[\"vars\"].json;\n\n// Extraer números de los participantes\nconst mentions = group.participants\n  .map(p => p.id.replace('@s.whatsapp.net', ''))\n  .filter(num => num && num !== 'status@broadcast');\n\n// Crear mensaje\nconst body = ` ${config.text} `;\n\n// Devolver objeto para WhAPI\nreturn {\n  json: {\n    to: group.id,\n    body: body,\n    mentions: mentions,\n    typing_time: 3\n  }\n};"
      },
      "name": "Preparar Mensaje1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [
        -32,
        1408
      ],
      "id": "defc02ce-d3af-4ac7-a379-9452879d920d"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "23189e14-968e-44f2-be6c-32e7889d5294",
              "name": "number",
              "value": "=120363403639330017@g.us",
              "type": "string"
            },
            {
              "id": "c403ade0-2efe-493c-96e6-a45fcb270920",
              "name": "url",
              "value": "=https://evo.qeva.xyz",
              "type": "string"
            },
            {
              "id": "237b606f-962f-485e-8945-2409e46b5ed8",
              "name": "apikey",
              "value": "=0B7C4E05F589-499F-A318-DA1AF7EC1E5E",
              "type": "string"
            },
            {
              "id": "6b637992-7137-4ec6-adb4-db6fa6706671",
              "name": "instance",
              "value": "=fernando",
              "type": "string"
            },
            {
              "id": "c584414f-8f84-450d-8999-3071701de88c",
              "name": "options",
              "value": "={delay: 1200,presence: 'composing'}",
              "type": "object"
            },
            {
              "id": "d7e9739d-f087-4f35-bd14-b39bb38ab224",
              "name": "text",
              "value": "={{ $json.chatInput }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -592,
        1072
      ],
      "id": "993491aa-eb67-4e86-80a2-e8123176b1cc",
      "name": "vars1"
    },
    {
      "parameters": {
        "url": "=https://evo.qeva.xyz/group/participants/fer?groupJid={{ $json.number }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "name": "get_participantes",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        -336,
        1072
      ],
      "id": "aac34276-b477-4aff-a29c-c3a00f5d7c47",
      "credentials": {
        "httpBasicAuth": {
          "id": "OpgdvMlLy6Zxc6ii",
          "name": "NOCODB"
        },
        "httpHeaderAuth": {
          "id": "AyfwVfJv24ug21lX",
          "name": "EVOLUTION API - FER"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -960,
        1408
      ],
      "id": "03a2ed6b-8565-4be1-ab32-6586afaa6299",
      "name": "chat",
      "webhookId": "b62d2c70-4f2a-4915-b55c-0984918d98bf"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "whapi",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -976,
        1088
      ],
      "id": "24e49c75-20d2-4dad-82f7-5f9bf681bd67",
      "name": "Datos",
      "webhookId": "9ba09d30-2eb8-4bdf-8785-2bfc45e3f63d"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://evo.qeva.xyz/message/sendText/fer",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "number",
              "value": "={{ $('vars1').item.json.number }}"
            },
            {
              "name": "text",
              "value": "={{ $json.text }}"
            },
            {
              "name": "delay",
              "value": "={{ $json.delay }}"
            },
            {
              "name": "presence",
              "value": "={{ $json.presence }}"
            },
            {
              "name": "mentionsEveryOne",
              "value": "={{ $json.mentionsEveryOne }}"
            },
            {
              "name": "mentioned",
              "value": "={{ $json.mentioned }}"
            }
          ]
        },
        "options": {}
      },
      "name": "FERNANDO",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        208,
        1072
      ],
      "id": "948a1325-ab71-4e2d-8f04-80084d5e3137",
      "credentials": {
        "httpBasicAuth": {
          "id": "OpgdvMlLy6Zxc6ii",
          "name": "NOCODB"
        },
        "httpHeaderAuth": {
          "id": "AyfwVfJv24ug21lX",
          "name": "EVOLUTION API - FER"
        }
      }
    },
    {
      "parameters": {
        "content": "## Grupo buitres 5491138677828-1439064022@g.us\n\n## Grupo General IA \"120363409752146229@g.us\"\n\n## Grupo TRAID general \"120363347362371229@g.us\"\n\n## Grupo Inmobiliario \"120363407640794586@g.us\"\n\n## GRUPO RUBEN \"120363150353486693@g.us\"",
        "height": 660,
        "width": 580
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -2768,
        448
      ],
      "typeVersion": 1,
      "id": "0e4f020c-fe2f-4b70-a0c5-70c628b1c50c",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "##  Whapi",
        "height": 240,
        "width": 1072,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -640,
        1328
      ],
      "typeVersion": 1,
      "id": "323923f9-b798-4d35-92b0-912d2c490cfb",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "##  Whapi",
        "height": 240,
        "width": 1072,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -640,
        1008
      ],
      "typeVersion": 1,
      "id": "5bf18bc7-c00b-4b6c-b523-37b75b7a93e0",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "##  Whapi",
        "height": 240,
        "width": 256,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1040,
        1008
      ],
      "typeVersion": 1,
      "id": "48dd3898-a2a5-43cd-b644-eea6d328d990",
      "name": "Sticky Note4"
    }
  ],
  "pinData": {
    "Datos": [
      {
        "json": {
          "headers": {
            "host": "n8nw.qeva.xyz",
            "content-length": "347",
            "accept": "application/json",
            "baggage": "sentry-environment=prod,sentry-public_key=470cc684690a2466aa1d4006cc631fb8,sentry-trace_id=70fd6ddc0adc5e47036a3cf28197b710",
            "content-type": "application/json",
            "sentry-trace": "70fd6ddc0adc5e47036a3cf28197b710-37006d59659413a8",
            "x-forwarded-for": "37.27.140.235",
            "x-forwarded-host": "n8nw.qeva.xyz",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "7697b68d06c2",
            "x-real-ip": "37.27.140.235",
            "accept-encoding": "gzip"
          },
          "params": {},
          "query": {},
          "body": {
            "messages": [
              {
                "id": "9tBpUFx8bVS2psdim1xsJQ-gtQBq53gveEU4Q",
                "from_me": false,
                "type": "text",
                "chat_id": "120363403639330017@g.us",
                "timestamp": 1755885728,
                "source": "mobile",
                "chat_name": "Testing group",
                "text": {
                  "body": "Hol"
                },
                "from": "5492254596618",
                "from_name": "Automátizaciones AI"
              }
            ],
            "event": {
              "type": "messages",
              "event": "post"
            },
            "channel_id": "DRSTRG-R2GAJ"
          },
          "webhookUrl": "https://n8nw.qeva.xyz/webhook/whapi",
          "executionMode": "production"
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "errorWorkflow": "2kOn0Oz7c2uvczPK"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 2,
  "updatedAt": "2025-08-22T18:47:52.462Z",
  "versionId": "733f62e4-9036-4580-8a0a-155ef81ebbd3"
}