{"createdAt":"2025-06-28T03:55:57.883Z","updatedAt":"2025-06-28T04:04:28.929Z","id":"vGurmJESJX6qW6tI","name":"agente inmobiliario","active":false,"isArchived":true,"nodes":[{"parameters":{"updates":["messages"]},"id":"10a951b2-98ec-43fd-ac99-e07a13fbe197","name":"WhatsApp Trigger","type":"n8n-nodes-base.whatsAppTrigger","typeVersion":1,"position":[-20,1260],"webhookId":"9f09d96b-4e06-43c7-bdfb-121a29cb1500"},{"parameters":{"collection":"concatenar mensajes","options":{},"query":"={\n  \"phone\": \"{{ $json.contacts[0].wa_id }}\"\n}"},"id":"02580ef7-7062-45ab-96f0-5088406c618a","name":"MongoDB","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[2440,3500],"alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"a64720a9-ee75-4d70-9292-ec111caef240","leftValue":"={{ $json.mensaje }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"3d698207-734a-4402-9e52-6ffa34f9b9f5","name":"If","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[2660,3500]},{"parameters":{"assignments":{"assignments":[{"id":"e01d623f-80e7-4b60-b425-8eb8b7b977e5","name":"mensaje","value":"={{ $('WhatsApp Trigger').first().json.messages[0].text.body }}","type":"string"},{"id":"6005b886-0232-457d-9802-f1b22bd7c70f","name":"phone","value":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","type":"string"}]},"options":{}},"id":"2a34ac16-4bdf-490c-83aa-6df91158638e","name":"Edit Fields","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2880,3660]},{"parameters":{"operation":"insert","collection":"concatenar mensajes","fields":"mensaje,phone","options":{}},"id":"37369189-8d69-4c93-a3a6-0301d0516785","name":"MongoDB1","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[3100,3660]},{"parameters":{"amount":20},"id":"4a113293-d7d5-43d6-ac16-461c5eda1fc2","name":"Wait","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[3320,3660],"webhookId":"6f2aac20-1587-4bfb-a229-5f59fc2d70c7"},{"parameters":{"assignments":{"assignments":[{"id":"e01d623f-80e7-4b60-b425-8eb8b7b977e5","name":"mensaje","value":"={{ $('MongoDB').item.json.mensaje + ' / ' + $('WhatsApp Trigger').first().json.messages[0].text.body }}","type":"string"},{"id":"6005b886-0232-457d-9802-f1b22bd7c70f","name":"phone","value":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","type":"string"},{"id":"d72c42f9-ec8b-467e-b72b-c5352384c1e0","name":"_id","value":"={{ $('MongoDB').first().json._id }}","type":"string"}]},"options":{}},"id":"c6fd91d6-9edc-433e-8d20-9493eac389f5","name":"Edit Fields1","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2880,3340]},{"parameters":{"operation":"update","collection":"concatenar mensajes","updateKey":"=phone","fields":"mensaje","upsert":true,"options":{}},"id":"ef8a9d01-fec5-4d6e-a006-e6524c1e6047","name":"MongoDB2","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[3100,3340]},{"parameters":{"amount":20},"id":"ec2deb85-f3ac-49bb-966d-eca874d902c1","name":"Wait1","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[3320,3340],"webhookId":"6f2aac20-1587-4bfb-a229-5f59fc2d70c7"},{"parameters":{"collection":"concatenar mensajes","options":{},"query":"={\n  \"phone\": \"{{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}\"\n}"},"id":"49ba38f9-8873-41a9-acda-75125767e590","name":"MongoDB4","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[3560,3500]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"3bcd6d03-626a-48cf-8081-19c7fe3d4268","leftValue":"={{ $('WhatsApp Trigger').first().json.messages[0].text.body }}","rightValue":"={{ $json.mensaje.split(' / ').pop() }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"id":"26346cd4-c78b-4b6d-9a06-f4c3198bc32d","name":"If1","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[3740,3500]},{"parameters":{"assignments":{"assignments":[{"id":"403044c2-600c-463c-bbb6-80d939ccf3d9","name":"mensajes","value":"={{ $('MongoDB4').first().json.mensaje.replace(/\\s*\\/\\s*/g, ' ') }}","type":"string"},{"id":"7fbcbbe6-2d15-481e-b3ca-fb8e26325261","name":"_id","value":"={{ $('MongoDB4').first().json._id }}","type":"string"}]},"options":{}},"id":"191f81c8-8050-476b-bc14-88e3a7b4d4ad","name":"Edit Fields2","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3960,3480]},{"parameters":{"options":{"temperature":0}},"id":"a42e1edd-7ed7-4f13-91da-b87fd1ee737e","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[500,1780]},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}"},"id":"ec54093a-f8e6-4f5a-a631-4b16bb5d37eb","name":"Zep","type":"@n8n/n8n-nodes-langchain.memoryZep","typeVersion":1.2,"position":[620,1780]},{"parameters":{"jsonSchemaExample":"{\"output\": {\n\t\"primer\": \"Aqui la primer parte de tu mensaje\",\n\t\"segundo\": \"Aqui la segunda parte de tu mensaje si es necesario\",\n  \"tercer\": \"Aqui la tercer parte de tu mensaje si es necesario\"\n}}"},"id":"c336a6b5-ccdd-4fae-8971-ecfd6be04593","name":"Structured Output Parser2","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[1320,1800]},{"parameters":{"options":{"temperature":0}},"id":"5e02bf5f-dc6b-4f31-bf0d-6f3a861130a5","name":"OpenAI Chat Model19","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[1300,1880]},{"parameters":{"options":{"temperature":0}},"id":"81ec7a2d-60fd-4d1c-af38-0667707c8b90","name":"OpenAI Chat Model12","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[1100,1720]},{"parameters":{"options":{}},"id":"dc39bd29-88e0-4b66-9f4e-b0cefd091606","name":"Auto-fixing Output Parser1","type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[1440,1960]},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","textBody":"={{ $json.output.output.primer }}","additionalFields":{},"requestOptions":{}},"id":"3430d565-521e-47e6-a964-039fb1c4e76c","name":"WhatsApp Business Cloud","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[1520,1580],"executeOnce":true},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","textBody":"={{ $('Basic LLM Chain3').first().json.output.output.segundo }}","additionalFields":{},"requestOptions":{}},"id":"4e0a58f4-428e-4d7b-92d1-24e8fb8f2c8c","name":"WhatsApp Business Cloud1","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[1880,1560],"executeOnce":true},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","textBody":"={{ $('Basic LLM Chain3').first().json.output.output.tercer }}","additionalFields":{},"requestOptions":{}},"id":"d0762ed5-328b-4aa5-a7d2-6455ade24334","name":"WhatsApp Business Cloud3","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[2260,1540],"executeOnce":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"1dc8bca7-820d-49a1-be81-30c205f1c867","leftValue":"={{ $json.messages[0].text.body }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"or"},"options":{}},"id":"00651906-31ec-4eeb-b0fd-065cc09d0a7f","name":"If4","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[160,1260]},{"parameters":{"operation":"delete","collection":"concatenar mensajes","query":"={\n  \"phone\": \"{{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}\"\n}"},"id":"326f1f06-4ed5-4c61-bbe2-76aec0bae8b2","name":"MongoDB3","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[4140,3480]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"5ad0f785-51bd-403a-b5d9-4abee6c58671","leftValue":"={{ $('Basic LLM Chain3').first().json.output.output.segundo }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"89be9935-2fe7-454a-a484-027c29fb58d4","name":"If2","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[1680,1580]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"a579c87e-c546-4a72-9902-38d5a89e8703","leftValue":"={{ $('Basic LLM Chain3').first().json.output.output.tercer }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"fc9ed52c-6ced-479c-ab9f-80a55f12b81f","name":"If3","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[2060,1560]},{"parameters":{"name":"ChatpropBASEpropiedades","description":"=# Ejecuta esta herramienta siempre que el usuario mencione los detalles de la propiedad que desea y te confirme que no quiere mencionar mas detalles o te pida que le busques con los detalles que menciono.","workflowId":{"__rl":true,"value":"xRJjdTXs9P7Wojo7","mode":"list","cachedResultName":"Base propiedad DEMO VENTO"},"fields":{"values":[{"name":"cel","stringValue":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}"}]},"specifyInputSchema":true,"jsonSchemaExample":"{\n\"localidad\": \"Aqui deberas enviar la localidad que desea el usuario para su propiedad inmobiliaria en su nueva busqueda presente.(SIEMPRE PERO SIEMPRE DEBES ENVIARLA CON MAYUSCULA EN LA PRIMER LETRA DE LA LOCALIDAD MENCIONADA, SIEMPRE Y DE MANERA OBLIGATORIA, EJEMPLO: Ramos mejia / Villa sarmiento)\",\n    \"tipo de propiedad\": \"Aqui deberas enviar el tipo de propiedad que desea el usuario para su propiedad inmobliaria en su nueva busqueda presente.(envia siempre el valor en minuscula. Si es compra/ venta, envia 'compra' y si es alquiler envia 'alquiler') \",\n    \"tipo de operacion\": \"Aqui deberas enviar el tipo de operacion que desea el usuario para su propiedad inmobiliaria en su nueva busqueda presente (envia siempre el valor en minuscula. Si es depto/departamento/apartamento, envia 'departamento', si es casa envia 'casa', si es loft envia 'loft' y asi con el valor que el usuario mencione)\",\n    \"presupuesto\": \"Aqui deberas enviar el presupuesto maximo que desea el usuario para su propiedad inmobiliaria en su nueva busqueda presente (envia siempre el valor sin puntos ni coma, es decir que si el user dice '400mil' debes enviar ante cual expresion siguiendo el formato de sin puntos ni comas, ejemplo: 400000\",\n    \"dormitorios\": \"Si el usuario menciono que desea dormitorios, envia el numero que haya mencionado como dormitorios para su propiedad inmobiliaria en su nueva busqueda presente.\",\n  \"metros cuadrados\": \"Aqui deberas enviar el numero de metros cuadrados que el usuario haya mencionado en su nueva busqueda presente.\"\n  \n}"},"id":"9e07b61c-ad71-44fd-b663-2fcd62bbd48f","name":"busqueda","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[900,1780]},{"parameters":{"name":"VENTO","description":"=# Ejecuta esta herramienta siempre que el usuario te pida ver mas imagenes/fotos (haciendo referencia a la propiedad que le fue mostrada).\n\n# Ejecuta esta herramienta siempre que el usuario te pida que le digas cual es la condicion (haciendo referencia a la propiedad que le fue mostrada).\n\n# Ejecuta esta herramienta siempre que el usuario te pida que le des mas informacion (haciendo referencia a la propiedad que le fue mostrada).\n\n# Ejecuta esta herramienta siempre que el usuario te pida que le envies la cotizacion (haciendo referencia a la propiedad que le fue mostrada).\n\n# Siempre que ejecutes esta herramienta, deberas enviar la pretencion del usuario. Siempre!!","workflowId":{"__rl":true,"value":"8ikKUCbDUv7dYzhD","mode":"list","cachedResultName":"mas info DEMO VENTO"},"fields":{"values":[{"name":"cel","stringValue":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}"}]},"specifyInputSchema":true,"jsonSchemaExample":"{\n\t\"consulta\": \"Aqui debes enviar la consulta especifica realizada por el user, sin cambiar ningun detalle de la misma.\"\n}"},"id":"ecd3b7e9-ce20-4ad0-80db-c904d6b02562","name":"VENTO","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1.2,"position":[780,1780]},{"parameters":{"promptType":"define","text":"={{ $json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=# Tu unica **Tarea**\n\n## **-DEVOLVE SOLAMENTE LA SALIDA DEL TEXTO FINAL\n-Y DIVIDILA EN 1 PARTE SI ES UN MENSAJE BREVE, EN 2 PARTES SI LA LONGITUD DEL MENSAJE ES CONSIDERABLE PARA HACERLO, Y EN 3 PARTE SI LA LONGITUD DEL MENSAJE ES EXTENSA.\n-SI TENES QUE DEJAR VARIABLES VACIAS HAZLO.**\n\n# Considera un mensaje breve si contiene menos de 8 palabras, de lo contrario dividilo en 2 y en 3 partes si contiene mas de 16 palabras.\n\n# Evita cortar frases al medio (una misma frase en 2 partes).\n\n\n# Prohibido\n## Tenes prohibido cambiar las palabras o el mensaje. Debes dejar el mensaje tal cual, solamente debes dividirlo."}]}},"id":"2292816b-6c31-4626-b8c7-f2d48141cc66","name":"Basic LLM Chain3","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.4,"position":[1080,1580]},{"parameters":{"collection":"historial busqueda mercado libre","options":{},"query":"={\n  \"phone\": \"{{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}\"\n}"},"id":"9ab09c18-e3d3-408c-9260-99a8a3f07097","name":"MongoDB12","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[460,2080],"executeOnce":true},{"parameters":{"jsCode":"const mongoSearch = $('MongoDB12').item.json.busqueda;\nconst number = '1'; // O reemplázalo con el valor adecuado según tu lógica\n\nfunction processNumber(number, searchValue) {\n    if (number === '0') {\n        return [{ result: 1 }];\n    }\n    \n    if (number === '1') {\n        if (!searchValue) {\n            return [{ result: 1 }];\n        }\n        return [{ result: parseInt(number) + parseInt(searchValue) }];\n    }\n\n    return [{ result: null }];\n}\n\n// Devolver el resultado en el formato correcto para n8n\nreturn processNumber(number, mongoSearch);\n"},"id":"da9dfaef-0d81-4319-b9e0-eb2092e5f3c0","name":"Code11","type":"n8n-nodes-base.code","typeVersion":2,"position":[620,2080]},{"parameters":{"jsCode":"function calcularPropiedadesMostradas(\n    totalEncontradas,\n    mostradasPrevias,\n    busquedaPrevia,\n    busquedaActual\n) {\n    // Número máximo de propiedades por ejecución\n    const maxPorEjecucion = 1;\n    \n    let resultado;\n    \n    // Si es la primera ejecución\n    if (busquedaActual === 1) {\n        resultado = Math.min(totalEncontradas, maxPorEjecucion);\n    }\n    // Para cualquier ejecución posterior\n    else {\n        // Calculamos las propiedades que faltan por mostrar\n        const propiedadesRestantes = totalEncontradas - mostradasPrevias;\n        // El resultado será el mínimo entre las restantes y el máximo por ejecución\n        resultado = Math.min(propiedadesRestantes, maxPorEjecucion);\n    }\n    \n    // Calculamos el total de propiedades mostradas hasta el momento\n    const totalMostradas = Math.min(busquedaActual * maxPorEjecucion, totalEncontradas);\n    \n    // Calculamos cuántas propiedades faltan por mostrar\n    const restantes = totalEncontradas - totalMostradas;\n    \n    return [{\n        item: {\n            mostradas: resultado,\n            totalMostradas: totalMostradas,\n            restantes: restantes\n        }\n    }];\n}\n\nreturn calcularPropiedadesMostradas(\n    $('MongoDB12').first().json.encontradas,\n    $('MongoDB12').first().json.mostradas,\n    $('MongoDB12').first().json.busqueda,\n    $('Code11').first().json.result\n);\n"},"id":"492e5ad4-efd6-47f9-adbd-6411dcf421cf","name":"Code12","type":"n8n-nodes-base.code","typeVersion":2,"position":[1100,2080],"executeOnce":false,"alwaysOutputData":true},{"parameters":{"jsCode":"const _id = $('MongoDB12').first().json._id;\nconst busqueda = $('Edit Fields3').first().json.busqueda;\nconst mostradas = $('Code12').first().json.item.totalMostradas;\n\n// Validar y convertir _id a un formato hexadecimal de 24 caracteres\nlet mongoId;\n\nif (typeof _id === 'string' && /^[a-fA-F0-9]{24}$/.test(_id)) {\n    mongoId = _id; // Ya es un ObjectId válido\n} else {\n    throw new Error('El _id no es un ObjectId válido');\n}\n\nreturn [{ json: { _id: mongoId, busqueda, mostradas } }];\n"},"id":"dc4be642-78ec-4b54-bc14-23113e93062d","name":"Code13","type":"n8n-nodes-base.code","typeVersion":2,"position":[1260,2080]},{"parameters":{"operation":"update","collection":"historial busqueda mercado libre","updateKey":"_id","fields":"busqueda,mostradas","options":{}},"id":"8911f82c-b16d-477d-82a3-6ab90c21f660","name":"MongoDB5","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[1420,2080]},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}"},"id":"3af03e8c-8cc8-4e88-8506-a1b5035d81fe","name":"Zep1","type":"@n8n/n8n-nodes-langchain.memoryZep","typeVersion":1.2,"position":[2740,2280]},{"parameters":{"model":"gpt-4o-mini-2024-07-18","options":{"temperature":0}},"id":"7bea7eff-6714-48d8-97b1-ca36e276b5ec","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[2580,2280]},{"parameters":{"model":"gpt-4o-mini-2024-07-18","options":{"temperature":0}},"id":"6b033da1-1fe6-4c8e-8d6e-d573c187c7f7","name":"OpenAI Chat Model5","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-200,1980]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"b4cb9381-3084-4344-8ba2-14bd0cee727e","leftValue":"={{ $json.text }}","rightValue":"1","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"id":"c5d9ba9e-5ab1-4eec-b4c3-9d76bca45289","name":"If5","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[120,1820],"executeOnce":true},{"parameters":{"url":"=https://api.getzep.com/api/v2/sessions/{{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}/messages","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Api-Key z_1dWlkIjoiYjQzNTYyZTUtOTk0MS00MzIyLWJkZjctNDY2MjNkNzk0M2FlIn0.1Ht1V3Nr-7fz93M-bdZd5r9GIVGrl5lwbIV6fYTl9KzWz24qLbuTj314pJtmVRfDrMc0YPaBjuP92oQ4oBYHJw"}]},"options":{}},"id":"c37e9e02-30e2-438a-8ef0-39632252b0f5","name":"conversacion zep","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-460,1820],"alwaysOutputData":true,"executeOnce":true},{"parameters":{"assignments":{"assignments":[{"id":"3485c39f-128a-458f-8917-6b9583d6812e","name":"busqueda","value":"={{ $json.result }}","type":"string"},{"id":"462d8da4-7e0b-4c0e-a74a-1f8275c0a92f","name":"Tipo de Propiedad","value":"={{ $('MongoDB12').first().json.Tipo_de_Propiedad }}","type":"string"},{"id":"d1d48f29-d3e0-4879-a947-9d092545d948","name":"Tipo de Operacion","value":"={{ $('MongoDB12').first().json.Tipo_de_Operacion }}","type":"string"},{"id":"9fa4c65f-8e2f-4f6d-80a4-8efb2f6849a4","name":"Localidad","value":"={{ $('MongoDB12').first().json.Localidad }}","type":"string"},{"id":"8394dbc7-df73-41f7-b276-ab175d3861ea","name":"Habitaciones","value":"={{ $('MongoDB12').first().json.Habitaciones }}","type":"string"}]},"options":{}},"id":"6c290525-5216-4d9b-b70c-d4899acb3958","name":"Edit Fields3","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[780,2080]},{"parameters":{"collection":"vento real estate","options":{},"query":"={{ \n(() => {\n  const query = {};\n\n  const parseNumber = (value) => {\n    const num = parseInt(value);\n    return isNaN(num) ? null : num;\n  };\n\n  const processStringInput = (input) => {\n    if (!input) return [];\n    if (Array.isArray(input)) return input;\n    return input.toString().split(/[,;]/).map(el => el.trim()).filter(Boolean);\n  };\n\n  // Tipo de Propiedad\n  const tipoPropiedadValue = parseNumber($json['Tipo de Propiedad']);\n  if (tipoPropiedadValue !== null) {\n    query[\"Propiedad\"] = { \"$in\": [tipoPropiedadValue] };\n  }\n\n  // Tipo de Operación\n  const tipoOperacionValue = parseNumber($json['Tipo de Operacion']);\n  if (tipoOperacionValue !== null) {\n    query[\"Operacion\"] = { \"$in\": [tipoOperacionValue] };\n  }\n\n  // Localidad\n  const localidades = processStringInput($json['Localidad']);\n  if (localidades.length > 0) {\n    query[\"Localidad\"] = { \"$in\": localidades };\n  }\n\n  // Habitaciones\n  const habitacionesValue = parseNumber($json['Habitaciones']);\n  if (habitacionesValue !== null) {\n    query[\"Dormitorio o Tamaño\"] = habitacionesValue;\n  }\n\n  return JSON.stringify(query);\n})()\n}}"},"id":"1225e81b-7398-49e8-8601-62e075d77d25","name":"MongoDB7","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[940,2080],"alwaysOutputData":true,"executeOnce":false},{"parameters":{"assignments":{"assignments":[{"id":"ef7ffe70-511a-4887-b54e-65696ff13f75","name":"ID","value":"={{ $('MongoDB7').first().json.ID }}","type":"string"},{"id":"2ca9738b-df8e-487b-ac2c-6044c0619635","name":"phone","value":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","type":"string"},{"id":"46bd66e9-e398-42f7-b39d-0ba3f30d3c10","name":"Fotos adicionales 1","value":"={{ $('MongoDB7').first().json['Fotos adicionales 1'] }}","type":"string"},{"id":"81047acf-82af-4afa-a73c-c22b22c0ad7d","name":"Fotos adicionales 2","value":"={{ $('MongoDB7').first().json['Fotos adicionales 2'] }}","type":"string"},{"id":"f2eef856-b45c-4a00-8aa6-4c4bbbe8fb93","name":"Fotos adicionales 3","value":"={{ $('MongoDB7').first().json['Fotos adicionales 3'] }}","type":"string"},{"id":"70067126-93e8-45fd-a2b5-dee0426985bc","name":"Fotos adicionales 4","value":"={{ $('MongoDB7').first().json['Fotos adicionales 4'] }}","type":"string"},{"id":"2c8a9dd1-4b55-4fe2-a815-c84c3684d5c8","name":"Enlace para descargar cotización","value":"={{ $('MongoDB7').first().json['Enlace para descargar cotización'] }}","type":"string"},{"id":"8e3b8574-d971-42b4-a6f2-8f43c6f77352","name":"Condiciones de compra","value":"={{ $('MongoDB7').first().json['Condiciones de compra'] }}","type":"string"},{"id":"c9e86995-79c5-42f9-abbb-4232a9b5e557","name":"Descripción","value":"={{ $('MongoDB7').first().json['Descripción'] }}","type":"string"},{"id":"69421262-7eda-4749-966a-fbcdda3b4807","name":"Link más información","value":"={{ $('MongoDB7').first().json['Link más información'] }}","type":"string"}]},"options":{}},"id":"5239364e-c364-4143-9fa5-026400499b97","name":"Edit Fields6","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1740,2080]},{"parameters":{"operation":"update","collection":"info completa vento","updateKey":"_id","fields":"phone,Descripción,Condiciones de compra,Enlace para descargar cotización,Fotos adicionales 4,Fotos adicionales 3,Fotos adicionales 2,Fotos adicionales 1,Link más información","options":{}},"id":"f2a8d5a5-fc84-4a9c-898d-052493172984","name":"MongoDB8","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[1900,2080],"executeOnce":true,"alwaysOutputData":true},{"parameters":{"jsonSchemaExample":"{\"output\": {\n\t\"primer\": \"Aqui la primer parte de tu mensaje\",\n\t\"segundo\": \"Aqui la segunda parte de tu mensaje si es necesario\",\n  \"tercer\": \"Aqui la tercer parte de tu mensaje si es necesario\"\n}}"},"id":"ce72f764-4c6c-49e1-8a6c-95973e5d174d","name":"Structured Output Parser","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[3200,2300]},{"parameters":{"options":{"temperature":0}},"id":"2dd63cc1-8afd-4c1f-bd96-b1fb52a6c870","name":"OpenAI Chat Model20","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[3180,2380]},{"parameters":{"options":{"temperature":0}},"id":"8e45c58e-9f3f-4748-9e03-6c85cbfe49c1","name":"OpenAI Chat Model13","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[2980,2220]},{"parameters":{"options":{}},"id":"91ad006e-d394-4635-a817-912e05310fed","name":"Auto-fixing Output Parser","type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","typeVersion":1,"position":[3320,2460]},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","textBody":"={{ $json.output.output.primer }}","additionalFields":{},"requestOptions":{}},"id":"db56971b-9ee9-4f45-912a-b228f5f40045","name":"WhatsApp Business Cloud2","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[3400,2080],"executeOnce":true},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","textBody":"={{ $('Basic LLM Chain').first().json.output.output.segundo }}","additionalFields":{},"requestOptions":{}},"id":"ed9e84bc-98d1-44c8-abef-15b3cf01d2cb","name":"WhatsApp Business Cloud4","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[3760,2060],"executeOnce":true},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","textBody":"={{ $('Basic LLM Chain').first().json.output.output.tercer }}","additionalFields":{},"requestOptions":{}},"id":"70c31db7-cb58-4db8-82e7-d61deb5e159f","name":"WhatsApp Business Cloud5","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[4140,2040],"executeOnce":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"5ad0f785-51bd-403a-b5d9-4abee6c58671","leftValue":"={{ $('Basic LLM Chain').first().json.output.output.segundo }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"91804f33-3fd3-414f-98d6-b443aac28ab4","name":"If6","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[3560,2080]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"a579c87e-c546-4a72-9902-38d5a89e8703","leftValue":"={{ $('Basic LLM Chain').first().json.output.output.tercer }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"id":"f104ec20-f148-4902-a320-0523171b911b","name":"If7","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[3940,2060]},{"parameters":{"promptType":"define","text":"={{ $json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=# Tu unica **Tarea**\n\n## **-DEVOLVE SOLAMENTE LA SALIDA DEL TEXTO FINAL\n-Y DIVIDILA EN 1 PARTE SI ES UN MENSAJE BREVE, EN 2 PARTES SI LA LONGITUD DEL MENSAJE ES CONSIDERABLE PARA HACERLO, Y EN 3 PARTE SI LA LONGITUD DEL MENSAJE ES EXTENSA.\n-SI TENES QUE DEJAR VARIABLES VACIAS HAZLO.**\n\n# Considera un mensaje breve si contiene menos de 8 palabras, de lo contrario dividilo en 2 y en 3 partes si contiene mas de 16 palabras.\n\n# Evita cortar frases al medio (una misma frase en 2 partes).\n\n\n# Prohibido\n## Tenes prohibido cambiar las palabras o el mensaje. Debes dejar el mensaje tal cual, solamente debes dividirlo."}]}},"id":"3a91804b-42f5-41c1-9b61-42dc0eb01c9d","name":"Basic LLM Chain","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.4,"position":[2960,2080]},{"parameters":{"collection":"historial busqueda mercado libre","options":{},"query":"={\n  \"phone\": \"{{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}\"\n}"},"id":"79b4bf61-3822-498d-974e-3d69bf03a3b0","name":"MongoDB13","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[-1100,1580],"executeOnce":true,"alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"9dfd6766-77ee-46fb-989c-7ac230e6b9cd","leftValue":"={{ $json.encontradas }}","rightValue":"1","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}},{"id":"6e0c9e79-838d-4d1e-a63b-b3e61452140b","leftValue":"={{ $json.encontradas }}","rightValue":"","operator":{"type":"string","operation":"notExists","singleValue":true}}],"combinator":"or"},"options":{}},"id":"7130ac4a-6838-4577-89f3-9aa4d2eae822","name":"If8","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[-920,1580],"executeOnce":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"91645b98-d27a-41a7-8e14-7018b03cc19b","leftValue":"={{ $json.encontradas.toString() }}","rightValue":"={{ $json.mostradas.toString() }}","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"id":"2258494a-e23a-4d0c-a840-189d1c2b7d1f","name":"If9","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[-700,1640],"executeOnce":true},{"parameters":{"promptType":"define","text":"={{ $('WhatsApp Trigger').first().json.messages[0].text.body }}","messages":{"messageValues":[{"message":"=# Tarea\nRESPONDE 1 CUANDO EL USUARIO INSINUE, EXPRESE O AFIRME QUE QUIERE VER MAS, QUE LE MUESTREN MAS, QUE QUIERE VER LA OTRA, **SIN** QUE HAYA **ESPECIFICADO** QUE ES LO QUE DESEA VER. RESPONDE 0 AL CASO CONTRARIO, CUANDO EL USUARIO **SI** **ESPECIFIQUE** LO QUE DESEA VER.\n\n# Ejemplos de cuando debes responder 1:\n\n## Ejemplo 1\nuser: \"me mostras la otra ahora porfa\" / \"quiero ver la que queda\" / \"mostrame la otra\" / \"a ver la segunda\" / \"otra mas mostrame\"\n-AQUI TU RESPUESTA DEBE SER: 1\n\n# Ejemplos de cuando debes responder 0:\n\nuser: \"hola buenas\" / \"quiero ver propiedades\"/ \"buscaba una\" \"propiedad\" / \"una casa en puerto varas\" / \"queria ver propiedades\" / \"si dame mas fotos\" / \"me das mas info\" / \"pasame la cotizacion\" / \"cual es la condicion?\"\n-EN ESTAS SITUACIONES, TU RESPUESTA DEBE SER: 0\n\n# Como diferenciar con eficacia cuando debes responder 1 y cuando debes responder 0\n\n# Si el usuario pide que se le muestre mas y no especifica el que, debes responde 0.\n-Aqui ejemplos: user: \"me mostras la otra ahora porfa\" / \"quiero ver la que queda\" / \"mostrame la otra\" / \"a ver la segunda\" / \"otra mas mostrame\"\n\n# Si el usuario pide que se le muestre mas y especifica el que, debes responder 1.\n-Aqui ejemplos: user: \"si dame mas fotos\" / \"me das mas info\" / \"quiero ver propiedades\" / \"queria ver propiedades\""}]}},"id":"3231917b-1eca-4122-b2da-2025f8dac679","name":"Basic LLM Chain5","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.4,"position":[-220,1820]},{"parameters":{"promptType":"define","text":"={{ $('WhatsApp Trigger').first().json.messages[0].text.body }}","options":{"systemMessage":"=# Ejemplos de como debes conversar\n## Ejemplo 1:\nuser: hola buenas\nassistant: Buenas, que tal? Puedo ayudarte en algo? Si buscabas ver propiedades, agendar una cita o tenes alguna pregunta sobre Vento no dudes en decirme, sos nuestra prioridad!\nuser: si queria ver una propiedad\nassistant: Dale, que tipo de propiedad buscas y en que ciudad?\nuser: busco en pucon\nassistan: Queres que te muestre propiedades en puco o me queres mencionar algun detalle mas?\nuser: quiero una parcela\nassistant: [aca ejecutaste tu funcion \"busqueda\"]: (respondes en base a la respuesta de tu funcion).\nuser: quiero ver mas fotos\nassistant: [aca ejecutaste tu funcion \"VENTO\"]: (respondes en base a la respuesta de tu funcion).\nuser: quiero ver otras\nassistant: Buenisimo, decime que detalles queres cambiar, el tipo de propiedad, la ciudad? O tenes otros detalles en mente como el precio o dormitorios?\nuser: si quiero con 3 dormitorios\nassistant: Que tipo de propiedad te gustaria ver con 3 dormitorios? Y en que ciudad?\nuser: en puerto varas un departamento\nassistant: Genial, queres mencionar otro detalle o busco ahora?\nuser: ahora\nassistant [aca ejecutaste tu funcion \"busqueda\"]: (respondes en base a la respuesta de tu funcion).\n\n## Ejemplo 2:\nuser: hola\nassistant: Buenas, como estas? Te puedo ayudar a encontrar tu propiedad perfecta? O dime tu con que puedo ayudarte.\nuser: nose decime vos\nassistant: Bueno, de mi parte estoy encantando en asistirte a encontrar tu propiedad ideal, pero tambien puedo agendarte visitas a las propiedades, responderte especificamente lo que necesites saber de ellas, o darte la info que necesites sobre nosotros Vento, asi que dime como puedo asesorarte?\nuser: quiero saber si tienen casas\nassistant: Buscas en alguna ciudad en particular las casas? O queres que te responda eso ahora?\nuser: respondeme eso\nassistant [aca ejecutaste tu funcion \"busqueda\"]: (respondes en base a la respuesta de tu funcion).\nuser: ahora quiero agendar una visita.\nassistant: Bien, dime en que fecha y hora te gustaria agendar?\nuser: martes a las 7pm\nassistant [aca ejecutaste tu funcion \"busqueda\"]: (respondes en base a la respuesta de tu funcion).\n\n# Tarea \nAtende a los usuarios interesados en comprar propiedades, acompañándolos desde la búsqueda inicial hasta la toma de decisiones concretas. Esto incluye:\n\n- Identificar las necesidades del usuario (ubicación, tipo de propiedad, presupuesto, etc.).\n\n- Recomendar propiedades coincidientes a las caracteristicas mencionadas por el usuario.\n\n- Proporcionar mas imagenes cuando el usuario lo pida, dar cotizacion cuando el usuario lo pida, dar mas informacion sobre la propiedad cuando el usuario lo pida, explicar la condicion cuando el usuario lo pida. \n\n- Agendar citas al usuario cuando lo pida.\n\n# Notas\n-**IMPORTANTISIMO:** **NUNCA LE AVISES AL USUARIO QUE BUSCARAS SU PROPIEDAD, EN CAMBIO EJECUTA DE MANERA INMEDIATA TU HERRAMIENTA \"busqueda\" ENVIANDO LOS DETALLES DE LA PROPIEDAD QUE MENCIONO EL USUARIO.**"}},"id":"813a5343-dd48-4ef7-a3be-4c590706a6f9","name":"AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[580,1580],"executeOnce":true},{"parameters":{"agent":"conversationalAgent","promptType":"define","text":"=# Total de propiedades encontradas = {{ $('MongoDB12').first().json.encontradas }}\n- Representa la cantidad total de propiedades que cumplen con los filtros del usuario.\n\n# Propiedades unicas que fueron mostradas al usuario = {{ $('Code11').first().json.result }}\n- Indica cuántas propiedades de las encontradas se han mostrado.\n\n# Cantidad de propiedades mostradas en esta iteración = 1\n- Siempre sera 1 maximo.\n\n# Propiedades restantes porque el usuario vea = {{ $('Code12').first().json.item.restantes }}","hasOutputParser":true,"options":{"systemMessage":"=# Tarea\nDebes realizar sumas y restas para devolver siempre una respuesta correcta. Te llegara informacion sobre propieades encontradas y mostradas al usuario, y vos debes analizarla haciendo sumas y restas para devolver la respuesta correcta.\n\n# Ejemplo de como debes responder dependiendo la informacion encontrada: \n\n## Ejemplo 1\n- # Total de propiedades encontradas = 4 / Propiedades unicas que fueron mostradas al usuario = 2 / Cantidad de propiedades mostradas en esta iteración = 1\n\n- Tu respuesta: “Bueno fijate que te parece esta, me podes pedir mas informacion o cualquier cosa que necesites, si te gusta vamos para adelante y sino te muestro la tercera, que aun te quedan 2 por ver. ”\n\n## Ejemplo 2\n- Total de propiedades encontradas = 2 / Propiedades unicas que fueron mostradas al usuario = 2 / Cantidad de propiedades mostradas en esta iteración = 1\n\n- Tu respuesta: “Esta es la segunda que encontre que coincide con todo lo que me pediste, mirala tranquilo y decime que te parece o si avisame si tenes alguna duda o si necesitas que haga algo por vos. Tambien me podes mencionar un detalle diferente y te busco con ese detalle distinto!\"\n\n## Ejemplo 3\n- Total de propiedades encontradas = 3 / Propiedades unicas que fueron mostradas al usuario = 2 / Cantidad de propiedades mostradas en esta iteración = 1\n\n- Tu respuesta: “Comentame que te parece esta segunda que es linda para mi! Cualquier duda consultame y se necesitas que te mas info avisame, sino decime y te muestro la ultima que te queda por ver!”\n\n# Notas\n- **NO** se mostraran mas de 1 propiedad por tanda al usuario ya que es el limite por tanda."}},"id":"72d8153b-e10c-4c4b-be73-ef46039fa600","name":"AI Agent13","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[2600,2080],"executeOnce":true},{"parameters":{"assignments":{"assignments":[{"id":"237ae309-5bde-4f38-92a6-26a1a50138e4","name":"num","value":"={{ $('Code11').first().json.result }}","type":"string"}]},"options":{}},"id":"dbd51dd6-eccb-4737-a9f9-7f2938638dab","name":"Edit Fields4","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2140,2600]},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('WhatsApp Trigger').first().json.contacts[0].wa_id }}","textBody":"={{ $('MongoDB7').item.json['Foto portada'][ $json.num ] }}","additionalFields":{},"requestOptions":{}},"id":"ba6b7876-2655-4905-b476-f533c4d42266","name":"WhatsApp Business Cloud6","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[1840,2420],"executeOnce":true},{"parameters":{"jsCode":"// Obtenemos la variable \"Foto portada\" del nodo MongoDB7\nconst fotoPortadaData = $('MongoDB7').first().json['Foto portada'];\n\n// Obtenemos el índice (1-indexado) del item a enviar desde el nodo Code11\nconst selectedIndex = $('Code11').first().json.result;\n\nlet selectedLink;\n\n// Verificamos el tipo de \"Foto portada\"\nif (Array.isArray(fotoPortadaData)) {\n\t// Si es un array, seleccionamos el elemento usando (selectedIndex - 1)\n\tif (selectedIndex < 1 || selectedIndex > fotoPortadaData.length) {\n\t\tthrow new Error(`El índice ${selectedIndex} está fuera de rango. La lista contiene ${fotoPortadaData.length} items.`);\n\t}\n\tselectedLink = fotoPortadaData[selectedIndex - 1];\n} else if (fotoPortadaData && typeof fotoPortadaData === 'object') {\n\t// Si es un objeto, convertimos sus valores a un array y seleccionamos el correspondiente\n\tconst valuesArray = Object.values(fotoPortadaData);\n\tif (selectedIndex < 1 || selectedIndex > valuesArray.length) {\n\t\tthrow new Error(`El índice ${selectedIndex} está fuera de rango. La colección contiene ${valuesArray.length} items.`);\n\t}\n\tselectedLink = valuesArray[selectedIndex - 1];\n} else if (typeof fotoPortadaData === 'string') {\n\t// Si es una cadena, solo hay un link; por lo tanto, solo el índice 1 es válido\n\tif (selectedIndex !== 1) {\n\t\tthrow new Error(`Solo se encontró un link, pero se solicitó el item ${selectedIndex}.`);\n\t}\n\tselectedLink = fotoPortadaData;\n} else {\n\tthrow new Error('El tipo de la variable \"Foto portada\" no es reconocido.');\n}\n\n// Obtenemos el wa_id del primer contacto desde el nodo WhatsApp Trigger\nconst waId = $('WhatsApp Trigger').first().json.contacts[0].wa_id;\n\n// Construimos el cuerpo de la petición para enviar la imagen\nconst body = {\n\tmessaging_product: \"whatsapp\",\n\tto: waId,\n\ttype: \"image\",\n\timage: {\n\t\tlink: selectedLink\n\t}\n};\n\n// Configuración de la petición HTTP a la API de WhatsApp Business\nconst options = {\n\tmethod: 'POST',\n\turi: 'https://graph.facebook.com/v15.0/534053139786090/messages', // Business Account ID\n\theaders: {\n\t\t'Content-Type': 'application/json',\n\t\t'Authorization': 'Bearer EAAy9M2MnnvkBOZC0ZCsGJPNeiHvVK6Hw4GCMVR1bjKSjaxOaHV5XtZCb5yzWVwgNRL9PMHS4RHNXgskZBZBMmO6IB8uK10A7b8so75VPy4pfkY6uXZBOwYljpGAzwZD'\n\t},\n\tbody,\n\tjson: true,\n};\n\n// Realizamos la petición HTTP de forma asíncrona usando this.helpers.request\nconst response = await this.helpers.request(options);\n\n// Retornamos la respuesta de la API para pasos posteriores o debug\nreturn [{ json: response }];\n"},"id":"06331553-97da-452d-8b32-caca8225498b","name":"Code","type":"n8n-nodes-base.code","typeVersion":2,"position":[2060,2080],"disabled":true},{"parameters":{"jsCode":"// Obtenemos el índice seleccionado desde Code11 (se espera que sea un número 1-indexado)\nconst selectedIndex = $('Code11').first().json.result;\nif (typeof selectedIndex !== 'number') {\n\tthrow new Error('El valor devuelto por Code11 no es un número.');\n}\n\n// Obtenemos todos los documentos retornados por el nodo MongoDB7\nconst mongoDocs = $('MongoDB7').all();\n\nif (!mongoDocs || mongoDocs.length === 0) {\n\tthrow new Error('No se encontraron documentos en el nodo MongoDB7.');\n}\n\n// Convertimos a índice 0-indexado\nconst idx = selectedIndex - 1;\n\nif (idx < 0 || idx >= mongoDocs.length) {\n\tthrow new Error(`El índice ${selectedIndex} está fuera de rango. Se encontraron ${mongoDocs.length} items en MongoDB7.`);\n}\n\n// Retornamos el documento completo del nodo de Mongo correspondiente al índice seleccionado\nreturn [ mongoDocs[idx].json ];\n"},"id":"0c334814-568e-415e-ad49-85372b127818","name":"Code1","type":"n8n-nodes-base.code","typeVersion":2,"position":[1580,2080]},{"parameters":{},"id":"203bdf63-a2a1-40ac-bd7a-59378b0bfbed","name":"Execute Workflow Trigger","type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1,"position":[-1200,3680]},{"parameters":{"options":{"temperature":0}},"id":"1120b707-2931-4e23-9d6c-e5736371db01","name":"OpenAI Chat Model22","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[960,3920]},{"parameters":{"assignments":{"assignments":[{"id":"c573d91e-8427-4e4e-8415-b2d7b8372489","name":"phone","value":"={{ $('Execute Workflow Trigger').first().json.cel }}","type":"string"},{"id":"31e4b598-8383-433e-a74e-8fd8719861e3","name":"busqueda","value":"=1","type":"string"},{"id":"75f69e23-c387-4e40-827a-886542c6aaf8","name":"encontradas","value":"={{ $('MongoDB6').all().length }}","type":"string"},{"id":"7aee5168-d9b5-4439-959a-4278d845064e","name":"mostradas","value":"=1","type":"string"},{"id":"6e2b8c8a-ed02-419c-bb20-c3574a8096d7","name":"Tipo_de_Operacion","value":"={{ $('MongoDB6').item.json.Operacion }}","type":"string"},{"id":"a92f2cc5-f7e2-452c-9a8c-dc0f8b3f2122","name":"Tipo_de_Propiedad","value":"={{ $('MongoDB6').item.json.Propiedad }}","type":"string"},{"id":"191069b9-a16a-4f96-ae27-a3d259a09955","name":"Localidad","value":"={{ $('MongoDB6').item.json.Localidad }}","type":"string"},{"id":"3e3da8d3-9fbd-401d-b01e-f46e4889d4c7","name":"Habitaciones","value":"={{ $('Execute Workflow Trigger').first().json.query.dormitorios }}","type":"string"}]},"options":{}},"id":"ae162b62-7317-486e-b5da-59b3ebade358","name":"Edit Fields7","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[140,3780],"alwaysOutputData":true,"executeOnce":true},{"parameters":{"assignments":{"assignments":[{"id":"64f8ca2b-4a32-441e-9320-6acecce09d0b","name":"response","value":"=**RESPONDELE EXACTAMENTE ESTO AL USUARIO: {{ $json.output }}**","type":"string"}]},"options":{}},"id":"21d1dea2-ef4f-4eb6-aefc-5973fe9fe54f","name":"Edit Fields8","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1260,3780]},{"parameters":{"jsCode":"const mongoItems = $('MongoDB11').all().map(item => ({\n    // Se utiliza \"habitaciones\" en lugar de \"dormitorios\" y se convierte a número\n    habitaciones: Number(item.json.habitaciones),\n    // Convertimos el precio a número directamente, ya que el valor viene limpio\n    precio: Number(item.json.precio)\n}));\n\n// Función para convertir el presupuesto, p.ej., \"300MIL\" a 300000\nfunction convertirPresupuesto(presupuesto) {\n    if (typeof presupuesto === 'string') {\n        let presupuestoUpper = presupuesto.trim().toUpperCase();\n        if (presupuestoUpper.endsWith(\"MIL\")) {\n            let numericPart = presupuestoUpper.replace(\"MIL\", \"\").trim();\n            let valor = Number(numericPart);\n            if (!isNaN(valor)) {\n                return valor * 1000;\n            }\n        }\n    }\n    return Number(presupuesto);\n}\n\n// Obtener valores del usuario\nconst userData = $('Execute Workflow Trigger').first().json.query;\nconst userFilters = {\n    presupuesto: userData.presupuesto ? convertirPresupuesto(userData.presupuesto) : null,\n    // Se utiliza \"dormitorios\" en la query y se convierte a número, para comparar con \"habitaciones\"\n    habitaciones: userData.dormitorios ? Number(userData.dormitorios) : null\n};\n\n// Verificar si hay propiedades dentro del presupuesto\nconst propiedadesDentroPresupuesto = mongoItems.filter(item =>\n  userFilters.presupuesto ? item.precio <= userFilters.presupuesto : false\n);\nconst hayPropiedadesEnPresupuesto = propiedadesDentroPresupuesto.length > 0;\n\n// Determinar si hay coincidencias exactas en habitaciones\nconst hayHabitaciones = userFilters.habitaciones\n  ? propiedadesDentroPresupuesto.some(item => item.habitaciones === userFilters.habitaciones)\n  : true;\n\n// Si hay propiedades en el presupuesto pero NO coinciden en habitaciones\nif (hayPropiedadesEnPresupuesto) {\n  if (!hayHabitaciones && userFilters.habitaciones) {\n    const valoresDisponibles = [...new Set(propiedadesDentroPresupuesto.map(item => item.habitaciones))].sort((a, b) => a - b);\n    return [{\n      json: {\n        precio: \"SI HAY\",\n        habitaciones: valoresDisponibles.join(\", \")\n      }\n    }];\n  }\n}\n\n// Si NO hay propiedades dentro del presupuesto pero SÍ hay coincidencias en habitaciones\nif (!hayPropiedadesEnPresupuesto) {\n  if (userFilters.habitaciones && mongoItems.some(item => item.habitaciones === userFilters.habitaciones)) {\n    const preciosDisponibles = [...new Set(mongoItems.map(item => item.precio))].sort((a, b) => a - b);\n    return [{\n      json: {\n        precio: preciosDisponibles.join(\", \"),\n        habitaciones: \"SI HAY\"\n      }\n    }];\n  }\n}\n\n// Si no hay coincidencias en nada, devolver un mensaje de error\nreturn [{\n  json: {\n    mensaje: \"No se encontraron coincidencias\"\n  }\n}];"},"id":"e604a730-55c6-418e-960a-11c2496e1ede","name":"Code4","type":"n8n-nodes-base.code","typeVersion":2,"position":[840,3260]},{"parameters":{"content":"dormitorios. precio no","height":80},"id":"cf9d2368-b571-4df1-a340-75a030a1d486","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1420,2920]},{"parameters":{"content":"baños. precio no","height":80},"id":"e39d1664-ca23-4ef3-b90a-ebf81ce48226","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1420,3060]},{"parameters":{"content":"ambientes. precio no","height":80},"id":"4916cbf2-00b9-4060-9f65-282f6e7cbeca","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1420,3180]},{"parameters":{"assignments":{"assignments":[{"id":"6824f654-9b73-494b-864e-62785388f716","name":"response","value":"=**RESPONDELE ESTO AL USUARIO: Si tenemos por ese prespuesto que menciono pero no por con ese numero de dormitorios, en cambio podemos ofrecerle con estos numeros: {{ $('Code4').first().json.habitaciones }}. Finaliza tu mensaje preguntandole que numero especifico desea de estas opciones (ya que solo puede mencionar uno) asi volves a hacerle su busqueda con ese numero especifico que te mencione**","type":"string"}]},"options":{}},"id":"04ada98c-2373-471d-9133-16d5a9c33edd","name":"Edit Fields50","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1520,3280]},{"parameters":{"assignments":{"assignments":[{"id":"6824f654-9b73-494b-864e-62785388f716","name":"response","value":"=**RESPONDELE ESTO AL USUARIO: Si tenemos por ese prespuesto que menciono pero no por con ese numero de baños, en cambio podemos ofrecerle con estos numeros: {{ $('Code4').first().json.baños }}. Finaliza tu mensaje preguntandole que numero especifico desea de estas opciones (ya que solo puede mencionar uno) asi volves a hacerle su busqueda con ese numero especifico que te mencione**","type":"string"}]},"options":{}},"id":"ce25a40b-ff17-4d9d-9c91-51633a845f11","name":"Edit Fields53","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1520,3440]},{"parameters":{"assignments":{"assignments":[{"id":"6824f654-9b73-494b-864e-62785388f716","name":"response","value":"=**RESPONDELE ESTO AL USUARIO: Si tenemos por ese prespuesto que menciono pero no por con ese numero de ambientes, en cambio podemos ofrecerle con estos numeros: {{ $('Code4').first().json.ambientes }}. Finaliza tu mensaje preguntandole que numero especifico desea de estas opciones (ya que solo puede mencionar uno) asi volves a hacerle su busqueda con ese numero especifico que te mencione**","type":"string"}]},"options":{}},"id":"d59447c9-ff80-448a-81a1-4128264916cb","name":"Edit Fields57","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1520,3620]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"6c74aad2-65c9-43a1-b051-bbb7da5e4137","leftValue":"={{ $json.dormitorios }}","rightValue":"SI HAY","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"90c4e215-15ca-4cc5-bdd4-4f332c946391","leftValue":"={{ $json.baños }}","rightValue":"SI HAY","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"1cf9484d-5170-47db-9a42-42c2a075b040","leftValue":"={{ $json.ambientes }}","rightValue":"SI HAY","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"9130a7b9-a313-4fad-9283-6ef305d4997d","leftValue":"={{ $json.precio }}","rightValue":"SI HAY","operator":{"type":"string","operation":"equals"}}],"combinator":"and"}}]},"options":{}},"id":"78c884d0-efff-4021-a6aa-ea3d882b77b7","name":"Switch","type":"n8n-nodes-base.switch","typeVersion":3.1,"position":[1020,3260]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $('Code4').first().json.habitaciones }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"48832db0-3956-4871-8c26-749b436c5204","leftValue":"={{ $('Code4').first().json.baños }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"4ca0e1d4-66f8-4c4c-b65c-35b3ccffe330","leftValue":"={{ $('Code4').first().json.ambientes }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"}}]},"options":{}},"id":"3ea2b38e-fd9f-4fef-a1dd-bda5140c5346","name":"Switch4","type":"n8n-nodes-base.switch","typeVersion":3.1,"position":[1280,3380]},{"parameters":{},"id":"2711f580-a52f-4894-a39c-13df888dfb8a","name":"When clicking ‘Test workflow’","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[5660,3160]},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"https://drive.google.com/file/d/140P3tJu4yLiqBh9xBWCNqQVPBooYJLI6/view?usp=sharing","mode":"url"},"options":{}},"id":"ccb2b897-52b3-4cf1-84f7-1406096ed469","name":"Google Drive","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[5880,3160]},{"parameters":{"model":"text-embedding-3-small","options":{}},"id":"06621109-c6ac-444a-9625-59a3764ea0a1","name":"Embeddings OpenAI","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1,"position":[6120,3260]},{"parameters":{"dataType":"binary","binaryMode":"specificField","loader":"pdfLoader","options":{}},"id":"3a7843d2-1904-4151-a19c-95228f8de388","name":"Default Data Loader1","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1,"position":[6320,3260]},{"parameters":{},"id":"3f0b2f5b-6374-4235-9792-424cfc549ac6","name":"Character Text Splitter1","type":"@n8n/n8n-nodes-langchain.textSplitterCharacterTextSplitter","typeVersion":1,"position":[6440,3440]},{"parameters":{"mode":"insert","pineconeIndex":{"__rl":true,"value":"n8n","mode":"list","cachedResultName":"n8n"},"options":{"pineconeNamespace":"kamaF"}},"id":"dda01d66-84e2-46b8-98ed-f89f4aebc60e","name":"Pinecone Vector Store1","type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1,"position":[6120,3040]},{"parameters":{"agent":"conversationalAgent","promptType":"define","text":"=# IMPORTANSIMO: **PRIORIZA REALIZAR SUMAS Y RESTAS SOBRE LA INFORMACION DE LAS PROPIEDADES ANTES QUE MIRAR LOS EJEMPLOS DE RESPUESTAS, PARA DE ESTA FORMA, NUNCA COMETER UN ERROR EN TUS RESPUESTAS.**\n\n# Total de propiedades encontradas = {{ $('MongoDB6').all().length }}\n- Representa la cantidad total de propiedades que cumplen con los filtros del usuario.\n\n# Número de veces que se han mostrado tandas de propiedades unicas de manera sucesiva de las propiedes encontradas = 1\n\n# Cantidad de propiedades mostradas en esta iteración = 1\n- El maximo siempre sera 1.","hasOutputParser":true,"options":{"systemMessage":"=# Tarea\nDebes realizar sumas y restas para devolver siempre una respuesta correcta. Te llegara informacion sobre propieades encontradas y mostradas al usuario, y vos debes analizarla haciendo sumas y restas para devolver la respuesta correcta.\n\n# Ejemplo de como debes responder dependiendo la informacion encontrada: \n\n## Ejemplo 1\n- Total de propiedades encontradas = 1 / Número de veces que se han mostrado tandas de propiedades unicas de manera sucesiva de las propiedes encontradas = 1 / Cantidad de propiedades mostradas en esta iteración = 1 \n\n- Tu respuesta: “Tenemos solo esa propiedad, si queres ver mas fotos o tenes alguna pregunta sobre ella decime, estoy para ayudarte en lo que necesites!. Sino, me podes decir un detalle distinto y te muestro otras”\n\n## Ejemplo 2\n- Total de propiedades encontradas = 4 / Número de veces que se han mostrado tandas de propiedades unicas de manera sucesiva de las propiedes encontradas = 1 / Cantidad de propiedades mostradas en esta iteración = 1 \n\n- Tu respuesta: “Encontre 4 propiedades que coinciden en todo, te muestro esta que seguro te guste, podes preguntarme lo que necesites, estoy para asistirte con todo! Tambien, si queres ver la segunda que encontre decime y te la muestro.”\n\n## Ejemplo 3:\n- Tu respuesta: “Encontre 2 que coinciden en todo, te muestro esta primero, queres que te de mas informacion o ver mas fotos sobre ella? Estoy para ayudarte en lo que necesites, tambien me podes decir y te muestro la otra sino!\"\n\n# Notas\n- **NO** se mostraran mas de 1 propiedad por tanda al usuario ya que es el limite por tanda."}},"id":"a3c895ea-38c7-4040-8e01-c52ce4182192","name":"AI Agent7","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[940,3780],"executeOnce":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"22f9091b-e467-4c3a-92d1-7ee21f4d2593","leftValue":"={{ ($('MongoDB6').all()[0].json) }}","rightValue":5,"operator":{"type":"object","operation":"empty","singleValue":true}},{"id":"351bc77d-717f-414e-a5bd-00eee4a1e118","leftValue":"={{ \n  $json[\"MongoDB3\"]?.length \n    ? (parseInt($json[\"MongoDB2\"].length) + 3 <= $json[\"Basic LLM Chain4\"]?.output?.Busqueda * 3) \n    : false \n}}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"or"},"options":{}},"id":"1fad471e-5531-4457-a46f-74a0a9d2a721","name":"If10","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[-80,3680],"alwaysOutputData":false,"executeOnce":true},{"parameters":{"collection":"vento real estate","options":{},"query":"={{ \n(() => {\n  const query = {};\n\n  const parseNumber = (value) => {\n    const num = parseInt(value);\n    return isNaN(num) ? null : num;\n  };\n\n  const processStringInput = (input) => {\n    if (!input) return [];\n    if (Array.isArray(input)) return input;\n    return input.toString().split(/[,;]/).map(el => el.trim()).filter(Boolean);\n  };\n\n  // Tipo de Propiedad\n  const tipoPropiedadValue = parseNumber($json['Tipo de Propiedad']);\n  if (tipoPropiedadValue !== null) {\n    query[\"Propiedad\"] = { \"$in\": [tipoPropiedadValue] };\n  }\n\n  // Tipo de Operación\n  const tipoOperacionValue = parseNumber($json['Tipo de Operacion']);\n  if (tipoOperacionValue !== null) {\n    query[\"Operacion\"] = { \"$in\": [tipoOperacionValue] };\n  }\n\n  // Localidad\n  const localidades = processStringInput($json['Localidad']);\n  if (localidades.length > 0) {\n    query[\"Localidad\"] = { \"$in\": localidades };\n  }\n\n  // Habitaciones\n  const habitacionesValue = parseNumber($json['Habitaciones']);\n  if (habitacionesValue !== null) {\n    query[\"Dormitorio o Tamaño\"] = habitacionesValue;\n  }\n\n  return JSON.stringify(query);\n})()\n}}"},"id":"f5726b32-f777-432b-bd34-b3e087be6cfe","name":"MongoDB6","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[-240,3680],"alwaysOutputData":true,"executeOnce":false},{"parameters":{"operation":"insert","collection":"historial busqueda mercado libre","fields":"phone,busqueda,encontradas,mostradas,Tipo_de_Operacion,Tipo_de_Propiedad,Localidad","options":{}},"id":"e873611c-4dc7-45f1-a7a4-aa5790b4d8f7","name":"MongoDB10","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[300,3780],"executeOnce":true,"alwaysOutputData":true},{"parameters":{"collection":"vento real estate","options":{},"query":"={{\n(() => {\n  const query = {};\n\n  const parseNumber = (value) => {\n    const num = parseInt(value);\n    return isNaN(num) ? null : num;\n  };\n\n  const processArray = (input) => {\n    if (!input) return [];\n    if (Array.isArray(input)) return input.map(parseNumber).filter(Boolean);\n    return input\n      .toString()\n      .split(/[,;]/)\n      .map(el => parseNumber(el.trim()))\n      .filter(Boolean);\n  };\n\n  // Localidad\n  const localidades = processArray($json['Localidad']);\n  if (localidades.length > 0) query[\"id_localidad\"] = { \"$in\": localidades };\n\n  // Tipo de propiedad\n  const tipoPropiedad = parseNumber($json['Tipo de Propiedad']);\n  if (tipoPropiedad !== null) query[\"id_tipo_propiedad\"] = { \"$in\": [tipoPropiedad] };\n\n  // Tipo de operación\n  const tipoOperacion = parseNumber($json['Tipo de Operacion']);\n  if (tipoOperacion !== null) query[\"id_operacion\"] = { \"$in\": [tipoOperacion] };\n\n  return JSON.stringify(query);\n})()\n}}\n"},"id":"92c7595a-260f-4ba6-a215-eaf044c17cf0","name":"MongoDB11","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[520,3240],"alwaysOutputData":true,"executeOnce":true},{"parameters":{"assignments":{"assignments":[{"id":"3be3d1ad-e201-4fd7-98ba-cb212ad4fd49","name":"Tipo de Propiedad","value":"={{ $('Basic LLM Chain9').item.json.output['Tipo de Propiedad'] }}","type":"string"},{"id":"566aaa3d-9118-4797-9963-1233c34c5ce9","name":"Tipo de Operacion","value":"={{ $('Basic LLM Chain9').item.json.output['Tipo de Operacion'] }}","type":"string"},{"id":"d02d7067-48b2-4564-b6f3-87414b5e8869","name":"Localidad","value":"={{ $('Basic LLM Chain8').item.json.output.Localidad }}","type":"string"}]},"options":{}},"id":"a49bfe0d-139d-4da9-ad23-a60a6e82d299","name":"Edit Fields9","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[360,3240]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"22f9091b-e467-4c3a-92d1-7ee21f4d2593","leftValue":"={{ ($('MongoDB11').all()[0].json) }}","rightValue":5,"operator":{"type":"object","operation":"empty","singleValue":true}},{"id":"351bc77d-717f-414e-a5bd-00eee4a1e118","leftValue":"={{ \n  $json[\"MongoDB2\"]?.length \n    ? (parseInt($json[\"MongoDB2\"].length) + 3 <= $json[\"Basic LLM Chain4\"]?.output?.Busqueda * 3) \n    : false \n}}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"or"},"options":{}},"id":"62b83da6-fb2e-492c-84c8-21f98d9762cb","name":"If11","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[680,3240],"alwaysOutputData":false,"executeOnce":true},{"parameters":{"assignments":{"assignments":[{"id":"be243981-8f69-4ca6-880c-47a48e8cc008","name":"response","value":"**RESPONDELE EXACTAMENTE ESTO AL USUARIO: Lamentablemente no disponemos propiedades con tus características solicitadas, pero podrías mencionarme una operación o tipo de propiedad distinto y vuelvo a buscar?**","type":"string"}]},"options":{}},"id":"e069f861-8f87-4199-ac0e-5ab9dad6efa2","name":"Edit Fields10","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[840,3100]},{"parameters":{"assignments":{"assignments":[{"id":"6824f654-9b73-494b-864e-62785388f716","name":"response","value":"=Si tenemos con los dormitorios que menciono pero no por ese presupuesto maximo, en cambio podemos ofrecerle con estos presupuestos maximos: {{ $json.precio }} \n\n**RESPONDELE ESTO AL USUARIO: Si tenemos [Tipo de Propiedad que menciono el usuario] con [Numero especifico que menciono el user] dormitorios en [Localidad que menciono el usuario], pero no por el presupuesto maximo de [Presupuesto/precio que menciono el user]. Las opciones de precio comienzan desde [Opcion de prespuesto minimo que si disponemos] hasta [Opcion de presupuesto maximo que si disponemos]. Por favor dime un presupuesto maximo en ese rango y vuelvo a buscarte con ese detalle distinto.**","type":"string"}]},"options":{}},"id":"d0dadddd-71f1-4a60-a531-25f477eae78e","name":"Edit Fields11","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1280,2920]},{"parameters":{"assignments":{"assignments":[{"id":"6824f654-9b73-494b-864e-62785388f716","name":"response","value":"=Si tenemos con los baños que menciono pero no por ese presupuesto maximo, en cambio podemos ofrecerle con estos presupuestos maximos: {{ $json.precio }} \n\n**RESPONDELE ESTO AL USUARIO: Si tenemos [Tipo de Propiedad que menciono el usuario] con [Numero especifico que menciono el user] baños en [Localidad que menciono el usuario], pero no por el presupuesto maximo de [Presupuesto/precio que menciono el user]. Las opciones de precio comienzan desde [Opcion de prespuesto minimo que si disponemos] hasta [Opcion de presupuesto maximo que si disponemos] Por favor dime un presupuesto maximo en ese rango y vuelvo a buscarte con ese detalle distinto.**","type":"string"}]},"options":{}},"id":"1ebab221-195b-4895-aca7-75f5d6f65474","name":"Edit Fields12","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1280,3060]},{"parameters":{"assignments":{"assignments":[{"id":"3485c39f-128a-458f-8917-6b9583d6812e","name":"busqueda","value":"1","type":"string"},{"id":"462d8da4-7e0b-4c0e-a74a-1f8275c0a92f","name":"Tipo de Propiedad","value":"={{ $('Execute Workflow Trigger').first().json.query['tipo de propiedad'] }}","type":"string"},{"id":"d1d48f29-d3e0-4879-a947-9d092545d948","name":"Tipo de Operacion","value":"={{ $('Execute Workflow Trigger').first().json.query['tipo de operacion'] }}","type":"string"},{"id":"9fa4c65f-8e2f-4f6d-80a4-8efb2f6849a4","name":"Localidad","value":"={{ $('Execute Workflow Trigger').first().json.query.localidad }}","type":"string"},{"id":"8394dbc7-df73-41f7-b276-ab175d3861ea","name":"Habitaciones","value":"={{ $('Execute Workflow Trigger').first().json.query.dormitorios }}","type":"string"},{"id":"4f183342-3140-421a-afab-403e6e5a7d15","name":"Baños","value":"={{ $('Execute Workflow Trigger').first().json.query.baños }}","type":"string"},{"id":"db03c098-263e-4cbd-84e5-e5f0d31cefdb","name":"Ambientes","value":"={{ $('Execute Workflow Trigger').first().json.query.ambientes }}","type":"string"}]},"options":{}},"id":"e7b20334-5da1-4c35-890e-f1bbe3845e37","name":"Edit Fields13","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-400,3680],"alwaysOutputData":true,"executeOnce":true},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('Execute Workflow Trigger').first().json.cel }}","messageType":"image","mediaLink":"={{ $('MongoDB6').first().json['Foto portada'] }}","additionalFields":{},"requestOptions":{}},"id":"14258ac0-1c04-46f0-aeca-0c0467be0d95","name":"WhatsApp Business Cloud7","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[460,3780],"executeOnce":true},{"parameters":{"operation":"insert","collection":"info completa vento","fields":"phone,Descripción,Condiciones de compra,Enlace para descargar cotización,Fotos adicionales 4,Fotos adicionales 3,Fotos adicionales 2,Fotos adicionales 1,Link más información","options":{}},"id":"4cf41e86-e882-4b6a-972f-b8a228b3f7f3","name":"MongoDB14","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[780,3780],"executeOnce":true,"alwaysOutputData":true},{"parameters":{"assignments":{"assignments":[{"id":"ef7ffe70-511a-4887-b54e-65696ff13f75","name":"ID","value":"={{ $('MongoDB6').first().json.ID }}","type":"string"},{"id":"2ca9738b-df8e-487b-ac2c-6044c0619635","name":"phone","value":"={{ $('Execute Workflow Trigger').first().json.cel }}","type":"string"},{"id":"46bd66e9-e398-42f7-b39d-0ba3f30d3c10","name":"Fotos adicionales 1","value":"={{ $('MongoDB6').item.json['Fotos adicionales 1'] }}","type":"string"},{"id":"81047acf-82af-4afa-a73c-c22b22c0ad7d","name":"Fotos adicionales 2","value":"={{ $('MongoDB6').item.json['Fotos adicionales 2'] }}","type":"string"},{"id":"f2eef856-b45c-4a00-8aa6-4c4bbbe8fb93","name":"Fotos adicionales 3","value":"={{ $('MongoDB6').item.json['Fotos adicionales 3'] }}","type":"string"},{"id":"70067126-93e8-45fd-a2b5-dee0426985bc","name":"Fotos adicionales 4","value":"={{ $('MongoDB6').item.json['Fotos adicionales 4'] }}","type":"string"},{"id":"2c8a9dd1-4b55-4fe2-a815-c84c3684d5c8","name":"Enlace para descargar cotización","value":"={{ $('MongoDB6').item.json['Enlace para descargar cotización'] }}","type":"string"},{"id":"8e3b8574-d971-42b4-a6f2-8f43c6f77352","name":"Condiciones de compra","value":"={{ $('MongoDB6').item.json['Condiciones de compra'] }}","type":"string"},{"id":"c9e86995-79c5-42f9-abbb-4232a9b5e557","name":"Descripción","value":"={{ $('MongoDB6').item.json['Descripción'] }}","type":"string"},{"id":"69421262-7eda-4749-966a-fbcdda3b4807","name":"Link más información","value":"={{ $('MongoDB6').first().json['Link más información'] }}","type":"string"}]},"options":{}},"id":"1d0da8fa-03d6-4787-af9b-11e35bbea336","name":"Edit Fields14","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[620,3780]},{"parameters":{"collection":"info completa vento","options":{},"query":"={\n  \"phone\": \"{{ $('Execute Workflow Trigger').first().json.cel }}\"\n}"},"id":"c27a203d-9891-4632-9324-dcd50aae6a2d","name":"MongoDB15","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[-1040,3680],"executeOnce":true,"alwaysOutputData":true},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"fc25d931-b80a-45bc-bce4-027781e0332d","leftValue":"={{ $json.phone }}","rightValue":"","operator":{"type":"string","operation":"notExists","singleValue":true}}],"combinator":"and"},"options":{}},"id":"50231d6d-6c5c-4f55-b5cc-cc4f0bcec779","name":"If12","type":"n8n-nodes-base.if","typeVersion":2.1,"position":[-1360,3500]},{"parameters":{"operation":"delete","collection":"historial busqueda mercado libre","query":"={ \"$expr\": { \"$eq\": [\"$_id\", { \"$toObjectId\": \"{{$json[\"_id\"]}}\" }] } }"},"id":"b420870e-2d06-420f-9708-aeceed3cd8fc","name":"MongoDB16","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[-560,3680],"alwaysOutputData":true,"executeOnce":true},{"parameters":{"collection":"historial busqueda mercado libre","options":{},"query":"={\n  \"phone\": \"{{ $('Execute Workflow Trigger').first().json.cel }}\"\n}"},"id":"2f4d33e3-9766-47f1-9d67-bf1906f86772","name":"MongoDB17","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[-720,3680],"alwaysOutputData":true,"executeOnce":true},{"parameters":{"assignments":{"assignments":[{"id":"bd7d0f2d-ebd9-45f1-a902-3f7503823d90","name":"response","value":"=**MIRA LA SIGUIENTE INFORMACION Y RESPONDELE AL USUARIO **SOLAMENTE** CON LOS PUNTOS MAS DESTACADOS DE LA PROPIEDAD, GENERANDOLE UN MENSAJE PROFESIONAL COMO UN AUTENTICO VENDEDOR, LOGRANDO QUE EL MENSAJE CONVENCA AL USUARIO DE QUE ES UNA GRAN PROPIEDAD: {{ $('MongoDB9').first().json['Descripción'] }}\n\nFINALIZA TU MENSAJE PREGUNTANDOLE SI TIENE ALGUNA DUDA O SI EN CASO DE QUE LE HAYO GUSTADO, SI QUIERE VISITAR LA PROPIEDAD.**\n\n# ACLARACION\nNO LE DES INFORMACION EXTENSA, SE BREVE Y SELECCIONA LOS PUNTOS QUE MAS DESTAQUE DE LA PROPIEDAD, ACTUANDO COMO UN VENDEDOR EXPERTO INMOBILIARIO, PROCEDIENDO A REDACTARLE EN TEXTO PLANO, EXCLUYENDO ITEMS Y SIMBOLOS..\n\n# OBLIGATORIO\n**LA INFORMACION QUE **NO** SEA LOS PUNTOS MAS DESTACADOS, NO SE LA ENVIES AL USUARIO.**","type":"string"}]},"options":{}},"id":"ed760eb3-1754-4d85-a15f-22bef3b86ca3","name":"informacion","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[5020,2360]},{"parameters":{"assignments":{"assignments":[{"id":"bd7d0f2d-ebd9-45f1-a902-3f7503823d90","name":"response","value":"=**RESPONDELE AL USUARIO QUE SI LE GUSTO ALGUNA DE LAS IMAGENES QUE LE MOSTRASTE O ESTA INTERESADO EN LA PROPIEDAD, LE PODES AGENDAR UNA VISITA, PERO QUE SI TODAVIA NECESITA MAS INFO NO DUDE EN PEDIRTELA YA QUE VOS ESTAS A SU TOTAL DISPOSICION.**","type":"string"}]},"options":{}},"id":"b5301ac5-f587-4a88-aead-74971157ad65","name":"imagenes","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[5660,2540]},{"parameters":{"assignments":{"assignments":[{"id":"bd7d0f2d-ebd9-45f1-a902-3f7503823d90","name":"response","value":"=**RESPONDELE AL USUARIO QUE PUEDE MIRAR TRANQUILO LA COTIZACION QUE LE ACABAS DE ENVIAR, Y QUE SI LE SURGE ALGUNA DUDA TE PREGUNTE SIN PROBLEMA, YA QUE ESTAS PARA AYUDARLE CON TODO LO QUE NECESITE SABER O VER ESPECIFICAMENTE SOBRE ESTA PROPIEDAD.**","type":"string"}]},"options":{}},"id":"478c3cb5-b64c-4797-ad23-db697374d081","name":"cotizacion","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[5180,2700]},{"parameters":{"assignments":{"assignments":[{"id":"bd7d0f2d-ebd9-45f1-a902-3f7503823d90","name":"response","value":"=**EXPLICALE DE FORMA SIMPLE Y SENCILLA LA COTIZZACION AL USUARIO, AQUI TIENES LO NECESARIO PARA EXPLICARSELA: {{ $('MongoDB9').first().json['Condiciones de compra'] }}**","type":"string"}]},"options":{}},"id":"e4d05a3e-6e51-429c-8f57-661d862ff1fd","name":"condicion","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[5020,2900]},{"parameters":{"collection":"info completa vento","options":{},"query":"={\n  \"phone\": \"{{ $('Execute Workflow Trigger').first().json.cel }}\"\n}"},"id":"8bb57614-3f3e-49cd-81cf-a6586cc22e11","name":"MongoDB9","type":"n8n-nodes-base.mongoDb","typeVersion":1.1,"position":[4280,2640]},{"parameters":{"options":{"temperature":0}},"id":"cc7fd013-a987-4255-be70-54aa4a99b8eb","name":"OpenAI Chat Model2","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[4460,2800]},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('Execute Workflow Trigger').first().json.cel }}","textBody":"=Visitala aca: {{ $('MongoDB9').first().json['Link más información'] }}","additionalFields":{},"requestOptions":{}},"id":"4df6d5fa-391a-4c5b-937a-82b08bd0905a","name":"WhatsApp Business Cloud8","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[4900,2260]},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('Execute Workflow Trigger').first().json.cel }}","messageType":"image","mediaLink":"={{ $('MongoDB9').first().json['Fotos adicionales 1'] }}","additionalFields":{},"requestOptions":{}},"id":"4cc7f1bf-3e32-4930-adc1-b6443f9f5003","name":"WhatsApp Business Cloud9","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[5020,2540]},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('Execute Workflow Trigger').first().json.cel }}","messageType":"image","mediaLink":"={{ $('MongoDB9').first().json['Fotos adicionales 2'] }}","additionalFields":{},"requestOptions":{}},"id":"344bd859-212f-45bd-84b2-b557c6aabe86","name":"WhatsApp Business Cloud10","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[5180,2540]},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('Execute Workflow Trigger').first().json.cel }}","messageType":"image","mediaLink":"={{ $('MongoDB9').first().json['Fotos adicionales 3'] }}","additionalFields":{},"requestOptions":{}},"id":"5f16be57-418a-444c-82e3-dc65b4da6196","name":"WhatsApp Business Cloud11","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[5340,2540]},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('Execute Workflow Trigger').first().json.cel }}","messageType":"image","mediaLink":"={{ $('MongoDB9').first().json['Fotos adicionales 4'] }}","additionalFields":{},"requestOptions":{}},"id":"324201f0-a5a9-407c-bb08-dd563c7b3430","name":"WhatsApp Business Cloud12","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[5500,2540]},{"parameters":{"operation":"send","phoneNumberId":"526210793906283","recipientPhoneNumber":"={{ $('Execute Workflow Trigger').first().json.cel }}","messageType":"document","mediaLink":"={{ $('MongoDB9').first().json['Enlace para descargar cotización'] }}","additionalFields":{},"requestOptions":{}},"id":"5d989393-50de-4b68-83a3-1b2518bde269","name":"WhatsApp Business Cloud13","type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[5020,2700]},{"parameters":{"jsonSchemaExample":"{\n\t\"imagen\": \"Devolve esta variable SOLO cuando el usuario pida ver mas fotos/imagenes\",\n  \"condicion\": \"Devolve esta variable SOLO cuando el usuario pida ver la condicion\",\n  \"cotizacion\": \"Devolve esta variable SOLO cuando el usuario pida ver la cotizacion\",\n  \"informacion\": \"Devolve esta variable SOLO cuando el usaurio pida mas informacion\"\n}"},"id":"f0d224c5-9fe0-4281-8303-40d5f0d41663","name":"Structured Output Parser1","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[4620,2800]},{"parameters":{"promptType":"define","text":"={{ $('Execute Workflow Trigger').item.json.query.consulta }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=# Tarea\nEstas encargado de determinar que quiero saber especificamente el usuario y devolver en consecuencia el nombre del topico.\n\n# Ejemplo de consulta del user y tu respuesta en consecuencia\n\n## Ejemplo 1:\nuser: Quiero mas informacion por favor\n- **AQUI TU RESPUESTA DEBE SER LA PALABRA EN MINUSCULA: informacion.**\n\n## Ejemplo 2:\nuser: me das mas imagenes por fa\n- **AQUI TU RESPUESTA DEBE SER LA PALABRA EN MINUSCULA: imagen.**\n\n## Ejemplo 3:\nuser: me pasas la cotizacion \n- **AQUI TU RESPUESTA DEBE SER LA PALABRA EN MINUSCULA: cotizacion.**\n\n## Ejemplo 4: \nuser: cuales son las condiciones de compra?\n- **AQUI TU RESPUESTA DEBE SER LA PALABRA EN MINUSCULA: condicion.**\n\n# Notas\n-**IMPORTANTISIMO:** **SOLO PODES RESPONDER DE 4 FORMAS, CON LA PALABRA SIMPLE Y EN MINUSCULA: informacion O CON LA PALABRA SIMPLE Y EN MINUSCULA: imagen O CON LA PALABRA SIMPLE Y EN MINUSCULA: cotizacion O CON LA PALABRA SIMPLE Y EN MINUSCULA: condicion.**\n\n-**IMPORTANTISIMO:** **TUS RESPUESTAS SOLO PUEDEN SER: cotizacion / informacion / imagen / condicion.**\n\n-**IMPORTANTISIMO:** **TENES PROHIBIDO RESPONDER DE OTRA FORMA QUE NO SEAN CON LAS SIMPLE PALABRAS DE TUS 4 EJEMPLOS.**"}]}},"id":"e2385e8f-b8c9-440d-9aa7-19591004a4c1","name":"Basic LLM Chain1","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.4,"position":[4440,2640],"alwaysOutputData":true,"executeOnce":true},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"leftValue":"={{ $json.output.informacion }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"ee3c1a54-9ad1-4710-9953-49edb8bdc7ca","leftValue":"={{ $json.output.imagen }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"8bce1eb9-0a91-4782-8f52-d73dc5adb1df","leftValue":"={{ $json.output.cotizacion }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"}},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"de8cffe2-98fe-4d36-950d-c228b4385676","leftValue":"={{ $json.output.condicion }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"}}]},"options":{}},"id":"1898c3c7-3f2e-4717-b43a-c8e61ada4f8f","name":"Switch1","type":"n8n-nodes-base.switch","typeVersion":3.1,"position":[4760,2640]}],"connections":{"WhatsApp Trigger":{"main":[[{"node":"If4","type":"main","index":0}]]},"MongoDB":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Edit Fields1","type":"main","index":0}],[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"MongoDB1","type":"main","index":0}]]},"MongoDB1":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Edit Fields1":{"main":[[{"node":"MongoDB2","type":"main","index":0}]]},"MongoDB2":{"main":[[{"node":"Wait1","type":"main","index":0}]]},"Wait1":{"main":[[{"node":"MongoDB4","type":"main","index":0}]]},"Wait":{"main":[[{"node":"MongoDB4","type":"main","index":0}]]},"MongoDB4":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[{"node":"Edit Fields2","type":"main","index":0}]]},"Edit Fields2":{"main":[[{"node":"MongoDB3","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Zep":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"Structured Output Parser2":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser1","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model19":{"ai_languageModel":[[{"node":"Auto-fixing Output Parser1","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model12":{"ai_languageModel":[[{"node":"Basic LLM Chain3","type":"ai_languageModel","index":0}]]},"Auto-fixing Output Parser1":{"ai_outputParser":[[{"node":"Basic LLM Chain3","type":"ai_outputParser","index":0}]]},"WhatsApp Business Cloud":{"main":[[{"node":"If2","type":"main","index":0}]]},"WhatsApp Business Cloud1":{"main":[[{"node":"If3","type":"main","index":0}]]},"If4":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"If2":{"main":[[{"node":"WhatsApp Business Cloud1","type":"main","index":0}]]},"If3":{"main":[[{"node":"WhatsApp Business Cloud3","type":"main","index":0}]]},"busqueda":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"VENTO":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Basic LLM Chain3":{"main":[[{"node":"WhatsApp Business Cloud","type":"main","index":0}]]},"MongoDB12":{"main":[[{"node":"Code11","type":"main","index":0}]]},"Code11":{"main":[[{"node":"Edit Fields3","type":"main","index":0}]]},"Code12":{"main":[[{"node":"Code13","type":"main","index":0}]]},"Code13":{"main":[[{"node":"MongoDB5","type":"main","index":0}]]},"MongoDB5":{"main":[[{"node":"Code1","type":"main","index":0}]]},"Zep1":{"ai_memory":[[{"node":"AI Agent13","type":"ai_memory","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI Agent13","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"Basic LLM Chain5","type":"ai_languageModel","index":0}]]},"If5":{"main":[[{"node":"MongoDB12","type":"main","index":0}]]},"conversacion zep":{"main":[[{"node":"Basic LLM Chain5","type":"main","index":0}]]},"Edit Fields3":{"main":[[{"node":"MongoDB7","type":"main","index":0}]]},"MongoDB7":{"main":[[{"node":"Code12","type":"main","index":0}]]},"Edit Fields6":{"main":[[{"node":"MongoDB8","type":"main","index":0}]]},"MongoDB8":{"main":[[{"node":"Code","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser","type":"ai_outputParser","index":0}]]},"OpenAI Chat Model20":{"ai_languageModel":[[{"node":"Auto-fixing Output Parser","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model13":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0}]]},"Auto-fixing Output Parser":{"ai_outputParser":[[{"node":"Basic LLM Chain","type":"ai_outputParser","index":0}]]},"WhatsApp Business Cloud2":{"main":[[{"node":"If6","type":"main","index":0}]]},"WhatsApp Business Cloud4":{"main":[[{"node":"If7","type":"main","index":0}]]},"If6":{"main":[[{"node":"WhatsApp Business Cloud4","type":"main","index":0}]]},"If7":{"main":[[{"node":"WhatsApp Business Cloud5","type":"main","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"WhatsApp Business Cloud2","type":"main","index":0}]]},"MongoDB13":{"main":[[{"node":"If8","type":"main","index":0}]]},"If8":{"main":[[],[{"node":"If9","type":"main","index":0}]]},"If9":{"main":[[],[{"node":"conversacion zep","type":"main","index":0}]]},"Basic LLM Chain5":{"main":[[{"node":"If5","type":"main","index":0}]]},"AI Agent":{"main":[[{"node":"Basic LLM Chain3","type":"main","index":0}]]},"AI Agent13":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]},"Code1":{"main":[[{"node":"Edit Fields6","type":"main","index":0}]]},"Execute Workflow Trigger":{"main":[[{"node":"MongoDB15","type":"main","index":0}]]},"OpenAI Chat Model22":{"ai_languageModel":[[{"node":"AI Agent7","type":"ai_languageModel","index":0}]]},"Edit Fields7":{"main":[[{"node":"MongoDB10","type":"main","index":0}]]},"Code4":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[{"node":"Edit Fields11","type":"main","index":0}],[{"node":"Edit Fields12","type":"main","index":0}],[{"node":"Edit Fields13","type":"main","index":0}],[{"node":"Switch4","type":"main","index":0}]]},"Switch4":{"main":[[{"node":"Edit Fields50","type":"main","index":0}],[{"node":"Edit Fields53","type":"main","index":0}],[{"node":"Edit Fields57","type":"main","index":0}]]},"When clicking ‘Test workflow’":{"main":[[{"node":"Google Drive","type":"main","index":0}]]},"Google Drive":{"main":[[{"node":"Pinecone Vector Store1","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Pinecone Vector Store1","type":"ai_embedding","index":0}]]},"Default Data Loader1":{"ai_document":[[{"node":"Pinecone Vector Store1","type":"ai_document","index":0}]]},"Character Text Splitter1":{"ai_textSplitter":[[{"node":"Default Data Loader1","type":"ai_textSplitter","index":0}]]},"AI Agent7":{"main":[[{"node":"Edit Fields8","type":"main","index":0}]]},"If10":{"main":[[{"node":"Edit Fields9","type":"main","index":0}],[{"node":"Edit Fields7","type":"main","index":0}]]},"MongoDB6":{"main":[[{"node":"If10","type":"main","index":0}]]},"MongoDB10":{"main":[[{"node":"WhatsApp Business Cloud7","type":"main","index":0}]]},"MongoDB11":{"main":[[{"node":"If11","type":"main","index":0}]]},"Edit Fields9":{"main":[[{"node":"MongoDB11","type":"main","index":0}]]},"If11":{"main":[[{"node":"Edit Fields10","type":"main","index":0}],[{"node":"Code4","type":"main","index":0}]]},"Edit Fields13":{"main":[[{"node":"MongoDB6","type":"main","index":0}]]},"WhatsApp Business Cloud7":{"main":[[{"node":"Edit Fields14","type":"main","index":0}]]},"MongoDB14":{"main":[[{"node":"AI Agent7","type":"main","index":0}]]},"Edit Fields14":{"main":[[{"node":"MongoDB14","type":"main","index":0}]]},"MongoDB15":{"main":[[{"node":"MongoDB16","type":"main","index":0}]]},"MongoDB16":{"main":[[{"node":"Edit Fields13","type":"main","index":0}]]},"MongoDB17":{"main":[[{"node":"MongoDB16","type":"main","index":0}]]},"MongoDB9":{"main":[[{"node":"Basic LLM Chain1","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Basic LLM Chain1","type":"ai_languageModel","index":0}]]},"WhatsApp Business Cloud9":{"main":[[{"node":"WhatsApp Business Cloud10","type":"main","index":0}]]},"WhatsApp Business Cloud10":{"main":[[{"node":"WhatsApp Business Cloud11","type":"main","index":0}]]},"WhatsApp Business Cloud11":{"main":[[{"node":"WhatsApp Business Cloud12","type":"main","index":0}]]},"WhatsApp Business Cloud12":{"main":[[{"node":"imagenes","type":"main","index":0}]]},"WhatsApp Business Cloud13":{"main":[[{"node":"cotizacion","type":"main","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Basic LLM Chain1","type":"ai_outputParser","index":0}]]},"Basic LLM Chain1":{"main":[[{"node":"Switch1","type":"main","index":0}]]},"Switch1":{"main":[[{"node":"informacion","type":"main","index":0}],[{"node":"WhatsApp Business Cloud9","type":"main","index":0}],[{"node":"WhatsApp Business Cloud13","type":"main","index":0}],[{"node":"condicion","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":null,"versionId":"376fe21e-189a-464d-9523-12f46721b20a","triggerCount":0,"tags":[]}